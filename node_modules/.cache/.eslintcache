[{"C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\index.js":"1","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\reportWebVitals.js":"2","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\App.js":"3","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\GuidedAnnotation.js":"4","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\Annotation.js":"5","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\StartPage.js":"6","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\Instructions.js":"7","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\Annotation_event_handlers.js":"8","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\DocWord.js":"9","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\ResponsiveAppBar.js":"10","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\BackButton.js":"11","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\SummaryWord.js":"12","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\styled-sliders.js":"13","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\GuidedAnnotation_utils.js":"14","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\Tutorial.js":"15","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\Tutorial_utils.js":"16","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\TutorialCard.js":"17","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\mturk_utils.js":"18"},{"size":706,"mtime":1648483402725,"results":"19","hashOfConfig":"20"},{"size":375,"mtime":1645787016766,"results":"21","hashOfConfig":"20"},{"size":58924,"mtime":1650718934123,"results":"22","hashOfConfig":"20"},{"size":68500,"mtime":1650722503933,"results":"23","hashOfConfig":"20"},{"size":40872,"mtime":1650724583225,"results":"24","hashOfConfig":"20"},{"size":2508,"mtime":1647878770931,"results":"25","hashOfConfig":"20"},{"size":8185,"mtime":1648741136201,"results":"26","hashOfConfig":"20"},{"size":11503,"mtime":1650201924890,"results":"27","hashOfConfig":"20"},{"size":4813,"mtime":1650109708213,"results":"28","hashOfConfig":"20"},{"size":10946,"mtime":1650466977453,"results":"29","hashOfConfig":"20"},{"size":439,"mtime":1646496707735,"results":"30","hashOfConfig":"20"},{"size":2337,"mtime":1650385205322,"results":"31","hashOfConfig":"20"},{"size":2272,"mtime":1648137057484,"results":"32","hashOfConfig":"20"},{"size":3449,"mtime":1650646897580,"results":"33","hashOfConfig":"20"},{"size":30608,"mtime":1650664307797,"results":"34","hashOfConfig":"20"},{"size":8868,"mtime":1650450243784,"results":"35","hashOfConfig":"20"},{"size":7302,"mtime":1650449600573,"results":"36","hashOfConfig":"20"},{"size":4950,"mtime":1650558522048,"results":"37","hashOfConfig":"20"},{"filePath":"38","messages":"39","suppressedMessages":"40","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"41"},"iqi5he",{"filePath":"42","messages":"43","suppressedMessages":"44","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"41"},{"filePath":"45","messages":"46","suppressedMessages":"47","errorCount":0,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"48"},{"filePath":"49","messages":"50","suppressedMessages":"51","errorCount":0,"fatalErrorCount":0,"warningCount":21,"fixableErrorCount":0,"fixableWarningCount":0,"source":"52"},{"filePath":"53","messages":"54","suppressedMessages":"55","errorCount":0,"fatalErrorCount":0,"warningCount":26,"fixableErrorCount":0,"fixableWarningCount":0,"source":"56"},{"filePath":"57","messages":"58","suppressedMessages":"59","errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"60","usedDeprecatedRules":"41"},{"filePath":"61","messages":"62","suppressedMessages":"63","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"64","usedDeprecatedRules":"65"},{"filePath":"66","messages":"67","suppressedMessages":"68","errorCount":0,"fatalErrorCount":0,"warningCount":72,"fixableErrorCount":0,"fixableWarningCount":0,"source":"69","usedDeprecatedRules":"41"},{"filePath":"70","messages":"71","suppressedMessages":"72","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"73","usedDeprecatedRules":"41"},{"filePath":"74","messages":"75","suppressedMessages":"76","errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"77"},{"filePath":"78","messages":"79","suppressedMessages":"80","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"81","usedDeprecatedRules":"65"},{"filePath":"82","messages":"83","suppressedMessages":"84","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"85","messages":"86","suppressedMessages":"87","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"41"},{"filePath":"88","messages":"89","suppressedMessages":"90","errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"91"},{"filePath":"92","messages":"93","suppressedMessages":"94","errorCount":0,"fatalErrorCount":0,"warningCount":33,"fixableErrorCount":0,"fixableWarningCount":0,"source":"95"},{"filePath":"96","messages":"97","suppressedMessages":"98","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"99","messages":"100","suppressedMessages":"101","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"102"},{"filePath":"103","messages":"104","suppressedMessages":"105","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"106"},"C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\index.js",[],[],["107","108"],"C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\reportWebVitals.js",[],[],"C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\App.js",["109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126"],[],"import { useState, useEffect, useRef } from 'react'\r\nimport { BrowserRouter as Router, Route, Routes } from 'react-router-dom'\r\nimport Snackbar from '@mui/material/Snackbar';\r\nimport MuiAlert from '@mui/material/Alert';\r\nimport * as React from 'react';\r\n\r\nimport StartPage from './components/StartPage';\r\nimport Tutorial from './components/Tutorial';\r\n// import Instructions from './components/Instructions';\r\nimport GuidedAnnotation from './components/GuidedAnnotation';\r\n\r\nimport Annotation from './components/Annotation';\r\nimport json_file from './data/data_for_mturk.json';\r\nimport g_json_file from './data/guided_annotation/data_for_mturk.json';\r\n\r\n\r\n\r\nimport t_start_json_file from './data/tutorial/tutorial_start.json';\r\nimport t_middle_json_file from './data/tutorial/tutorial_middle.json';\r\nimport t_sent_end_json_file from './data/tutorial/tutorial_sent_end.json';\r\nimport t_submit_json_file from './data/tutorial/tutorial_submit.json';\r\n\r\n\r\n\r\n\r\nimport guided_annotation_messages from './data/guided_annotation/guided_annotation_messages.json'\r\nimport guided_annotation_hints from './data/guided_annotation/guided_annotation_hints.json'\r\nimport guided_annotation_info_messages from './data/guided_annotation/guided_annotation_info_messages.json'\r\nimport guided_annotation_strike_messages from './data/guided_annotation/guided_annotation_strike_messages.json'\r\n\r\nimport tutorial_state_messages from './data/tutorial/tutorial_state_messages.json'\r\n// import tutorial_state_messages from './data/guided_annotation/guided_annotation_messages.json'\r\n\r\n\r\n\r\nimport { MachineStateHandler, g_MachineStateHandler } from './components/Annotation_event_handlers';\r\nimport { turkGetAssignmentId, turkGetSubmitToHost, handleSubmit } from './components/mturk_utils'\r\nimport _ from 'underscore';\r\nimport AWS from 'aws-sdk';\r\n\r\nconst App = () => {\r\n\r\n  // AVIVSL: TUTORIAL_ANNOTATION\r\n  const [t_doc_json, t_setDocJson] = useState([]);\r\n  const [t_summary_json, t_setSummaryJson] = useState([]); \r\n  const [t_start_doc_json, t_setStartDocJson] = useState([]);\r\n  const [t_start_summary_json, t_setStartSummaryJson] = useState([]); \r\n  const [t_middle_doc_json, t_setMiddleDocJson] = useState([]);\r\n  const [t_middle_summary_json, t_setMiddleSummaryJson] = useState([]); \r\n  const [t_sent_end_doc_json, t_setSentEndDocJson] = useState([]);\r\n  const [t_sent_end_summary_json, t_setSentEndSummaryJson] = useState([]); \r\n  const [t_submit_doc_json, t_setSubmitDocJson] = useState([]);\r\n  const [t_submit_summary_json, t_setSubmitSummaryJson] = useState([]); \r\n  \r\n  const [t_all_lemma_match_mtx, t_setAllLemmaMtx] = useState([]);\r\n  const [t_important_lemma_match_mtx, t_setImportantLemmaMtx] = useState([]);\r\n  const [t_doc_paragraph_breaks, t_setDocParagraphBreaks] = useState([]);\r\n  const [t_state_messages, t_setStateMessages] = useState([]);\r\n\r\n  \r\n  // AVIVSL: GUIDED_ANNOTATION\r\n  const [g_doc_json, g_setDocJson] = useState([]);\r\n  const [g_summary_json, g_setSummaryJson] = useState([]); \r\n  const [g_all_lemma_match_mtx, g_setAllLemmaMtx] = useState([]);\r\n  const [g_important_lemma_match_mtx, g_setImportantLemmaMtx] = useState([]);\r\n  const [g_doc_paragraph_breaks, g_setDocParagraphBreaks] = useState([]);\r\n  const [g_boldState, g_setBoldState] = useState(\"sent\"); // for user to choose if want full sentence, span or no lemma matching (denoted as \"sent\", \"span\" and \"none\", accordingly)\r\n  const [g_oldAlignmentState, g_setOldAlignmentState] = useState(\"all\"); // for user to choose if want full highlighting history, only current sentence's highlighting history or no history (denoted as \"all\", \"sent\" and \"none\", accordingly)\r\n  const [g_StateMachineState, g_SetStateMachineState] = useState(\"START\");\r\n  const [g_error_message, g_setErrorMessage] = React.useState(\"\");\r\n  const [g_CurrSentInd, g_SetCurrSentInd] = useState(-1);\r\n  const [g_InfoMessage, g_SetInfoMessage] = useState(\"\");\r\n  const [g_AlignmentCount, g_SetAlignmentCount] = useState(0)\r\n  const [g_prevStateMachineState, g_setPrevStateMachineState] = useState(\"\")\r\n  \r\n  const [g_prevSummarySpanHighlights, g_setPrevSummarySpanHighlights] = useState([]) // relevant for restoring span alignments before going to \"revise\" mode\r\n  const [g_prevDocSpanHighlights, g_setPrevDocSpanHighlights] = useState([]) // relevant for restoring span alignments before going to \"revise\" mode\r\n  const [g_prevSummaryJsonRevise, g_setPrevSummaryJsonRevise] = useState([]) // relevant for restoring All alignments before choosing an alignment in revise mode so can be restored if pressing the back button\r\n  const [g_prevDocJsonRevise, g_setPrevDocJsonRevise] = useState([]) // relevant for restoring All alignments before choosing an alignment in revise mode so can be restored if pressing the back button\r\n  const [g_prevCurrSentInd, g_setPrevCurrSentInd] = useState(-1) // relevant for restoring previous current sentence\r\n\r\n\r\n  const [g_DocOnMouseDownID, g_SetDocOnMouseDownID] = useState(\"-1\");\r\n  const [g_SummaryOnMouseDownID, g_SetSummaryOnMouseDownID] = useState(\"-1\");\r\n  const [g_docOnMouseDownActivated, g_setDocOnMouseDownActivated] = useState(false);\r\n  const [g_summaryOnMouseDownActivated, g_setSummaryOnMouseDownActivated] = useState(false);\r\n  const [g_hoverActivatedId, g_setHoverActivatedId] = useState(\"-1\"); // value will be of tkn_id of elem hovered over\r\n  const [g_hoverActivatedDocOrSummary, g_setHoverActivatedDocOrSummary] = useState(\"doc\"); // value will be of tkn_id of elem hovered over\r\n  const [g_sliderBoldStateActivated, g_setSliderBoldStateActivated] = useState(false);\r\n\r\n\r\n  const [g_guiding_msg, g_setGuidingMsg] = useState({\"text\":\"\", \"title\":\"\"});\r\n  const [g_guiding_msg_type, g_setGuidingMsgType] = useState(\"closed\"); // success , danger or closed\r\n  const [g_curr_alignment_guiding_msg_id, g_setCurrAlignmentGuidingMsgId] = useState(\"-1\")\r\n  const [g_prev_curr_alignment_guiding_msg_id, g_setPrevCurrAlignmentGuidingMsgId] = useState(\"-1\") // relevant for restoring previous current sentence\r\n  const [g_guiding_info_msg, g_setGuidingInfoMsg] = useState({\"text\":\"To begin, hit the \\\"START\\\" button.\", \"title\":\"Start\"}); // the info message that describes what to do\r\n  const [g_prev_guiding_info_msg, g_setPrevGuidingInfoMsg] = useState({\"text\":\"To begin, hit the \\\"START\\\" button.\", \"title\":\"Start\"}); // the info message that describes what to do\r\n  const [g_guided_unhighlight, g_setGuidedUnhighlight] = useState(false)\r\n  const [g_is_good_alignment, g_setIsGoodAlignment] = useState(false)\r\n  const [g_show_hint, g_setShowHint] = useState(false)\r\n  const [g_hint_msg, g_setHintMsg] = useState({\"text\":\"\", \"title\":\"\"})\r\n\r\n  const [g_noAlignModalShow, g_setNoAlignModalShow] = useState(false)\r\n  const [g_noAlignApproved, g_setNoAlignApproved] = useState(false)\r\n  \r\n  const [g_completed, g_setCompleted] = useState(false)\r\n  const [g_guided_annotation_history, g_setGuidedAnnotationHistory] = useState([])\r\n  const [g_strikes_counter, g_setStrikesCounter] = useState(0)\r\n  const [g_answer_modal_msg, g_setAnswerModalMsg] = useState(\"\")\r\n  const [g_answer_words_to_glow, g_setAnswerWordsToGlow] = useState({\"type\":\"\", \"ids\":[], \"start_tkn\":\"\"})\r\n  const [g_Guider_msg, g_setGuiderMsg] = useState({\"type\":\"info\", \"where\":\"next-button\", \"text\":\"Press me to begin.\"}) // type: one of {\"info\", \"reveal-answer\"}, \"where\": one of {\"doc\", \"summary\", \"next-button\"}\r\n  const [g_prev_Guider_msg, g_setPrevGuiderMsg] = useState({\"type\":\"\", \"where\":\"\", \"text\":\"\"}) // type: one of {\"info\", \"reveal-answer\"}, \"where\": one of {\"doc\", \"summary\", \"next-button\"}\r\n\r\n\r\n  // const [guidingAnnotationAlertText, setGuidingAnnotationAlertText] = useState(\"\")\r\n  // const [guidingAnnotationAlertTitle, setGuidingAnnotationAlertTitle] = useState(\"\")\r\n  // const [guidingAnnotationAlertType, setGuidingAnnotationAlertType] = useState(\"success\") // can be either \"success\" or \"danger\"\r\n  // const [guidingAnnotationAlertShow, setGuidingAnnotationAlertShow] = useState(true)\r\n\r\n\r\n  // AVIVSL: ACTUAL ANNOTATION\r\n  const [task_id, setTaskID] = useState(\"-1\"); // default for task_id is -1\r\n  const [doc_json, setDocJson] = useState([]);\r\n  const [summary_json, setSummaryJson] = useState([]); \r\n  const [all_lemma_match_mtx, setAllLemmaMtx] = useState([]);\r\n  const [important_lemma_match_mtx, setImportantLemmaMtx] = useState([]);\r\n  const [doc_paragraph_breaks, setDocParagraphBreaks] = useState([]);\r\n  const [boldState, setBoldState] = useState(\"sent\"); // for user to choose if want full sentence, span or no lemma matching (denoted as \"sent\", \"span\" and \"none\", accordingly)\r\n  const [oldAlignmentState, setOldAlignmentState] = useState(\"all\"); // for user to choose if want full highlighting history, only current sentence's highlighting history or no history (denoted as \"all\", \"sent\" and \"none\", accordingly)\r\n  const [StateMachineState, SetStateMachineState] = useState(\"START\");\r\n  const [error_message, setErrorMessage] = React.useState(\"\");\r\n  const [CurrSentInd, SetCurrSentInd] = useState(-1);\r\n  const [InfoMessage, SetInfoMessage] = useState(\"\");\r\n  const [AlignmentCount, SetAlignmentCount] = useState(0)\r\n\r\n  const [prevStateMachineState, setPrevStateMachineState] = useState(\"\")\r\n  \r\n  const [prevSummarySpanHighlights, setPrevSummarySpanHighlights] = useState([]) // relevant for restoring span alignments before going to \"revise\" mode\r\n  const [prevDocSpanHighlights, setPrevDocSpanHighlights] = useState([]) // relevant for restoring span alignments before going to \"revise\" mode\r\n  const [prevSummaryJsonRevise, setPrevSummaryJsonRevise] = useState([]) // relevant for restoring All alignments before choosing an alignment in revise mode so can be restored if pressing the back button\r\n  const [prevDocJsonRevise, setPrevDocJsonRevise] = useState([]) // relevant for restoring All alignments before choosing an alignment in revise mode so can be restored if pressing the back button\r\n  const [prevCurrSentInd, setPrevCurrSentInd] = useState(-1) // relevant for restoring previous current sentence\r\n\r\n\r\n  const [DocOnMouseDownID, SetDocOnMouseDownID] = useState(\"-1\");\r\n  const [SummaryOnMouseDownID, SetSummaryOnMouseDownID] = useState(\"-1\");\r\n  const [docOnMouseDownActivated, setDocOnMouseDownActivated] = useState(false);\r\n  const [summaryOnMouseDownActivated, setSummaryOnMouseDownActivated] = useState(false);\r\n  const [hoverActivatedId, setHoverActivatedId] = useState(\"-1\"); // value will be of tkn_id of elem hovered over\r\n  const [hoverActivatedDocOrSummary, setHoverActivatedDocOrSummary] = useState(\"doc\"); // value will be of tkn_id of elem hovered over\r\n  \r\n  const [sliderBoldStateActivated, setSliderBoldStateActivated] = useState(false);\r\n  const [noAlignModalShow, setNoAlignModalShow] = useState(false)\r\n  const [noAlignApproved, setNoAlignApproved] = useState(false)\r\n\r\n\r\n  //mturk\r\n  const [assignmentId, SetAssignmentId] = useState(\"\")\r\n  const [turkSubmitTo, SetMturkTurkSubmitTo] = useState(\"https://www.mturk.com\")\r\n  const [isFinished, SetIsFinished] = useState(false)\r\n  const [OpeningModalShow, setOpeningModalShow] = useState(true);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  /*************************************** error handling *************************************************/\r\n  const Alert = React.forwardRef(function Alert(props, ref) {return <MuiAlert elevation={6} ref={ref} variant=\"filled\" {...props} />;});\r\n  \r\n  // AVIVSL: GUIDED_ANNOTATION\r\n  const g_handleErrorOpen = ({ msg }) => { \r\n    g_setErrorMessage(msg); \r\n  };\r\n\r\n  const g_handleErrorClose = (event, reason) => {\r\n    if (reason === 'clickaway') {\r\n      return;\r\n    }\r\n\r\n    g_setErrorMessage(\"\");\r\n  };\r\n\r\n  // AVIVSL: ACTUAL ANNOTATION\r\n  const handleErrorOpen = ({ msg }) => { \r\n    setErrorMessage(msg); \r\n  };\r\n\r\n  const handleErrorClose = (event, reason) => {\r\n    if (reason === 'clickaway') {\r\n      return;\r\n    }\r\n\r\n    setErrorMessage(\"\");\r\n  };\r\n\r\n\r\n/************************************************************************************************************* */\r\n\r\n  const isPunct = (tkn_txt) => {\r\n    const regex = /[!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~]/g;\r\n    const result = tkn_txt.replace(regex, '').replace(/(\\r\\n|\\n|\\r)/gm, \"\");\r\n    return (result === '');\r\n  }\r\n\r\n// AVIVSL: GUIDED_ANNOTATION  \r\n  function g_addDocWordComponents(doc) {\r\n    let updated_doc_json = [];\r\n    doc.forEach((word) => {\r\n      let boldfaced=false;\r\n      let all_highlighted=false; // all the doc's highlights so far\r\n      let span_highlighted=false; // all the span's highlights so far\r\n      let old_alignments=false; // old highlighting control (goes between all, sentences and none) --> how much of all_highlighted to highlight\r\n      let alignment_id=[];\r\n      let old_alignment_hover=false; // to pop when hovering over words during \"REVISE HOVER\" state\r\n      let span_alignment_hover=false; // to ease the process of choosing spans (while pressing the mouse - make simultaneous highlighting)\r\n      let red_color=false;\r\n      const newWord = {...word, boldfaced, span_highlighted, all_highlighted, old_alignments, old_alignment_hover, span_alignment_hover, red_color, alignment_id}; \r\n      updated_doc_json = [...updated_doc_json, newWord];\r\n    })\r\n    g_setDocJson(updated_doc_json);\r\n  }\r\n\r\n  function g_addSummaryWordComponents(summary) {\r\n    let updated_summary_json = [];\r\n    summary.forEach((word) => {\r\n      let boldfaced=false;\r\n\r\n      let all_highlighted=false; // all the doc's highlights so far\r\n      let span_highlighted=false; // all the span's highlights so far\r\n      let old_alignments=false; // old highlighting control (goes between all, sentences and none) --> how much of all_highlighted to highlight\r\n      let shadowed=false;\r\n      let alignment_id=[];\r\n      let old_alignment_hover=false; // to pop when hovering over words during \"REVISE HOVER\" state\r\n      let span_alignment_hover=false; // to ease the process of choosing spans (while pressing the mouse - make simultaneous highlighting)\r\n      const newWord = {...word, boldfaced, span_highlighted, all_highlighted, old_alignments, old_alignment_hover, span_alignment_hover, shadowed, alignment_id}; \r\n      updated_summary_json = [...updated_summary_json, newWord];\r\n    })\r\n    g_setSummaryJson(updated_summary_json);\r\n  }\r\n\r\n\r\n// AVIVSL: ACTUAL ANNOTATION\r\n  function addDocWordComponents(doc) {\r\n    let updated_doc_json = [];\r\n    doc.forEach((word) => {\r\n      let boldfaced=false;\r\n      let all_highlighted=false; // all the doc's highlights so far\r\n      let span_highlighted=false; // all the span's highlights so far\r\n      let old_alignments=false; // old highlighting control (goes between all, sentences and none) --> how much of all_highlighted to highlight\r\n      let alignment_id=[];\r\n      let old_alignment_hover=false; // to pop when hovering over words during \"REVISE HOVER\" state\r\n      let span_alignment_hover=false; // to ease the process of choosing spans (while pressing the mouse - make simultaneous highlighting)\r\n      let red_color=false;\r\n      const newWord = {...word, boldfaced, span_highlighted, all_highlighted, old_alignments, old_alignment_hover, span_alignment_hover, red_color, alignment_id}; \r\n      updated_doc_json = [...updated_doc_json, newWord];\r\n    })\r\n    setDocJson(updated_doc_json);\r\n  }\r\n\r\n\r\n  function addSummaryWordComponents(summary) {\r\n    let updated_summary_json = [];\r\n    summary.forEach((word) => {\r\n      let boldfaced=false;\r\n\r\n      let all_highlighted=false; // all the doc's highlights so far\r\n      let span_highlighted=false; // all the span's highlights so far\r\n      let old_alignments=false; // old highlighting control (goes between all, sentences and none) --> how much of all_highlighted to highlight\r\n      let shadowed=false;\r\n      let alignment_id=[];\r\n      let old_alignment_hover=false; // to pop when hovering over words during \"REVISE HOVER\" state\r\n      let span_alignment_hover=false; // to ease the process of choosing spans (while pressing the mouse - make simultaneous highlighting)\r\n      const newWord = {...word, boldfaced, span_highlighted, all_highlighted, old_alignments, old_alignment_hover, span_alignment_hover, shadowed, alignment_id}; \r\n      updated_summary_json = [...updated_summary_json, newWord];\r\n    })\r\n    setSummaryJson(updated_summary_json);\r\n  }\r\n\r\n  const toggleDocSpanHighlight = ({tkn_ids, turn_on, turn_off}) => {\r\n    setSliderBoldStateActivated(false)\r\n    if (turn_on){\r\n      setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: true } : word))\r\n    } else if (turn_off){\r\n        setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: false, span_alignment_hover:false } : word))\r\n    } else {\r\n        setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: !word.span_highlighted } : word))\r\n    }\r\n  }\r\n\r\n  toggleDocSpanHighlight.defaultProps = {\r\n    turn_on: false,\r\n    turn_off: false\r\n  }\r\n\r\n  const toggleSummarySpanHighlight = ({tkn_ids, turn_on, turn_off}) => {\r\n    // console.log(\"inside toggleSummarySpanHighlight:\")\r\n    // console.log(tkn_ids)\r\n    setSliderBoldStateActivated(false)\r\n    if (turn_on){\r\n      setSummaryJson(summary_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: true } : word));\r\n    } else if (turn_off){\r\n      setSummaryJson(summary_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: false, span_alignment_hover:false } : word));\r\n    } else {\r\n      setSummaryJson(summary_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: !word.span_highlighted } : word));\r\n    }\r\n  }\r\n\r\n  toggleSummarySpanHighlight.defaultProps = {\r\n    turn_on: false,\r\n    turn_off: false\r\n  }\r\n\r\n\r\n  const approveHighlightHandler = () => {\r\n    const doc_tkn_ids = doc_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id});\r\n    setDocJson(doc_json.map((word) => doc_tkn_ids.includes(word.tkn_id) ? { ...word, all_highlighted: true, alignment_id: [...word.alignment_id, AlignmentCount], span_highlighted: false } : word));\r\n\r\n\r\n    const summary_tkn_ids = summary_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id});\r\n    setSummaryJson(summary_json.map((word) => summary_tkn_ids.includes(word.tkn_id) ? { ...word, all_highlighted: true, alignment_id: [...word.alignment_id, AlignmentCount], span_highlighted: false } : word));    \r\n \r\n  }\r\n\r\n  const StartReviseStateHandler = (isBackBtn) => {\r\n    if (isBackBtn){\r\n      setDocJson(doc_json.map((word, ind) => {return {...word, all_highlighted: prevDocJsonRevise[ind].all_highlighted, span_highlighted: prevDocJsonRevise[ind].span_highlighted, alignment_id: prevDocJsonRevise[ind].alignment_id}}))\r\n      setSummaryJson(summary_json.map((word, ind) => {return {...word, all_highlighted: prevSummaryJsonRevise[ind].all_highlighted, span_highlighted: prevSummaryJsonRevise[ind].span_highlighted, alignment_id: prevSummaryJsonRevise[ind].alignment_id}}))\r\n    } else{\r\n      const current_sentence_id = CurrSentInd\r\n\r\n      setPrevStateMachineState(StateMachineState);\r\n      setPrevDocSpanHighlights(doc_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id}));\r\n      setPrevSummarySpanHighlights(summary_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id}));\r\n      setPrevCurrSentInd(current_sentence_id)\r\n      setDocJson(doc_json.map((word) => {return {...word, span_highlighted: false}}))\r\n      setSummaryJson(summary_json.map((word) => {return {...word, span_highlighted: false}}))\r\n    }\r\n    SetCurrSentInd(-1)\r\n  }\r\n\r\n  const ExitReviseHandler = () => {\r\n    setDocJson(doc_json.map((word, ind) => prevDocSpanHighlights.includes(word.tkn_id) ? {...word, span_highlighted: true}:{...word, span_highlighted: false}))\r\n    setSummaryJson(summary_json.map((word, ind) => prevSummarySpanHighlights.includes(word.tkn_id) ? {...word, span_highlighted: true}:{...word, span_highlighted: false}))               \r\n    const prev_state = prevStateMachineState;\r\n    SetStateMachineState(prevStateMachineState);\r\n\r\n    const prev_current_sent_id = prevCurrSentInd\r\n    SetCurrSentInd(prev_current_sent_id)\r\n    \r\n    setPrevCurrSentInd(-1)\r\n    setPrevStateMachineState(\"\");\r\n    setPrevSummarySpanHighlights([]);\r\n    setPrevDocSpanHighlights([]);\r\n    return prev_state\r\n  }\r\n\r\n  const RemoveAlignmentId = (word, chosen_align_id) => {\r\n    const new_alignment_id = word.alignment_id.filter((elem) => {return elem !== chosen_align_id});\r\n    return new_alignment_id;\r\n  }\r\n\r\n  const ReviseChooseAlignHandler = (clickedWordInfo) => {\r\n    setPrevSummaryJsonRevise(summary_json);\r\n    setPrevDocJsonRevise(doc_json);\r\n\r\n    const chosen_align_id = (clickedWordInfo[0] === 'doc') ? doc_json.filter((word) => {return word.tkn_id === clickedWordInfo[1]})[0].alignment_id[0] : \r\n                                                             summary_json.filter((word) => {return word.tkn_id === clickedWordInfo[1]})[0].alignment_id[0]\r\n\r\n    setSummaryJson(summary_json.map((word) => word.alignment_id.includes(chosen_align_id) ? {...word, span_highlighted: true, all_highlighted: false, old_alignments: false, old_alignment_hover:false, alignment_id: RemoveAlignmentId(word, chosen_align_id)} : {...word, span_highlighted: false}))\r\n    setDocJson(doc_json.map((word) => word.alignment_id.includes(chosen_align_id) ? {...word, span_highlighted: true, all_highlighted: false, old_alignments: false, old_alignment_hover:false, alignment_id: RemoveAlignmentId(word, chosen_align_id)} : {...word, span_highlighted: false}))\r\n    \r\n    const chosen_align_currSentId = summary_json.filter((word) => {return word.alignment_id.includes(chosen_align_id)})[0].sent_id\r\n    SetCurrSentInd(chosen_align_currSentId)\r\n  }\r\n\r\n\r\n  const SetSummaryShadow = (sent_id) => {\r\n    setSummaryJson(summary_json.map((word) => word.sent_id === sent_id ? { ...word, shadowed: true } : { ...word, shadowed: false }))\r\n  }\r\n\r\n\r\n  const SetSummaryShadowAndUpdateHighlights = (sent_id) => {\r\n    setSummaryJson(\r\n      summary_json.map((word) => word.sent_id === sent_id ? { ...word, shadowed: true } : { ...word, shadowed: false }).map(\r\n      (word) => word.span_highlighted ? {...word, span_highlighted: false, all_highlighted:true} : word)\r\n      )\r\n  }\r\n\r\n  const SetDocBoldface = (tkn_ids) => {\r\n    setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, boldfaced: true } : { ...word, boldfaced: false }))\r\n  }\r\n\r\n  const checkIfLemmasMatch = ({doc_id, summary_ids, isHover}) => {\r\n    // if (isHover){\r\n    //   console.log(\"AVIVSL: summary_ids are:\")\r\n    //   console.log(summary_ids)\r\n    // }\r\n    const which_match_mtx = important_lemma_match_mtx;\r\n    const matching_summary_ids = summary_ids.filter((summary_id) => {return all_lemma_match_mtx[doc_id][summary_id] === 1;})\r\n    return matching_summary_ids.length > 0\r\n  }\r\n\r\n  const boldStateHandler = (event, newValue) => {\r\n    if (event !== undefined){\r\n      setSliderBoldStateActivated(true)\r\n    }\r\n    if (newValue=='1'){\r\n      setBoldState(\"none\");\r\n      SetDocBoldface([]);\r\n    } else if (newValue=='2'){\r\n      setBoldState(\"span\");\r\n      const summary_ids = summary_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id});\r\n      const isSpan = true;\r\n      const tkn_ids = doc_json.map((word) => {return word.tkn_id}).filter((doc_id) => {return checkIfLemmasMatch({doc_id:doc_id, summary_ids:summary_ids, isHover:false})});\r\n      SetDocBoldface(tkn_ids);\r\n    } else {\r\n      setBoldState(\"sent\");\r\n      const isSpan = false;\r\n      const summary_ids = summary_json.filter((word) => {return word.shadowed}).map((word) => {return word.tkn_id});\r\n      const tkn_ids = doc_json.map((word) => {return word.tkn_id}).filter((doc_id) => {return checkIfLemmasMatch({doc_id:doc_id, summary_ids:summary_ids, isHover:false})});\r\n      SetDocBoldface(tkn_ids);\r\n    }\r\n  }\r\n\r\n\r\n  const SetDocOldHighlights = (tkn_ids) => {\r\n    setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, old_alignments: true } : { ...word, old_alignments: false }))\r\n  }\r\n\r\n  const SetSummaryOldHighlights = (tkn_ids) => {\r\n    setSummaryJson(summary_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, old_alignments: true } : { ...word, old_alignments: false }))\r\n  }\r\n\r\n  const FindDocAlignmentPerSent = (sent_ind) => {\r\n    let curr_sent_alignment_ids = summary_json.map((word) => {return (word.sent_id===sent_ind) ? word.alignment_id : []});\r\n    curr_sent_alignment_ids = [].concat.apply([], curr_sent_alignment_ids); // merge into a single array (before was an array of arrays)\r\n    const doc_ids = doc_json.filter((word) => {return word.alignment_id.some(r=> curr_sent_alignment_ids.includes(r))}).map((word) => {return word.tkn_id});\r\n    return doc_ids\r\n  }\r\n\r\n\r\n  const oldAlignmentStateHandler = ({event, newValue, sent_ind}) => {\r\n\r\n    if (newValue=='1'){\r\n      setOldAlignmentState(\"none\");\r\n      SetDocOldHighlights([]);\r\n      SetSummaryOldHighlights([]);\r\n    } else if (newValue=='2'){\r\n      setOldAlignmentState(\"sent\");\r\n      sent_ind = (sent_ind===-1) ? CurrSentInd : sent_ind\r\n      const doc_ids = FindDocAlignmentPerSent(sent_ind)\r\n      const summary_ids = summary_json.filter((word) => {return (word.all_highlighted && word.sent_id === sent_ind)}).map((word) => {return word.tkn_id});\r\n      SetDocOldHighlights(doc_ids);\r\n      SetSummaryOldHighlights(summary_ids);\r\n    } else {\r\n      setOldAlignmentState(\"all\");\r\n      const doc_ids = doc_json.filter((word) => {return word.all_highlighted}).map((word) => {return word.tkn_id});\r\n      const summary_ids = summary_json.filter((word) => {return word.all_highlighted}).map((word) => {return word.tkn_id});\r\n      SetDocOldHighlights(doc_ids);\r\n      SetSummaryOldHighlights(summary_ids);\r\n    }\r\n  }\r\n\r\n  oldAlignmentStateHandler.defaultProps = {\r\n    sent_ind: -1\r\n  }\r\n\r\n\r\n  \r\n  const hoverHandler = ({inOrOut, curr_alignment_id, tkn_id, isSummary}) => {\r\n    // onMouseEnter for \"REVISE HOVER\"\r\n    if (inOrOut === \"in\" && StateMachineState===\"REVISE HOVER\") { \r\n      setDocJson(doc_json.map((word) => word.alignment_id.includes(curr_alignment_id) ? {...word, old_alignment_hover: true} : {...word, old_alignment_hover: false}))\r\n      setSummaryJson(summary_json.map((word) => word.alignment_id.includes(curr_alignment_id) ? {...word, old_alignment_hover: true} : {...word, old_alignment_hover: false}))\r\n    } \r\n    // onMouseLeave for \"REVISE HOVER\"\r\n    else if (inOrOut === \"out\" && StateMachineState===\"REVISE HOVER\") { \r\n      setDocJson(doc_json.map((word) => {return {...word, old_alignment_hover:false}}))\r\n      setSummaryJson(summary_json.map((word) => {return {...word, old_alignment_hover:false}}))\r\n    }\r\n    // onMouseEnter for all the alignments choosing states\r\n    // else if (inOrOut === \"in\" && [\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState) && isSummary) { \r\n      // const doc_tkn_ids = doc_json.map((word) => {return word.tkn_id}).filter((doc_id) => {return checkIfLemmasMatch({doc_id:doc_id, summary_ids:[tkn_id], isHover:true})});\r\n      // setDocJson(doc_json.map((word) => doc_tkn_ids.includes(word.tkn_id) ? {...word, red_color:true} : {...word, red_color:false}))\r\n    // } \r\n    // onMouseLeave for all the alignments choosing states\r\n    else if (inOrOut === \"out\" && [\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState) && isSummary) { \r\n      setDocJson(doc_json.map((word) => {return {...word, red_color:false}}))\r\n    }\r\n\r\n  }\r\n\r\n  const isRedLettered = (summary_tkn_id) => {\r\n    if ((summary_json.filter((word) => {return word.tkn_id === summary_tkn_id && word.sent_id !== CurrSentInd}).length !== 0) && StateMachineState !== \"REVISE HOVER\") {\r\n      return false\r\n    } else if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState)) {\r\n      return true\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n  const MachineStateHandlerWrapper = ({clickedWordInfo, forceState, isBackBtn}) => {\r\n    \r\n\r\n    // no alignment\r\n    if ((typeof forceState !== 'string') && (StateMachineState !== \"REVISE HOVER\") && (doc_json.filter((word) => {return word.span_highlighted}).length === 0) && (StateMachineState!==\"START\") && !noAlignApproved) {\r\n      setNoAlignModalShow(true)\r\n      return\r\n    }\r\n    setNoAlignApproved(false)\r\n\r\n\r\n    setSliderBoldStateActivated(false);\r\n    if (typeof forceState === 'string') {\r\n      console.log(`forceState situation with: state ${forceState}`);\r\n    }\r\n    else{\r\n      console.log(\"not a forceState situation...\");\r\n    }\r\n    MachineStateHandler(summary_json,\r\n                          StateMachineState, SetStateMachineState,\r\n                          SetInfoMessage, handleErrorOpen, isPunct,\r\n                          CurrSentInd, SetCurrSentInd, SetSummaryShadow,\r\n                          AlignmentCount, SetAlignmentCount,\r\n                          approveHighlightHandler,\r\n                          clickedWordInfo, forceState, \r\n                          StartReviseStateHandler, ExitReviseHandler,\r\n                          ReviseChooseAlignHandler, \r\n                          isBackBtn,\r\n                          setPrevSummaryJsonRevise, setPrevDocJsonRevise\r\n                         );\r\n  }\r\n\r\n  MachineStateHandlerWrapper.defaultProps = {\r\n    forceState: '',\r\n    clickedWordInfo: [],\r\n    isBackBtn: false\r\n  }\r\n\r\n/**************************************************************************************************************/\r\n\r\n  /*******  useState for smooth transition to \"SENTENCE END\" or \"SUMMARY END\" *******/\r\n  const finishedSent = useRef(false);\r\n\r\n  useEffect(() => {\r\n    const isNotStart = (StateMachineState !== \"START\" && summary_json.filter((word) => {return word.sent_id===CurrSentInd && word.shadowed}).length !== 0);\r\n    const isAllSentHighlighted = (summary_json.filter((word) => { return word.sent_id===CurrSentInd && !(word.all_highlighted || word.span_highlighted) && !isPunct(word.word)}).length === 0); // need \"isNotStart\" because also for \"START\" state isAllSentHighlighted=true because no sentence is span-highlighted yet \r\n    if (isAllSentHighlighted && isNotStart && !finishedSent.current && ![\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState)) {\r\n      finishedSent.current = true;\r\n\r\n\r\n      const isLastSent = (Math.max.apply(Math, summary_json.map(word => { return word.sent_id; })) === CurrSentInd)\r\n      if (isLastSent) {\r\n        MachineStateHandlerWrapper({forceState:\"SUMMARY END\"});   \r\n      } else {\r\n        MachineStateHandlerWrapper({forceState:\"SENTENCE END\"});   \r\n      }\r\n    }\r\n\r\n    // if regretted summary highlighting\r\n    else if(!isAllSentHighlighted && isNotStart && finishedSent.current && ![\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState)) { \r\n      // console.log(`curr state is ${StateMachineState}`);\r\n      // console.log(`curr CurrSentInd is ${CurrSentInd}`)\r\n      // console.log(\"back to square one\");\r\n      finishedSent.current = false;\r\n      MachineStateHandlerWrapper({forceState:\"ANNOTATION\"});\r\n    }\r\n  }, [summary_json]);\r\n  /*********************************************************************************/ \r\n\r\n\r\n  \r\n  /*********** useState to update the summary shadow when next sentence ***********/ \r\n  useEffect(() => {\r\n    SetSummaryShadowAndUpdateHighlights(CurrSentInd);\r\n  }, [CurrSentInd]);\r\n\r\n  /********************************************************************************/\r\n\r\n\r\n  /***************************** bolding controlling *****************************/ \r\n  useEffect(() => {\r\n    // when choosing a span - if nothing is span_highlighted then all sent matches are in bold, otherwise only span_highlighted matches (when highlighting - something must be span-highlighted so automatically is '2')\r\n    if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\"].includes(StateMachineState) && !sliderBoldStateActivated) {\r\n      const bold_state = (summary_json.filter((word) => {return word.span_highlighted}).length === 0) ? '3' : '2'; // if no span is current highlighted - bold everything, otherwise bold only currently highlighted span\r\n      boldStateHandler(undefined, bold_state);\r\n    } else if ([\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState) && !sliderBoldStateActivated) {\r\n      boldStateHandler(undefined, '1');\r\n    }\r\n  }, [StateMachineState, summary_json]);\r\n  /********************************************************************************/\r\n\r\n\r\n    /***************************** old alignments controlling *****************************/ \r\n    const prevState = useRef(\"\")\r\n    useEffect(() => {\r\n      if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\"].includes(StateMachineState)) {\r\n        oldAlignmentStateHandler({event:undefined, newValue:'3', sent_ind:-1});\r\n      } else if (StateMachineState === \"REVISE CLICKED\"){\r\n        oldAlignmentStateHandler({event:undefined, newValue:'1', sent_ind:-1});\r\n      } else if (StateMachineState === \"REVISE HOVER\"){\r\n        oldAlignmentStateHandler({event:undefined, newValue:'3', sent_ind:-1});\r\n      }\r\n      prevState.current = StateMachineState;\r\n    }, [StateMachineState, AlignmentCount]);\r\n    /********************************************************************************/\r\n    useEffect(() => {\r\n      // console.log(`CurrSentInd is updated and is now ${CurrSentInd}`)\r\n      // console.log('doc_json:')\r\n      // console.log(doc_json)\r\n      // console.log('t_doc_json:')\r\n      // console.log(t_doc_json)\r\n    }, [CurrSentInd]);\r\n    \r\n    \r\n    \r\n    /******************* highlighting while choosing spans to help *******************/ \r\n\r\n    useEffect(() => {\r\n      if (DocOnMouseDownID !== \"-1\"){\r\n        setDocOnMouseDownActivated(true)\r\n      } else if (DocOnMouseDownID === \"-1\"){\r\n        setDocOnMouseDownActivated(false)\r\n      } \r\n      \r\n      if (SummaryOnMouseDownID !== \"-1\") {\r\n        setSummaryOnMouseDownActivated(true)\r\n      } else {\r\n        setSummaryOnMouseDownActivated(false)\r\n      }\r\n    }, [DocOnMouseDownID,SummaryOnMouseDownID]);\r\n    \r\n    //AVIVSL: TODO: find way to reset the whole hovering process when the onMouseUp occurs outside of the text (maybe when docOnMouseDownActivated===false or summaryOnMouseDownActivated===false) --> maybe use a useRef to remember which one was the one activated - summary or doc?\r\n    useEffect(() => {\r\n      console.log(`hoverActivatedId:${hoverActivatedId}`)\r\n      if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState)){\r\n        if(docOnMouseDownActivated) {\r\n          // console.log(`DocOnMouseDownID is ${DocOnMouseDownID} and hoverActivatedId ia ${hoverActivatedId}`)\r\n          const min_ID =  (DocOnMouseDownID > hoverActivatedId) ? hoverActivatedId : DocOnMouseDownID;\r\n          const max_ID =  (DocOnMouseDownID > hoverActivatedId) ? DocOnMouseDownID : hoverActivatedId;\r\n          let chosen_IDs = [];\r\n          for(let i=min_ID; i<=max_ID; i++){\r\n            chosen_IDs.push(i);\r\n          }\r\n          setDocJson(doc_json.map((word) => chosen_IDs.includes(word.tkn_id)? {...word, span_alignment_hover:true}:{...word, span_alignment_hover:false}))\r\n        } else if (!docOnMouseDownActivated){\r\n          setDocJson(doc_json.map((word) => {return {...word, span_alignment_hover:false}}))\r\n        }\r\n        if(summaryOnMouseDownActivated) {\r\n          // console.log(`SummaryOnMouseDownID is ${SummaryOnMouseDownID} and hoverActivatedId ia ${hoverActivatedId}`)\r\n          const min_ID =  (SummaryOnMouseDownID > hoverActivatedId) ? hoverActivatedId : SummaryOnMouseDownID;\r\n          const max_ID =  (SummaryOnMouseDownID > hoverActivatedId) ? SummaryOnMouseDownID : hoverActivatedId;\r\n          let chosen_IDs = [];\r\n          for(let i=min_ID; i<=max_ID; i++){\r\n            chosen_IDs.push(i);\r\n          }\r\n          setSummaryJson(summary_json.map((word) => chosen_IDs.includes(word.tkn_id)? {...word, span_alignment_hover:true}:{...word, span_alignment_hover:false}))\r\n        } else if (!summaryOnMouseDownActivated){\r\n          setSummaryJson(summary_json.map((word) => {return {...word, span_alignment_hover:false}}))\r\n          \r\n          if (isRedLettered(hoverActivatedId) && hoverActivatedDocOrSummary === \"summary\") {\r\n            const doc_tkn_ids = doc_json.map((word) => {return word.tkn_id}).filter((doc_id) => {return checkIfLemmasMatch({doc_id:doc_id, summary_ids:[hoverActivatedId], isHover:true})});\r\n            \r\n            console.log(\"red is activated:\")\r\n            console.log(doc_json.filter((word) => {return doc_tkn_ids.includes(word.tkn_id)}).map((word) => {return word.word}))\r\n\r\n            setDocJson(doc_json.map((word) => doc_tkn_ids.includes(word.tkn_id) ? {...word, red_color:true} : {...word, red_color:false}))  \r\n          } \r\n        }\r\n      }\r\n    }, [docOnMouseDownActivated, summaryOnMouseDownActivated, hoverActivatedId]);\r\n\r\n\r\n    /********************************************************************************/\r\n    \r\n    \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    \r\n/**************************************************************************************************************/\r\n\r\n    const g_resetGuidedAnnotation = () => {\r\n      const curr_id = '0';\r\n\r\n      g_addDocWordComponents(g_json_file[curr_id][\"doc\"]);\r\n      g_addSummaryWordComponents(g_json_file[curr_id][\"summary\"]);\r\n      g_setAllLemmaMtx(g_json_file[curr_id][\"all_lemma_match_mtx\"]);\r\n      g_setImportantLemmaMtx(g_json_file[curr_id][\"important_lemma_match_mtx\"]);\r\n      g_setDocParagraphBreaks(g_json_file[curr_id][\"doc_paragraph_breaks\"]);\r\n      g_SetStateMachineState(\"START\")\r\n      g_SetCurrSentInd(-1)\r\n      g_SetAlignmentCount(0)\r\n      g_setPrevStateMachineState(\"\")\r\n      g_setIsGoodAlignment(false)\r\n      g_setGuidingInfoMsg({\"text\":\"To begin, hit the \\\"START\\\" button.\", \"title\":\"Start\"})\r\n      g_setGuiderMsg({\"type\":\"info\", \"where\":\"next-button\", \"text\":\"Press me to begin.\"}) \r\n\r\n    }\r\n\r\n    useEffect(() => {\r\n\r\n      const t_addWordComponents = (setJson, input_json) => {\r\n        let new_json = [];\r\n        input_json.forEach((word) => {new_json = [...new_json, word];})\r\n        setJson(new_json)\r\n      }\r\n\r\n\r\n      const t_getTasks = () => {\r\n      \r\n\r\n\r\n        // get doc_jsons\r\n        t_addWordComponents(t_setDocJson, t_start_json_file[\"doc\"])\r\n        t_addWordComponents(t_setStartDocJson, t_start_json_file[\"doc\"])\r\n        t_addWordComponents(t_setMiddleDocJson, t_middle_json_file[\"doc\"])\r\n        t_addWordComponents(t_setSentEndDocJson, t_sent_end_json_file[\"doc\"])\r\n        t_addWordComponents(t_setSubmitDocJson, t_submit_json_file[\"doc\"])\r\n        // get summary_jsons\r\n        t_addWordComponents(t_setSummaryJson, t_start_json_file[\"summary\"])\r\n        t_addWordComponents(t_setStartSummaryJson, t_start_json_file[\"summary\"])\r\n        t_addWordComponents(t_setMiddleSummaryJson, t_middle_json_file[\"summary\"])\r\n        t_addWordComponents(t_setSentEndSummaryJson, t_sent_end_json_file[\"summary\"])\r\n        t_addWordComponents(t_setSubmitSummaryJson, t_submit_json_file[\"summary\"])\r\n\r\n\r\n\r\n        // get all the matrices and the paragraph breaks\r\n        t_setAllLemmaMtx(t_start_json_file[\"all_lemma_match_mtx\"]);\r\n        t_setImportantLemmaMtx(t_start_json_file[\"important_lemma_match_mtx\"]);\r\n        t_setDocParagraphBreaks(t_start_json_file[\"doc_paragraph_breaks\"])\r\n        \r\n        \r\n        // get state messages\r\n        t_setStateMessages(tutorial_state_messages)\r\n\r\n\r\n        fetch(`/`).then(\r\n          res => console.log(res)\r\n        )\r\n      }\r\n\r\n\r\n\r\n\r\n\r\n      const g_getTasks = () => {\r\n        g_resetGuidedAnnotation()\r\n\r\n        fetch(`/`).then(\r\n          res => console.log(res)\r\n        )\r\n          \r\n        }\r\n    \r\n\r\n\r\n      const getTasks = () => {\r\n        const queryString = window.location.search;\r\n        const urlParams = new URLSearchParams(queryString);\r\n\r\n        const curr_id = urlParams.get('id');\r\n\r\n        const assignment_id = turkGetAssignmentId();\r\n        const turk_submit_to = turkGetSubmitToHost();\r\n\r\n        SetAssignmentId(assignment_id)\r\n        SetMturkTurkSubmitTo(turk_submit_to)\r\n        setTaskID(curr_id);\r\n\r\n        addDocWordComponents(json_file[curr_id][\"doc\"])\r\n        addSummaryWordComponents(json_file[curr_id][\"summary\"])\r\n        setAllLemmaMtx(json_file[curr_id][\"all_lemma_match_mtx\"]);\r\n        setImportantLemmaMtx(json_file[curr_id][\"important_lemma_match_mtx\"]);\r\n        setDocParagraphBreaks(json_file[curr_id][\"doc_paragraph_breaks\"])\r\n        fetch(`/`).then(\r\n          res => console.log(res)\r\n        )\r\n          \r\n        }\r\n      t_getTasks();\r\n      g_getTasks();\r\n      getTasks();\r\n    }, [])\r\n\r\n\r\n    const SubmitHandler = (event) => {\r\n      // no alignment\r\n      if ((typeof forceState !== 'string') && (doc_json.filter((word) => {return word.span_highlighted}).length === 0) && (StateMachineState!==\"START\") && !noAlignApproved) {\r\n        setNoAlignModalShow(true)\r\n        return\r\n      }\r\n      setNoAlignApproved(false)\r\n      \r\n      \r\n      approveHighlightHandler()\r\n      SetIsFinished(true)\r\n\r\n      // console.log(event);\r\n      // alert(\"Submitted!\");\r\n      // handleSubmit(assignmentId, turkSubmitTo, doc_json, summary_json)\r\n    }\r\n\r\n    useEffect(() => {\r\n      if (isFinished) {\r\n        handleSubmit(assignmentId, turkSubmitTo, doc_json, summary_json, g_completed, g_guided_annotation_history)\r\n      }\r\n    }, [isFinished]);\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // const g_SubmitHandler = (event) => {\r\n    //   alert(\"Submitted!\");\r\n    // }\r\n\r\n\r\n\r\n\r\n\r\n    /*********************************** TO SAVE THE JSONS ******************************** */ \r\n    // function export2txt(words, dir) {\r\n    //   const a = document.createElement(\"a\");\r\n    //   a.href = URL.createObjectURL(new Blob([JSON.stringify(words, null, 2)], {\r\n    //     type: \"text/plain\"\r\n    //   }));\r\n    //   a.setAttribute(\"download\", dir);\r\n    //   document.body.appendChild(a);\r\n    //   a.click();\r\n    //   document.body.removeChild(a);\r\n    // }\r\n\r\n    // useEffect(() => {\r\n    //   console.log(\"saving current values\")\r\n\r\n\r\n    //   export2txt({\"doc\":doc_json, \"summary\":summary_json, \"all_lemma_match_mtx\":all_lemma_match_mtx, \"important_lemma_match_mtx\":important_lemma_match_mtx, \"doc_paragraph_breaks\":doc_paragraph_breaks}, \"tutorial_half_way_data_for_mturk.json\")\r\n\r\n    //    // export2txt(doc_json, \"doc_json.json\")\r\n    //    // export2txt(summary_json, \"summary_json.json\")\r\n    // }, [StateMachineState]);\r\n    /*************************************************************************************** */\r\n\r\n\r\n\r\n  return (\r\n    <Router>\r\n      <div className='container-background'>\r\n        <Routes>\r\n          {/* <Route path='/' element={<StartPage />} /> */}\r\n          {/* <Route path='/homepage' element={<StartPage />} /> */}\r\n          {/* <Route path='/instructions' element={<Instructions />} /> */}\r\n          <Route path='/tutorial' element=  {<Tutorial doc_json = {t_doc_json} \r\n                                                       setDocJson = {t_setDocJson}\r\n                                                       t_start_doc_json = {t_start_doc_json} \r\n                                                       t_middle_doc_json = {t_middle_doc_json}\r\n                                                       t_sent_end_doc_json = {t_sent_end_doc_json}\r\n                                                       t_submit_doc_json = {t_submit_doc_json}\r\n                                                       summary_json = {t_summary_json} \r\n                                                       setSummaryJson = {t_setSummaryJson}\r\n                                                       t_start_summary_json = {t_start_summary_json}\r\n                                                       t_middle_summary_json = {t_middle_summary_json}\r\n                                                       t_sent_end_summary_json = {t_sent_end_summary_json}\r\n                                                       t_submit_summary_json = {t_submit_summary_json}\r\n                                                       all_lemma_match_mtx = {t_all_lemma_match_mtx} \r\n                                                       setAllLemmaMtx = {t_setAllLemmaMtx}\r\n                                                       important_lemma_match_mtx = {t_important_lemma_match_mtx} \r\n                                                       setImportantLemmaMtx = {t_setImportantLemmaMtx}\r\n                                                       doc_paragraph_breaks = {t_doc_paragraph_breaks} \r\n                                                       setDocParagraphBreaks = {t_setDocParagraphBreaks} \r\n                                                       t_state_messages = {t_state_messages}\r\n                                              />}\r\n          />\r\n\r\n          <Route path='/guidedAnnotation' element={<GuidedAnnotation\r\n                                          isPunct={isPunct} \r\n                                          handleErrorOpen={g_handleErrorOpen}                                   handleErrorClose={g_handleErrorClose}\r\n                                          doc_json={g_doc_json}                                                 setDocJson={g_setDocJson}\r\n                                          summary_json={g_summary_json}                                         setSummaryJson={g_setSummaryJson}\r\n                                          all_lemma_match_mtx={g_all_lemma_match_mtx}                           setAllLemmaMtx={g_setAllLemmaMtx}\r\n                                          important_lemma_match_mtx={g_important_lemma_match_mtx}               setImportantLemmaMtx={g_setImportantLemmaMtx}\r\n                                          doc_paragraph_breaks={g_doc_paragraph_breaks}                         setDocParagraphBreaks={g_setDocParagraphBreaks}\r\n                                          boldState={g_boldState}                                               setBoldState={g_setBoldState}\r\n                                          oldAlignmentState={g_oldAlignmentState}                               setOldAlignmentState={g_setOldAlignmentState}\r\n                                          StateMachineState={g_StateMachineState}                               SetStateMachineState={g_SetStateMachineState}\r\n                                          error_message={g_error_message}                                       setErrorMessage={g_setErrorMessage}\r\n                                          CurrSentInd={g_CurrSentInd}                                           SetCurrSentInd={g_SetCurrSentInd}\r\n                                          InfoMessage={g_InfoMessage}                                           SetInfoMessage={g_SetInfoMessage}\r\n                                          AlignmentCount={g_AlignmentCount}                                     SetAlignmentCount={g_SetAlignmentCount}\r\n                                          prevStateMachineState={g_prevStateMachineState}                       setPrevStateMachineState={g_setPrevStateMachineState}\r\n                                          prevSummarySpanHighlights={g_prevSummarySpanHighlights}               setPrevSummarySpanHighlights={g_setPrevSummarySpanHighlights}\r\n                                          prevDocSpanHighlights={g_prevDocSpanHighlights}                       setPrevDocSpanHighlights={g_setPrevDocSpanHighlights}\r\n                                          prevSummaryJsonRevise={g_prevSummaryJsonRevise}                       setPrevSummaryJsonRevise={g_setPrevSummaryJsonRevise}\r\n                                          prevDocJsonRevise={g_prevDocJsonRevise}                               setPrevDocJsonRevise={g_setPrevDocJsonRevise}\r\n                                          prevCurrSentInd={g_prevCurrSentInd}                                   setPrevCurrSentInd={g_setPrevCurrSentInd}\r\n                                          \r\n                                          \r\n                                          DocOnMouseDownID={g_DocOnMouseDownID}                                 SetDocOnMouseDownID={g_SetDocOnMouseDownID}\r\n                                          SummaryOnMouseDownID={g_SummaryOnMouseDownID}                         SetSummaryOnMouseDownID={g_SetSummaryOnMouseDownID}\r\n                                          docOnMouseDownActivated={g_docOnMouseDownActivated}                   setDocOnMouseDownActivated={g_setDocOnMouseDownActivated}\r\n                                          summaryOnMouseDownActivated={g_summaryOnMouseDownActivated}           setSummaryOnMouseDownActivated={g_setSummaryOnMouseDownActivated}\r\n                                          hoverActivatedId={g_hoverActivatedId}                                 setHoverActivatedId={g_setHoverActivatedId}\r\n                                          hoverActivatedDocOrSummary={g_hoverActivatedDocOrSummary}             setHoverActivatedDocOrSummary={g_setHoverActivatedDocOrSummary}\r\n                                          sliderBoldStateActivated={g_sliderBoldStateActivated}                 setSliderBoldStateActivated={g_setSliderBoldStateActivated}\r\n                                          guided_annotation_messages={guided_annotation_messages}               guided_annotation_info_messages={guided_annotation_info_messages}\r\n                                          guiding_msg={g_guiding_msg}                                           setGuidingMsg={g_setGuidingMsg}\r\n                                          guiding_msg_type={g_guiding_msg_type}                                 setGuidingMsgType={g_setGuidingMsgType}\r\n                                          curr_alignment_guiding_msg_id={g_curr_alignment_guiding_msg_id}       setCurrAlignmentGuidingMsgId={g_setCurrAlignmentGuidingMsgId}\r\n                                          guiding_info_msg={g_guiding_info_msg}                                 setGuidingInfoMsg={g_setGuidingInfoMsg}\r\n                                          guided_unhighlight={g_guided_unhighlight}                             setGuidedUnhighlight={g_setGuidedUnhighlight}\r\n                                          \r\n                                          \r\n                                          is_good_alignment={g_is_good_alignment}                               setIsGoodAlignment={g_setIsGoodAlignment}\r\n                                          setCompleted={g_setCompleted}                                         resetGuidedAnnotation={g_resetGuidedAnnotation}\r\n                                          g_show_hint={g_show_hint}                                             g_setShowHint={g_setShowHint}\r\n                                          g_hint_msg={g_hint_msg}                                               g_setHintMsg={g_setHintMsg} \r\n                                          guided_annotation_hints={guided_annotation_hints}                     guided_annotation_strike_messages={guided_annotation_strike_messages}\r\n                                          noAlignModalShow={g_noAlignModalShow}                                 setNoAlignModalShow={g_setNoAlignModalShow}\r\n                                          noAlignApproved={g_noAlignApproved}                                   setNoAlignApproved={g_setNoAlignApproved}\r\n                                          setOpeningModalShow={setOpeningModalShow}\r\n                                          setPrevCurrAlignmentGuidingMsgId={g_setPrevCurrAlignmentGuidingMsgId} prev_curr_alignment_guiding_msg_id={g_prev_curr_alignment_guiding_msg_id} \r\n                                          setPrevGuidingInfoMsg={g_setPrevGuidingInfoMsg}                       prev_guiding_info_msg={g_prev_guiding_info_msg}\r\n                                          setPrevGuiderMsg={g_setPrevGuiderMsg}                                 prev_Guider_msg={g_prev_Guider_msg}\r\n                                          g_guided_annotation_history={g_guided_annotation_history}             g_setGuidedAnnotationHistory={g_setGuidedAnnotationHistory}\r\n                                          g_strikes_counter={g_strikes_counter}                                 g_setStrikesCounter={g_setStrikesCounter}\r\n                                          g_answer_modal_msg={g_answer_modal_msg}                               g_setAnswerModalMsg={g_setAnswerModalMsg} \r\n                                          g_answer_words_to_glow={g_answer_words_to_glow}                       g_setAnswerWordsToGlow={g_setAnswerWordsToGlow}  \r\n                                          g_Guider_msg={g_Guider_msg}                                           g_setGuiderMsg={g_setGuiderMsg}\r\n                                          />} \r\n          \r\n          />\r\n\r\n          <Route path='/' element={<Annotation \r\n                                              isTutorial={false}                                          isGuidedAnnotation={false}                                \r\n                                              task_id={task_id}                                           doc_paragraph_breaks={doc_paragraph_breaks}\r\n                                              doc_json={doc_json}                                         setDocJson={setDocJson}                                 \r\n                                              summary_json={summary_json}                                 setSummaryJson={setSummaryJson}\r\n                                              all_lemma_match_mtx={all_lemma_match_mtx}                   important_lemma_match_mtx={important_lemma_match_mtx}   \r\n                                              StateMachineState={StateMachineState}                       SetStateMachineState={SetStateMachineState}\r\n                                              handleErrorOpen={handleErrorOpen}                           isPunct={isPunct}\r\n                                              toggleSummarySpanHighlight={toggleSummarySpanHighlight}     toggleDocSpanHighlight={toggleDocSpanHighlight}\r\n                                              boldState = {boldState}                                     boldStateHandler = {boldStateHandler}\r\n                                              SubmitHandler = {SubmitHandler}                             hoverHandler = {hoverHandler}\r\n                                              CurrSentInd = {CurrSentInd}                                 SetCurrSentInd = {SetCurrSentInd}\r\n                                              InfoMessage = {InfoMessage}                                 MachineStateHandlerWrapper = {MachineStateHandlerWrapper}\r\n                                              AlignmentCount = {AlignmentCount}                           SetAlignmentCount = {SetAlignmentCount}\r\n                                              oldAlignmentState = {oldAlignmentState}                     oldAlignmentStateHandler = {oldAlignmentStateHandler}\r\n                                              DocOnMouseDownID = {DocOnMouseDownID}                       SetDocOnMouseDownID = {SetDocOnMouseDownID}\r\n                                              SummaryOnMouseDownID = {SummaryOnMouseDownID}               SetSummaryOnMouseDownID = {SetSummaryOnMouseDownID}\r\n                                              docOnMouseDownActivated = {docOnMouseDownActivated}         setDocOnMouseDownActivated = {setDocOnMouseDownActivated}\r\n                                              summaryOnMouseDownActivated = {summaryOnMouseDownActivated} setSummaryOnMouseDownActivated = {setSummaryOnMouseDownActivated}\r\n                                              setHoverActivatedId = {setHoverActivatedId}                 setHoverActivatedDocOrSummary = {setHoverActivatedDocOrSummary}\r\n                                              hoverActivatedId = {hoverActivatedId}\r\n                                              t_StateMachineStateId = {undefined}                         t_SetStateMachineStateId = {undefined}\r\n                                              t_start_doc_json = {undefined}                              t_middle_doc_json = {undefined}\r\n                                              t_sent_end_doc_json = {undefined}                           t_submit_doc_json = {undefined}\r\n                                              t_start_summary_json = {undefined}                          t_middle_summary_json = {undefined}\r\n                                              t_sent_end_summary_json = {undefined}                       t_submit_summary_json = {undefined}\r\n                                              t_state_messages = {undefined}\r\n                                              g_guiding_info_msg = {undefined}                            g_is_good_alignment = {undefined}\r\n                                              g_show_hint = {undefined}                                   g_setShowHint = {undefined}\r\n                                              g_hint_msg = {{\"text\":\"\", \"title\":\"\"}}                      g_showWhereNavbar = {undefined}\r\n                                              g_open_hint={undefined}                                     g_setOpenHint={undefined}\r\n                                              g_with_glow_hint={undefined}                                g_setWithGlowHint={undefined}\r\n                                              g_answer_words_to_glow={{\"type\":\"\", \"ids\":[]}}              g_FinishedModalShow={undefined}\r\n                                              g_Guider_msg={{\"type\":\"\", \"where\":\"\", \"text\":\"\"}}           g_setGuiderMsg={undefined}\r\n                                              \r\n                                              OpeningModalShow = {OpeningModalShow}                       setOpeningModalShow = {setOpeningModalShow}\r\n                                              noAlignModalShow = {noAlignModalShow}                       setNoAlignModalShow = {setNoAlignModalShow}\r\n                                              noAlignApproved = {noAlignApproved}                         setNoAlignApproved = {setNoAlignApproved}\r\n                                              />} \r\n            />\r\n\r\n        </Routes>\r\n      </div>\r\n      <Snackbar open={error_message !== \"\" && !OpeningModalShow} autoHideDuration={6000} onClose={handleErrorClose}>\r\n        <Alert onClose={handleErrorClose} severity=\"error\" sx={{ width: '100%' }}>\r\n          {error_message}\r\n        </Alert>\r\n      </Snackbar>\r\n      <Snackbar open={g_error_message !== \"\"} autoHideDuration={6000} onClose={g_handleErrorClose}>\r\n        <Alert onClose={g_handleErrorClose} severity=\"error\" sx={{ width: '100%' }}>\r\n          {g_error_message}\r\n        </Alert>\r\n      </Snackbar>\r\n    </Router>\r\n  )\r\n}\r\n\r\nexport default App\r\n","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\GuidedAnnotation.js",["127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147"],[],"import { MachineStateHandler } from './Annotation_event_handlers';\r\nimport { add_text_to_GuidedAnnotationInfoAlert, string_to_span } from './GuidedAnnotation_utils'\r\n\r\nimport { useState, useEffect, useRef } from 'react'\r\nimport Annotation from './Annotation';\r\nimport Alert from 'react-bootstrap/Alert'\r\nimport Fade from 'react-bootstrap/Fade'\r\nimport { Markup } from 'interweave';\r\nimport { statSync } from 'fs';\r\nimport Modal from 'react-bootstrap/Modal'\r\nimport Button from 'react-bootstrap/Button';\r\nimport { Link } from 'react-router-dom';\r\n\r\nconst GuidedAnnotation = ({isPunct,\r\n                          handleErrorOpen, handleErrorClose,\r\n                          doc_json, setDocJson,\r\n                          summary_json, setSummaryJson,\r\n                          all_lemma_match_mtx, setAllLemmaMtx,\r\n                          important_lemma_match_mtx, setImportantLemmaMtx,\r\n                          doc_paragraph_breaks, setDocParagraphBreaks,\r\n                          boldState, setBoldState,\r\n                          oldAlignmentState, setOldAlignmentState,\r\n                          StateMachineState, SetStateMachineState,\r\n                          error_message, setErrorMessage,\r\n                          CurrSentInd, SetCurrSentInd,\r\n                          InfoMessage, SetInfoMessage,\r\n                          AlignmentCount, SetAlignmentCount,\r\n                          prevStateMachineState, setPrevStateMachineState,\r\n                          prevSummarySpanHighlights, setPrevSummarySpanHighlights,\r\n                          prevDocSpanHighlights, setPrevDocSpanHighlights,\r\n                          prevSummaryJsonRevise, setPrevSummaryJsonRevise,\r\n                          prevDocJsonRevise, setPrevDocJsonRevise,\r\n                          prevCurrSentInd, setPrevCurrSentInd,\r\n                          DocOnMouseDownID, SetDocOnMouseDownID,\r\n                          SummaryOnMouseDownID, SetSummaryOnMouseDownID,\r\n                          docOnMouseDownActivated, setDocOnMouseDownActivated,\r\n                          summaryOnMouseDownActivated, setSummaryOnMouseDownActivated,\r\n                          hoverActivatedId, setHoverActivatedId,\r\n                          hoverActivatedDocOrSummary, setHoverActivatedDocOrSummary,\r\n                          sliderBoldStateActivated, setSliderBoldStateActivated,\r\n                          guided_annotation_messages, guided_annotation_info_messages,\r\n                          guiding_msg, setGuidingMsg,\r\n                          guiding_msg_type, setGuidingMsgType,\r\n                          curr_alignment_guiding_msg_id, setCurrAlignmentGuidingMsgId,\r\n                          guiding_info_msg, setGuidingInfoMsg,\r\n                          guided_unhighlight, setGuidedUnhighlight,\r\n                          is_good_alignment, setIsGoodAlignment,\r\n                          setCompleted, resetGuidedAnnotation,\r\n                          g_show_hint, g_setShowHint,\r\n                          g_hint_msg, g_setHintMsg, \r\n                          guided_annotation_hints, guided_annotation_strike_messages,\r\n                          noAlignModalShow, setNoAlignModalShow,\r\n                          noAlignApproved, setNoAlignApproved,\r\n                          setOpeningModalShow,\r\n                          setPrevCurrAlignmentGuidingMsgId, prev_curr_alignment_guiding_msg_id,\r\n                          setPrevGuidingInfoMsg, prev_guiding_info_msg,\r\n                          setPrevGuiderMsg, prev_Guider_msg,\r\n                          g_guided_annotation_history, g_setGuidedAnnotationHistory,\r\n                          g_strikes_counter, g_setStrikesCounter,\r\n                          g_answer_modal_msg, g_setAnswerModalMsg,\r\n                          g_answer_words_to_glow, g_setAnswerWordsToGlow,\r\n                          g_Guider_msg, g_setGuiderMsg\r\n\r\n                        }) => {\r\n    const MAX_ERR_CNT = 3 // number of maximum permitted wrong attempts before giving the answer \r\n    const [FinishedModalShow, setFinishedModalShow] = useState(false);\r\n    const [showWhereNavbar, setShowWhereNavbar] = useState(false);\r\n    const [g_open_hint, g_setOpenHint] = useState(false)\r\n    const [g_with_glow_hint, g_setWithGlowHint] = useState(false)\r\n    \r\n\r\n    \r\n    const update_guiding_msg = (new_msg_type, msg_json) => {\r\n      // message didn't close before new message and they are of the same kind (so someone might miss the change)\r\n      if(guiding_msg_type === new_msg_type){\r\n        setGuidingMsgType(\"closed\")\r\n        window.setTimeout(()=>{setGuidingMsgType(new_msg_type);setGuidingMsg(msg_json);},50)\r\n      }\r\n      else {\r\n        setGuidingMsgType(new_msg_type);\r\n        setGuidingMsg(msg_json);\r\n      }\r\n    }\r\n\r\n\r\n\r\n\r\n    \r\n    const toggleDocSpanHighlight = ({tkn_ids, turn_on, turn_off}) => {\r\n      if (tkn_ids.length===0) {\r\n        return\r\n      }\r\n\r\n      const isSummarySpanOkDict = isSummarySpanOk([], false, false)\r\n      \r\n      if(!isSummarySpanOkDict[\"summary_span_ok\"] && StateMachineState !== \"REVISE HOVER\") {\r\n        if (isSummarySpanOkDict[\"highlighted_tkn_ids\"].length===0) { // nothing highlighted in summary\r\n          // setGuidingMsg(guided_annotation_messages[\"empty_summary_span_msg\"])\r\n          // setGuidingMsgType(\"danger\")\r\n\r\n          update_guiding_msg(\"danger\", guided_annotation_messages[\"empty_summary_span_msg\"])\r\n          g_setGuidedAnnotationHistory(g_guided_annotation_history.concat([{\"status\":\"error\", \"sent_id\":CurrSentInd, \"type\":\"summary_span\", \"problem\":\"short\", \"chosen_span_id\":\"-1\", \"highlighted_tkn_ids\":isSummarySpanOkDict[\"highlighted_tkn_ids\"], \"gold_tkn_ids\":[]}]))\r\n          \r\n          g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n          g_setShowHint(false)\r\n        } else if (isSummarySpanOkDict[\"chosen_span_id\"]===undefined){\r\n          // setGuidingMsg(guided_annotation_messages[\"default_too_short_summary_msg\"])\r\n          // setGuidingMsgType(\"danger\")\r\n\r\n          update_guiding_msg(\"danger\", guided_annotation_messages[\"default_too_short_summary_msg\"])\r\n          g_setGuidedAnnotationHistory(g_guided_annotation_history.concat([{\"status\":\"error\", \"sent_id\":CurrSentInd, \"type\":\"summary_span\", \"problem\":\"short\", \"chosen_span_id\":\"-1\", \"highlighted_tkn_ids\":isSummarySpanOkDict[\"highlighted_tkn_ids\"], \"gold_tkn_ids\":[]}]))\r\n\r\n          g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n          g_setShowHint(false)\r\n        } else {\r\n          let gold_tkns = guided_annotation_messages[\"goldMentions\"][CurrSentInd][\"good_summary_spans\"][isSummarySpanOkDict[\"chosen_span_id\"]]\r\n          gold_tkns = gold_tkns.map((span) => {return string_to_span(span)})\r\n          update_error_message(gold_tkns, isSummarySpanOkDict[\"highlighted_tkn_ids\"], isSummarySpanOkDict[\"chosen_span_id\"], false)\r\n        }\r\n        return\r\n      }\r\n\r\n      const isAlignmentOkDict = isAlignmentOk(tkn_ids, turn_on, turn_off);\r\n      if (isAlignmentOkDict[\"alignment_ok\"] && StateMachineState !== \"REVISE HOVER\") {\r\n        if (Object.keys(guided_annotation_messages[\"goldMentions\"][CurrSentInd][\"good_alignment_msg\"][curr_alignment_guiding_msg_id]).includes(\"text\")) {\r\n          // setGuidingMsg(guided_annotation_messages[\"goldMentions\"][CurrSentInd][\"good_alignment_msg\"][curr_alignment_guiding_msg_id])\r\n          update_guiding_msg(\"success\", guided_annotation_messages[\"goldMentions\"][CurrSentInd][\"good_alignment_msg\"][curr_alignment_guiding_msg_id])\r\n          setGuidingInfoMsg(guided_annotation_messages[\"goldMentions\"][CurrSentInd][\"good_alignment_msg\"][curr_alignment_guiding_msg_id])\r\n        } else {\r\n          // setGuidingMsg(guided_annotation_messages[\"default_good_alignment_msg\"])\r\n          update_guiding_msg(\"success\", guided_annotation_messages[\"default_good_alignment_msg\"])\r\n          setGuidingInfoMsg(guided_annotation_messages[\"default_good_alignment_msg\"])\r\n        }\r\n        // setGuidingMsgType(\"success\");\r\n        g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n        g_setShowHint(false);\r\n        g_setGuidedAnnotationHistory(g_guided_annotation_history.concat([{\"status\":\"success\", \"sent_id\":CurrSentInd, \"type\":\"doc_span\", \"chosen_span_id\":curr_alignment_guiding_msg_id, \"highlighted_tkn_ids\":isSummarySpanOkDict[\"highlighted_tkn_ids\"]}]))\r\n        // setIsGoodAlignment(true);\r\n      }\r\n      else if (StateMachineState !== \"REVISE HOVER\") {\r\n        // updating the info message\r\n        if (Object.keys(guided_annotation_info_messages[\"custom_messages\"][CurrSentInd][\"find_alignment\"][curr_alignment_guiding_msg_id]).includes(\"text\")) {\r\n          setGuidingInfoMsg(guided_annotation_info_messages[\"custom_messages\"][CurrSentInd][\"find_alignment\"][curr_alignment_guiding_msg_id])\r\n          if(g_Guider_msg[\"type\"]!==\"reveal-answer\"){\r\n            g_setGuiderMsg({\"type\":\"info\", \"where\":\"doc\", \"text\":guided_annotation_info_messages[\"custom_messages\"][CurrSentInd][\"find_alignment\"][curr_alignment_guiding_msg_id][\"text\"]})\r\n          }\r\n        } else {\r\n          setGuidingInfoMsg(guided_annotation_info_messages[\"default_find_alignment\"])\r\n          if(g_Guider_msg[\"type\"]!==\"reveal-answer\"){\r\n            g_setGuiderMsg({\"type\":\"info\", \"where\":\"doc\", \"text\":guided_annotation_info_messages[\"default_find_alignment\"][\"text\"]})\r\n          }\r\n        }\r\n      } \r\n\r\n\r\n      setSliderBoldStateActivated(false)\r\n      if (turn_on){\r\n        setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: true } : word))\r\n      } else if (turn_off){\r\n          setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: false,  span_alignment_hover:false } : word))\r\n      } else {\r\n        setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: !word.span_highlighted } : word))\r\n      }\r\n    }\r\n  \r\n    toggleDocSpanHighlight.defaultProps = {\r\n      turn_on: false,\r\n      turn_off: false\r\n    }\r\n  \r\n  \r\n    \r\n  \r\n    const toggleSummarySpanHighlight = ({tkn_ids, turn_on, turn_off}) => {\r\n       // if no change was done to the summary - no need to update\r\n      if(tkn_ids.length===0) {\r\n        return\r\n      }\r\n\r\n      const isSummarySpanOkDict = isSummarySpanOk(tkn_ids, turn_on, turn_off)\r\n      if(isSummarySpanOkDict[\"summary_span_ok\"]) {\r\n        // updating the success alert\r\n        if (Object.keys(guided_annotation_messages[\"goldMentions\"][CurrSentInd][\"good_summary_span_msg\"][isSummarySpanOkDict[\"chosen_span_id\"]]).includes(\"text\")) {\r\n          // setGuidingMsg(guided_annotation_messages[\"goldMentions\"][CurrSentInd][\"good_summary_span_msg\"][isSummarySpanOkDict[\"chosen_span_id\"]])\r\n          update_guiding_msg(\"success\", guided_annotation_messages[\"goldMentions\"][CurrSentInd][\"good_summary_span_msg\"][isSummarySpanOkDict[\"chosen_span_id\"]])\r\n\r\n        } else {\r\n          // setGuidingMsg(guided_annotation_messages[\"default_good_summary_span_msg\"]) \r\n          update_guiding_msg(\"success\", guided_annotation_messages[\"default_good_summary_span_msg\"])\r\n\r\n        }\r\n        // setGuidingMsgType(\"success\");\r\n        g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n        g_setShowHint(false);\r\n        g_setGuidedAnnotationHistory(g_guided_annotation_history.concat([{\"status\":\"success\", \"sent_id\":CurrSentInd, \"type\":\"summary_span\", \"chosen_span_id\":isSummarySpanOkDict[\"chosen_span_id\"], \"highlighted_tkn_ids\":isSummarySpanOkDict[\"highlighted_tkn_ids\"]}]))\r\n        setCurrAlignmentGuidingMsgId(isSummarySpanOkDict[\"chosen_span_id\"])\r\n\r\n\r\n        // updating the info message\r\n        // console.log(`CurrSentInd:${CurrSentInd}`)\r\n        if (Object.keys(guided_annotation_info_messages[\"custom_messages\"][CurrSentInd][\"find_alignment\"][isSummarySpanOkDict[\"chosen_span_id\"]]).includes(\"text\")) {\r\n          setGuidingInfoMsg(guided_annotation_info_messages[\"custom_messages\"][CurrSentInd][\"find_alignment\"][isSummarySpanOkDict[\"chosen_span_id\"]])\r\n          g_setGuiderMsg({\"type\":\"info\", \"where\":\"doc\", \"text\":guided_annotation_info_messages[\"custom_messages\"][CurrSentInd][\"find_alignment\"][isSummarySpanOkDict[\"chosen_span_id\"]][\"text\"]})\r\n        } else {\r\n          setGuidingInfoMsg(guided_annotation_info_messages[\"default_find_alignment\"])\r\n          g_setGuiderMsg({\"type\":\"info\", \"where\":\"doc\", \"text\":guided_annotation_info_messages[\"default_find_alignment\"][\"text\"]})\r\n        }\r\n      } \r\n      else {\r\n        // updating the info message\r\n        const guiding_info_sent_id = ([\"START\", \"SENTENCE END\"].includes(StateMachineState)) ? CurrSentInd+1 : CurrSentInd\r\n        if (Object.keys(guided_annotation_info_messages[\"custom_messages\"][guiding_info_sent_id][\"choose_summary_span\"]).includes(\"text\")) {\r\n          setGuidingInfoMsg(guided_annotation_info_messages[\"custom_messages\"][guiding_info_sent_id][\"choose_summary_span\"])\r\n          if(g_Guider_msg[\"type\"]!==\"reveal-answer\"){\r\n            g_setGuiderMsg({\"type\":\"info\", \"where\":\"summary\", \"text\":guided_annotation_info_messages[\"custom_messages\"][guiding_info_sent_id][\"choose_summary_span\"][\"text\"]})\r\n          }\r\n        } else {\r\n          setGuidingInfoMsg(guided_annotation_info_messages[\"default_choose_summary_span\"])\r\n          if(g_Guider_msg[\"type\"]!==\"reveal-answer\"){\r\n            g_setGuiderMsg({\"type\":\"info\", \"where\":\"summary\", \"text\":guided_annotation_info_messages[\"default_choose_summary_span\"][\"text\"]})\r\n          }\r\n        }\r\n\r\n        // if the span/alignment were good - updating it.\r\n        setIsGoodAlignment(false)\r\n        setCurrAlignmentGuidingMsgId(\"-1\")\r\n      }\r\n\r\n\r\n      setSliderBoldStateActivated(false)\r\n      if (turn_on){\r\n        setSummaryJson(summary_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: true } : word));\r\n      } else if (turn_off){\r\n        setSummaryJson(summary_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: false,  span_alignment_hover:false } : word));\r\n      } else {\r\n        setSummaryJson(summary_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: !word.span_highlighted } : word));\r\n      }\r\n    }\r\n  \r\n    toggleSummarySpanHighlight.defaultProps = {\r\n      turn_on: false,\r\n      turn_off: false\r\n    }\r\n  \r\n    const approveHighlightHandler = () => {\r\n      const doc_tkn_ids = doc_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id});\r\n      setDocJson(doc_json.map((word) => doc_tkn_ids.includes(word.tkn_id) ? { ...word, all_highlighted: true, alignment_id: [...word.alignment_id, AlignmentCount], span_highlighted: false } : word));\r\n  \r\n  \r\n      const summary_tkn_ids = summary_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id});\r\n      setSummaryJson(summary_json.map((word) => summary_tkn_ids.includes(word.tkn_id) ? { ...word, all_highlighted: true, alignment_id: [...word.alignment_id, AlignmentCount], span_highlighted: false } : word));    \r\n   \r\n    }\r\n  \r\n    const StartReviseStateHandler = (isBackBtn) => {\r\n      if (isBackBtn){\r\n        setDocJson(doc_json.map((word, ind) => {return {...word, all_highlighted: prevDocJsonRevise[ind].all_highlighted, span_highlighted: prevDocJsonRevise[ind].span_highlighted, alignment_id: prevDocJsonRevise[ind].alignment_id}}))\r\n        setSummaryJson(summary_json.map((word, ind) => {return {...word, all_highlighted: prevSummaryJsonRevise[ind].all_highlighted, span_highlighted: prevSummaryJsonRevise[ind].span_highlighted, alignment_id: prevSummaryJsonRevise[ind].alignment_id}}))\r\n      } else{\r\n        setPrevStateMachineState(StateMachineState);\r\n        setPrevDocSpanHighlights(doc_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id}));\r\n        setPrevSummarySpanHighlights(summary_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id}));\r\n        setPrevCurrSentInd(CurrSentInd)\r\n        setPrevCurrAlignmentGuidingMsgId(curr_alignment_guiding_msg_id)\r\n        setPrevGuidingInfoMsg(guiding_info_msg)\r\n        setPrevGuiderMsg(g_Guider_msg)\r\n\r\n\r\n        setDocJson(doc_json.map((word) => {return {...word, span_highlighted: false}}))\r\n        setSummaryJson(summary_json.map((word) => {return {...word, span_highlighted: false}}))\r\n      }\r\n      SetCurrSentInd(-1)\r\n    }\r\n  \r\n    const ExitReviseHandler = () => {\r\n      setDocJson(doc_json.map((word, ind) => prevDocSpanHighlights.includes(word.tkn_id) ? {...word, span_highlighted: true}:{...word, span_highlighted: false}))\r\n      setSummaryJson(summary_json.map((word, ind) => prevSummarySpanHighlights.includes(word.tkn_id) ? {...word, span_highlighted: true}:{...word, span_highlighted: false}))               \r\n      const prev_state = prevStateMachineState;\r\n      SetStateMachineState(prevStateMachineState);\r\n      \r\n      const prev_current_sent_id = prevCurrSentInd\r\n      SetCurrSentInd(prev_current_sent_id)\r\n      \r\n      const prev_guiding_msg_id = prev_curr_alignment_guiding_msg_id\r\n      setCurrAlignmentGuidingMsgId(prev_guiding_msg_id) \r\n\r\n      setGuidingInfoMsg(prev_guiding_info_msg)\r\n      g_setGuiderMsg(prev_Guider_msg)\r\n      g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n      setPrevCurrAlignmentGuidingMsgId(\"-1\")\r\n      setPrevCurrSentInd(-1)\r\n      setPrevStateMachineState(\"\");\r\n      setPrevSummarySpanHighlights([]);\r\n      setPrevDocSpanHighlights([]);\r\n      return prev_state\r\n    }\r\n  \r\n    const RemoveAlignmentId = (word, chosen_align_id) => {\r\n      const new_alignment_id = word.alignment_id.filter((elem) => {return elem !== chosen_align_id});\r\n      return new_alignment_id;\r\n    }\r\n  \r\n    const ReviseChooseAlignHandler = (clickedWordInfo) => {\r\n      setPrevSummaryJsonRevise(summary_json);\r\n      setPrevDocJsonRevise(doc_json);\r\n  \r\n      const chosen_align_id = (clickedWordInfo[0] === 'doc') ? doc_json.filter((word) => {return word.tkn_id === clickedWordInfo[1]})[0].alignment_id[0] : \r\n      summary_json.filter((word) => {return word.tkn_id === clickedWordInfo[1]})[0].alignment_id[0]\r\n  \r\n      setSummaryJson(summary_json.map((word) => word.alignment_id.includes(chosen_align_id) ? {...word, span_highlighted: true, all_highlighted: false, old_alignments: false, old_alignment_hover:false, alignment_id: RemoveAlignmentId(word, chosen_align_id)} : {...word, span_highlighted: false}))\r\n      setDocJson(doc_json.map((word) => word.alignment_id.includes(chosen_align_id) ? {...word, span_highlighted: true, all_highlighted: false, old_alignments: false, old_alignment_hover:false, alignment_id: RemoveAlignmentId(word, chosen_align_id)} : {...word, span_highlighted: false}))\r\n    \r\n      const chosen_align_currSentId = summary_json.filter((word) => {return word.alignment_id.includes(chosen_align_id)})[0].sent_id\r\n      SetCurrSentInd(chosen_align_currSentId)  \r\n\r\n\r\n\r\n      \r\n      \r\n      const gold_mentions = guided_annotation_messages[\"goldMentions\"][chosen_align_currSentId]\r\n\r\n      let highlighted_tkn_ids = summary_json.filter((word) => {return word.alignment_id.includes(chosen_align_id)}).map((word) => {return word.tkn_id})\r\n      highlighted_tkn_ids = highlighted_tkn_ids.filter((tkn_id) => {return !isPunct(summary_json.filter((word) => {return word.tkn_id===tkn_id})[0].word)}) // ignore punctuation  \r\n      highlighted_tkn_ids = highlighted_tkn_ids.sort(function(a, b) {return a - b;}) // order    \r\n      let chosen_span_id = Object.keys(gold_mentions[\"span_indicating_tkns\"]).filter((key) => {return gold_mentions[\"span_indicating_tkns\"][key].some((span) => hasSubArray(highlighted_tkn_ids, string_to_span(span)))})\r\n      if(chosen_span_id.length===0){\r\n        console.log(\"zero!!!\")\r\n      }\r\n      setCurrAlignmentGuidingMsgId(chosen_span_id[0])\r\n      \r\n      \r\n      // console.log(`AVIVSL:${JSON.stringify(chosen_span_id)}`)\r\n      // setPrevCurrAlignmentGuidingMsgId, prev_curr_alignment_guiding_msg_id\r\n\r\n\r\n\r\n    }\r\n  \r\n  \r\n    const SetSummaryShadow = (sent_id) => {\r\n      setSummaryJson(summary_json.map((word) => word.sent_id === sent_id ? { ...word, shadowed: true } : { ...word, shadowed: false }))\r\n    }\r\n  \r\n  \r\n    const SetSummaryShadowAndUpdateHighlights = (sent_id) => {\r\n      setSummaryJson(\r\n        summary_json.map((word) => word.sent_id === sent_id ? { ...word, shadowed: true } : { ...word, shadowed: false }).map(\r\n        (word) => word.span_highlighted ? {...word, span_highlighted: false, all_highlighted:true} : word)\r\n        )\r\n    }\r\n  \r\n    const SetDocBoldface = (tkn_ids) => {\r\n      setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, boldfaced: true } : { ...word, boldfaced: false }))\r\n    }\r\n  \r\n  \r\n  \r\n  \r\n    const checkIfLemmasMatch = ({doc_id, summary_ids, isHover}) => {\r\n      const which_match_mtx = important_lemma_match_mtx;\r\n      const matching_summary_ids = summary_ids.filter((summary_id) => {return all_lemma_match_mtx[doc_id][summary_id] === 1;})\r\n      return matching_summary_ids.length > 0\r\n    }\r\n  \r\n    const boldStateHandler = (event, newValue) => {\r\n      if (event !== undefined){\r\n        setSliderBoldStateActivated(true)\r\n      }\r\n      if (newValue=='1'){\r\n        setBoldState(\"none\");\r\n        SetDocBoldface([]);\r\n      } else if (newValue=='2'){\r\n        setBoldState(\"span\");\r\n        const summary_ids = summary_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id});\r\n        const isSpan = true;\r\n        const tkn_ids = doc_json.map((word) => {return word.tkn_id}).filter((doc_id) => {return checkIfLemmasMatch({doc_id:doc_id, summary_ids:summary_ids, isHover:false})});\r\n        SetDocBoldface(tkn_ids);\r\n      } else {\r\n        setBoldState(\"sent\");\r\n        const isSpan = false;\r\n        const summary_ids = summary_json.filter((word) => {return word.shadowed}).map((word) => {return word.tkn_id});\r\n        const tkn_ids = doc_json.map((word) => {return word.tkn_id}).filter((doc_id) => {return checkIfLemmasMatch({doc_id:doc_id, summary_ids:summary_ids, isHover:false})});\r\n        SetDocBoldface(tkn_ids);\r\n      }\r\n    }\r\n  \r\n  \r\n    const SetDocOldHighlights = (tkn_ids) => {\r\n      setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, old_alignments: true } : { ...word, old_alignments: false }))\r\n    }\r\n  \r\n    const SetSummaryOldHighlights = (tkn_ids) => {\r\n      setSummaryJson(summary_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, old_alignments: true } : { ...word, old_alignments: false }))\r\n    }\r\n  \r\n    const FindDocAlignmentPerSent = (sent_ind) => {\r\n      let curr_sent_alignment_ids = summary_json.map((word) => {return (word.sent_id===sent_ind) ? word.alignment_id : []});\r\n      curr_sent_alignment_ids = [].concat.apply([], curr_sent_alignment_ids); // merge into a single array (before was an array of arrays)\r\n      const doc_ids = doc_json.filter((word) => {return word.alignment_id.some(r=> curr_sent_alignment_ids.includes(r))}).map((word) => {return word.tkn_id});\r\n      return doc_ids\r\n    }\r\n  \r\n  \r\n    const oldAlignmentStateHandler = ({event, newValue, sent_ind}) => {\r\n  \r\n      if (newValue=='1'){\r\n        setOldAlignmentState(\"none\");\r\n        SetDocOldHighlights([]);\r\n        SetSummaryOldHighlights([]);\r\n      } else if (newValue=='2'){\r\n        setOldAlignmentState(\"sent\");\r\n        sent_ind = (sent_ind===-1) ? CurrSentInd : sent_ind\r\n        const doc_ids = FindDocAlignmentPerSent(sent_ind)\r\n        const summary_ids = summary_json.filter((word) => {return (word.all_highlighted && word.sent_id === sent_ind)}).map((word) => {return word.tkn_id});\r\n        SetDocOldHighlights(doc_ids);\r\n        SetSummaryOldHighlights(summary_ids);\r\n      } else {\r\n        setOldAlignmentState(\"all\");\r\n        const doc_ids = doc_json.filter((word) => {return word.all_highlighted}).map((word) => {return word.tkn_id});\r\n        const summary_ids = summary_json.filter((word) => {return word.all_highlighted}).map((word) => {return word.tkn_id});\r\n        SetDocOldHighlights(doc_ids);\r\n        SetSummaryOldHighlights(summary_ids);\r\n      }\r\n    }\r\n  \r\n    oldAlignmentStateHandler.defaultProps = {\r\n      sent_ind: -1\r\n    }\r\n  \r\n  \r\n  \r\n    const hoverHandler = ({inOrOut, curr_alignment_id, tkn_id, isSummary}) => {\r\n      // onMouseEnter for \"REVISE HOVER\"\r\n      if (inOrOut === \"in\" && StateMachineState===\"REVISE HOVER\") { \r\n        setDocJson(doc_json.map((word) => word.alignment_id.includes(curr_alignment_id) ? {...word, old_alignment_hover: true} : {...word, old_alignment_hover: false}))\r\n        setSummaryJson(summary_json.map((word) => word.alignment_id.includes(curr_alignment_id) ? {...word, old_alignment_hover: true} : {...word, old_alignment_hover: false}))\r\n      } \r\n      // onMouseLeave for \"REVISE HOVER\"\r\n      else if (inOrOut === \"out\" && StateMachineState===\"REVISE HOVER\") { \r\n        setDocJson(doc_json.map((word) => {return {...word, old_alignment_hover:false}}))\r\n        setSummaryJson(summary_json.map((word) => {return {...word, old_alignment_hover:false}}))\r\n      }\r\n      // onMouseLeave for all the alignments choosing states\r\n      else if (inOrOut === \"out\" && [\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState) && isSummary) { \r\n        setDocJson(doc_json.map((word) => {return {...word, red_color:false}}))\r\n      }\r\n  \r\n    }\r\n  \r\n    const isRedLettered = (summary_tkn_id) => {\r\n      if ((StateMachineState === \"REVISE CLICKED\") && (summary_json.filter((word) => {return word.tkn_id === summary_tkn_id && word.sent_id > CurrSentInd}).length !== 0)){\r\n        return false\r\n      } else if ((summary_json.filter((word) => {return word.tkn_id === summary_tkn_id && word.sent_id !== CurrSentInd}).length !== 0) && !([\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState))) {\r\n        return false\r\n      } else if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState)) {\r\n        return true\r\n      }\r\n  \r\n    }\r\n  \r\n  \r\n  \r\n    const MachineStateHandlerWrapper = ({clickedWordInfo, forceState, isBackBtn}) => {\r\n      // no alignment\r\n      if ((typeof forceState !== 'string') && (StateMachineState !== \"REVISE HOVER\") && (doc_json.filter((word) => {return word.span_highlighted}).length === 0) && (StateMachineState!==\"START\") && !noAlignApproved) {\r\n        setNoAlignModalShow(true)\r\n        return\r\n      }\r\n      setNoAlignApproved(false)\r\n\r\n\r\n\r\n\r\n      if((forceState === undefined)  && ![\"REVISE HOVER\", \"START\", \"SENTENCE START\"].includes(StateMachineState)) {\r\n        // check if span is ok\r\n        const isSummarySpanOkDict = isSummarySpanOk([], false, false)\r\n        // console.log(`state: ${StateMachineState} and ${JSON.stringify(isSummarySpanOkDict)}`)\r\n        if(!isSummarySpanOkDict[\"summary_span_ok\"]) {\r\n          if (isSummarySpanOkDict[\"highlighted_tkn_ids\"].length===0 && StateMachineState !== \"REVISE HOVER\") { // nothing highlighted in summary\r\n            // setGuidingMsg(guided_annotation_messages[\"empty_summary_span_msg\"])\r\n            // setGuidingMsgType(\"danger\")\r\n            update_guiding_msg(\"danger\", guided_annotation_messages[\"empty_summary_span_msg\"])\r\n            g_setGuidedAnnotationHistory(g_guided_annotation_history.concat([{\"status\":\"error\", \"sent_id\":CurrSentInd, \"type\":\"summary_span\", \"problem\":\"short\", \"chosen_span_id\":\"-1\", \"highlighted_tkn_ids\":isSummarySpanOkDict[\"highlighted_tkn_ids\"], \"gold_tkn_ids\":[]}]))\r\n\r\n          } else if (isSummarySpanOkDict[\"chosen_span_id\"]===undefined){\r\n            // setGuidingMsg(guided_annotation_messages[\"default_too_short_summary_msg\"])\r\n            // setGuidingMsgType(\"danger\")\r\n            update_guiding_msg(\"danger\", guided_annotation_messages[\"default_too_short_summary_msg\"])\r\n            g_setGuidedAnnotationHistory(g_guided_annotation_history.concat([{\"status\":\"error\", \"sent_id\":CurrSentInd, \"type\":\"summary_span\", \"problem\":\"short\", \"chosen_span_id\":\"-1\", \"highlighted_tkn_ids\":isSummarySpanOkDict[\"highlighted_tkn_ids\"], \"gold_tkn_ids\":[]}]))\r\n            g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n            g_setShowHint(false)\r\n          } else {\r\n            let gold_tkns = guided_annotation_messages[\"goldMentions\"][CurrSentInd][\"good_summary_spans\"][isSummarySpanOkDict[\"chosen_span_id\"]]\r\n            gold_tkns = gold_tkns.map((span) => {return string_to_span(span)})\r\n            update_error_message(gold_tkns, isSummarySpanOkDict[\"highlighted_tkn_ids\"], isSummarySpanOkDict[\"chosen_span_id\"], false)\r\n          }\r\n          return\r\n        }\r\n      }\r\n      \r\n      // check if alignment is good\r\n      if (forceState === undefined && ![\"START\", \"REVISE HOVER\"].includes(StateMachineState)) { \r\n        const isAlignmentOkDict = isAlignmentOk();\r\n        if (isAlignmentOkDict[\"alignment_ok\"]) {\r\n          // setGuidingMsg(guided_annotation_messages[\"default_good_alignment_msg\"]) // AVIVSL: add custom success messages\r\n          // setGuidingMsgType(\"success\");\r\n          setCurrAlignmentGuidingMsgId(\"-1\");\r\n          g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n          g_setShowHint(false);\r\n        } else {\r\n          update_error_message(isAlignmentOkDict[\"gold_align_tkns\"], isAlignmentOkDict[\"highlighted_doc_tkns\"], curr_alignment_guiding_msg_id, true);\r\n          return\r\n        }\r\n      }\r\n\r\n      // check if span is ok (for the case when the summary span was changed after the alignment was approved)\r\n      if (forceState === undefined && ![\"START\", \"REVISE HOVER\"].includes(StateMachineState)) { \r\n        const isSummarySpanOkDict = isSummarySpanOk([], false, false)\r\n      \r\n        if(!isSummarySpanOkDict[\"summary_span_ok\"]) {\r\n          // setGuidingMsg({\"text\":\"Summary highlighting was changed and is not aligned to the document highlighting anymore.\", \"title\":\"Summary highlighting changed and is not good\"})\r\n          // setGuidingMsgType(\"danger\")\r\n          update_guiding_msg(\"danger\", {\"text\":\"Summary highlighting was changed and is not aligned to the document highlighting anymore.\", \"title\":\"Summary highlighting changed and is not good\"})\r\n\r\n          return\r\n        }\r\n\r\n\r\n\r\n      }\r\n\r\n\r\n      // info messages(alerts)\r\n      if (forceState===\"REVISE HOVER\" && StateMachineState!==\"REVISE CLICKED\"){\r\n        setGuidingInfoMsg(guided_annotation_info_messages[\"Revise Hover\"])\r\n        g_setGuiderMsg({\"type\":\"\", \"where\":\"\", \"text\":\"\"})\r\n      } \r\n      else if (forceState===undefined && StateMachineState===\"REVISE HOVER\") {\r\n        setGuidingInfoMsg(guided_annotation_info_messages[\"Revise Clicked\"])\r\n        g_setGuiderMsg({\"type\":\"\", \"where\":\"\", \"text\":\"\"})\r\n      }\r\n      else if (forceState===undefined && StateMachineState===\"REVISE CLICKED\") {\r\n        setGuidingInfoMsg(guided_annotation_info_messages[\"Revise Confirmed Revision\"])\r\n        g_setGuiderMsg({\"type\":\"\", \"where\":\"\", \"text\":\"\"})\r\n      }\r\n      else if (forceState===\"REVISE HOVER\" && StateMachineState===\"REVISE CLICKED\") {\r\n        setGuidingInfoMsg(guided_annotation_info_messages[\"Revise Clicked BACK\"])\r\n        g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n        g_setShowHint(false)\r\n        g_setGuiderMsg({\"type\":\"\", \"where\":\"\", \"text\":\"\"})\r\n      }\r\n      else if (forceState===undefined) {\r\n        const guiding_info_sent_id = ([\"START\", \"SENTENCE END\"].includes(StateMachineState)) ? CurrSentInd+1 : CurrSentInd\r\n        if (Object.keys(guided_annotation_info_messages[\"custom_messages\"][guiding_info_sent_id][\"choose_summary_span\"]).includes(\"text\")) {\r\n          setGuidingInfoMsg(guided_annotation_info_messages[\"custom_messages\"][guiding_info_sent_id][\"choose_summary_span\"])\r\n          g_setGuiderMsg({\"type\":\"info\", \"where\":\"summary\", \"text\":guided_annotation_info_messages[\"custom_messages\"][guiding_info_sent_id][\"choose_summary_span\"][\"text\"]})\r\n        } else {\r\n          setGuidingInfoMsg(guided_annotation_info_messages[\"default_choose_summary_span\"])\r\n          g_setGuiderMsg({\"type\":\"info\", \"where\":\"summary\", \"text\":guided_annotation_info_messages[\"default_choose_summary_span\"][\"text\"]})\r\n        }\r\n      }\r\n      //returning to alignment not being ok (because no alignment)\r\n      setIsGoodAlignment(false)\r\n\r\n      // updating the state (if there is no alignment error)\r\n      setSliderBoldStateActivated(false);\r\n      MachineStateHandler(summary_json,\r\n                            StateMachineState, SetStateMachineState,\r\n                            SetInfoMessage, handleErrorOpen, isPunct,\r\n                            CurrSentInd, SetCurrSentInd, SetSummaryShadow,\r\n                            AlignmentCount, SetAlignmentCount,\r\n                            approveHighlightHandler,\r\n                            clickedWordInfo, forceState, \r\n                            StartReviseStateHandler, ExitReviseHandler,\r\n                            ReviseChooseAlignHandler, \r\n                            isBackBtn,\r\n                            setPrevSummaryJsonRevise, setPrevDocJsonRevise,\r\n                           );\r\n    }\r\n  \r\n    MachineStateHandlerWrapper.defaultProps = {\r\n      forceState: '',\r\n      clickedWordInfo: [],\r\n      isBackBtn: false\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n    /**************************** GUIDING-RELATED FUNCTIONS ******************************/\r\n\r\n    // const string_to_span = (span_str) => {\r\n    //   const sub_strings = span_str.split(\";\");\r\n    //   const lims = sub_strings.map((sub_string) => sub_string.split(\"-\").map((lim) => parseInt(lim)))\r\n    //   // console.log(`lims:${JSON.stringify(span_str)}`)\r\n    //   const ids = lims.map(([start, end]) => Array(end - start + 1).fill().map((_, idx) => start + idx)).flat(1)\r\n    //   return ids.sort(function(a, b) {return a - b;})\r\n    // }\r\n\r\n    const intersection = (arr1, arr2) => {\r\n      return arr1.filter((elem) => {return arr2.includes(elem)})\r\n    }\r\n\r\n\r\n    const isSummarySpanOk = (tkn_ids, turn_on, turn_off) => {\r\n\r\n      const gold_mentions = guided_annotation_messages[\"goldMentions\"][CurrSentInd]\r\n\r\n      let highlighted_tkn_ids = summary_json.filter((word) => {return word.span_highlighted}).map((word) => word.tkn_id)\r\n      highlighted_tkn_ids = (turn_on) ? highlighted_tkn_ids.concat(tkn_ids) : highlighted_tkn_ids\r\n      highlighted_tkn_ids = (turn_off) ? highlighted_tkn_ids.filter((tkn) => {return (turn_off && !tkn_ids.includes(tkn))}) : highlighted_tkn_ids\r\n      highlighted_tkn_ids = [...new Set(highlighted_tkn_ids)] // remove duplicates\r\n      highlighted_tkn_ids = highlighted_tkn_ids.filter((tkn_id) => {return !isPunct(summary_json.filter((word) => {return word.tkn_id===tkn_id})[0].word)}) // ignore punctuation  \r\n      highlighted_tkn_ids = highlighted_tkn_ids.sort(function(a, b) {return a - b;}) // order    \r\n      let chosen_span_id = Object.keys(gold_mentions[\"span_indicating_tkns\"]).filter((key) => {return gold_mentions[\"span_indicating_tkns\"][key].some((span) => hasSubArray(highlighted_tkn_ids, string_to_span(span)))})\r\n\r\n      if (chosen_span_id.length===0){\r\n        return {\"summary_span_ok\":false, \"chosen_span_id\":undefined, \"highlighted_tkn_ids\":highlighted_tkn_ids}\r\n      } else {\r\n        chosen_span_id = chosen_span_id[0]\r\n      }\r\n\r\n      const good_summary_spans = Object.keys(gold_mentions[\"good_summary_spans\"][chosen_span_id]).map((key) => {return string_to_span(gold_mentions[\"good_summary_spans\"][chosen_span_id][key])})\r\n      const str_good_summary_spans = good_summary_spans.map((span) => JSON.stringify(span.sort(function(a, b) {return a - b;})))\r\n\r\n      if (str_good_summary_spans.includes(JSON.stringify(highlighted_tkn_ids.sort(function(a, b) {return a - b;})))) {\r\n        return {\"summary_span_ok\":true, \"chosen_span_id\":chosen_span_id, \"highlighted_tkn_ids\":highlighted_tkn_ids}\r\n      } else {\r\n        return {\"summary_span_ok\":false, \"chosen_span_id\":chosen_span_id, \"highlighted_tkn_ids\":highlighted_tkn_ids}\r\n      }\r\n    }\r\n\r\n    const update_error_message = (gold_tkns, actual_tkns, chosen_span_id, isAlignError) => {\r\n      let actual_tkns_no_punct;\r\n      if (isAlignError) {\r\n        actual_tkns_no_punct = actual_tkns.filter((tkn) => {return !isPunct(doc_json.filter((word) => {return word.tkn_id===tkn})[0].word)})\r\n      } else {\r\n        actual_tkns_no_punct = actual_tkns.filter((tkn) => {return !isPunct(summary_json.filter((word) => {return word.tkn_id===tkn})[0].word)})\r\n      }\r\n      if (actual_tkns_no_punct.filter((tkn) => {return gold_tkns.filter((span) => {return span.includes(tkn)}).length === 0}).length !== 0) {\r\n        update_excess_message(gold_tkns, actual_tkns_no_punct, chosen_span_id, isAlignError)\r\n      } else {\r\n        update_missing_message(gold_tkns, actual_tkns_no_punct, chosen_span_id, isAlignError)\r\n      }\r\n    }\r\n\r\n    const hasSubArray = (master, sub) => {\r\n      return sub.every((i => v => i = master.indexOf(v, i) + 1)(0));\r\n    }\r\n\r\n    const update_excess_message = (gold_tkns, actual_tkns, chosen_span_id, isAlignError) => {\r\n      const msg_type_key = (isAlignError) ? \"redundant_alignment_msg\" : \"too_long_summary_msgs\" \r\n      const default_msg_key = (isAlignError) ? \"default_redundant_alignment_msg\" : \"default_too_long_summary_msg\" \r\n      \r\n      const guiding_msgs = guided_annotation_messages[\"goldMentions\"][CurrSentInd][msg_type_key][chosen_span_id]\r\n      const hint_msgs = guided_annotation_hints[\"goldMentions\"][CurrSentInd][msg_type_key][chosen_span_id]\r\n\r\n      const excess_tkns = actual_tkns.filter((tkn) => {return gold_tkns.every((span) => {return !span.includes(tkn)})}).sort(function(a, b) {return a - b;})\r\n      \r\n      g_setGuidedAnnotationHistory(g_guided_annotation_history.concat([{\"status\":\"error\", \"sent_id\":CurrSentInd, \"type\":`${(isAlignError)? \"doc_span\":\"summary_span\"}`, \"problem\":\"long\", \"chosen_span_id\":chosen_span_id, \"highlighted_tkn_ids\":actual_tkns, \"gold_tkn_ids\":gold_tkns}]))\r\n\r\n\r\n      if (guiding_msgs.length===0){\r\n        // setGuidingMsg(guided_annotation_messages[default_msg_key])\r\n        // setGuidingMsgType(\"danger\")\r\n        update_guiding_msg(\"danger\", guided_annotation_messages[default_msg_key])\r\n        g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n        g_setShowHint(false)\r\n        return\r\n      }\r\n      \r\n      \r\n      \r\n      const custom_message_json = guiding_msgs.filter((json_obj) => {return json_obj[\"excess_tkns\"].some((span) => {return intersection(excess_tkns, string_to_span(span)).length !==0 })})\r\n      if(custom_message_json.length !== 0) {\r\n        if(!guided_unhighlight){\r\n          setGuidedUnhighlight(true)\r\n        }\r\n        // setGuidingMsg(custom_message_json[0])\r\n        update_guiding_msg(\"danger\", custom_message_json[0])\r\n\r\n      } \r\n      else {\r\n        // setGuidingMsg(guided_annotation_messages[default_msg_key])\r\n        update_guiding_msg(\"danger\", guided_annotation_messages[default_msg_key])\r\n\r\n        g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n        g_setShowHint(false)\r\n      }\r\n      // setGuidingMsgType(\"danger\")\r\n\r\n\r\n\r\n      const custom_hint_json = hint_msgs.filter((json_obj) => {return json_obj[\"excess_tkns\"].some((span) => {return intersection(excess_tkns, string_to_span(span)).length !==0 })})\r\n      if(custom_hint_json.length !== 0) {\r\n        if(guided_unhighlight){\r\n          g_setHintMsg(custom_hint_json[0])\r\n        } else {\r\n          g_setHintMsg({\"text\":`${custom_hint_json[0][\"text\"]} ${(custom_hint_json[0][\"text\"].endsWith(\"</ol>\")) ? \"\" : \"<br/>\"} ${guided_annotation_messages[\"extra_to_excess_msgs\"][\"text\"]}`, \"title\": custom_hint_json[0][\"title\"]})\r\n          setGuidedUnhighlight(true)\r\n        }\r\n        g_setShowHint(true)\r\n      } \r\n      else {\r\n        g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n        g_setShowHint(false)\r\n      }\r\n\r\n    }\r\n\r\n    const update_missing_message = (gold_tkns, actual_tkns, chosen_span_id, isAlignError) => {\r\n\r\n      const msg_type_key = (isAlignError) ? \"missing_alignment_msg\" : \"too_short_summary_msgs\" \r\n      const default_msg_key = (isAlignError) ? \"default_missing_alignment_msg\" : \"default_too_short_summary_msg\" \r\n\r\n      const guiding_msgs = guided_annotation_messages[\"goldMentions\"][CurrSentInd][msg_type_key][chosen_span_id]\r\n      const hint_msgs = guided_annotation_hints[\"goldMentions\"][CurrSentInd][msg_type_key][chosen_span_id]\r\n\r\n      \r\n      const merged_gold_tkns = [...new Set(gold_tkns.flat(1))].sort(function(a, b) {return a - b;})\r\n      const missing_tkns = merged_gold_tkns.filter((tkn) => {return !actual_tkns.includes(tkn)})\r\n      const custom_message_json = guiding_msgs.filter((json_obj) => {return json_obj[\"missing_tkns\"].some((span) => {return intersection(missing_tkns, string_to_span(span)).length !== 0 })})\r\n\r\n\r\n      g_setGuidedAnnotationHistory(g_guided_annotation_history.concat([{\"status\":\"error\", \"sent_id\":CurrSentInd, \"type\":`${(isAlignError)? \"doc_span\":\"summary_span\"}`, \"problem\":\"short\", \"chosen_span_id\":chosen_span_id, \"highlighted_tkn_ids\":actual_tkns, \"gold_tkn_ids\":gold_tkns}]))\r\n\r\n\r\n\r\n      if(custom_message_json.length !== 0) {\r\n        // setGuidingMsg(custom_message_json[0])\r\n        // setGuidingMsgType(\"danger\")\r\n        update_guiding_msg(\"danger\", custom_message_json[0])\r\n      } else {\r\n        // setGuidingMsg(guided_annotation_messages[default_msg_key])\r\n        // setGuidingMsgType(\"danger\")\r\n        update_guiding_msg(\"danger\", guided_annotation_messages[default_msg_key])\r\n\r\n        g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n        g_setShowHint(false)\r\n      }\r\n      \r\n      const custom_hint_json = hint_msgs.filter((json_obj) => {return json_obj[\"missing_tkns\"].some((span) => {return intersection(missing_tkns, string_to_span(span)).length !== 0 })})\r\n      if(custom_hint_json.length !== 0) {\r\n        g_setHintMsg(custom_hint_json[0])\r\n        g_setShowHint(true)\r\n      } else {\r\n        g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n        g_setShowHint(false)\r\n      }\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n\r\n    const isAlignmentOk = (tkn_ids, turn_on, turn_off) => {\r\n      // const doc_tkns = doc_json.filter((word) => {return word.span_highlighted && !isPunct(word.word)}).map((word) => word.tkn_id).sort(function(a, b) {return a - b;})\r\n      \r\n      let doc_tkns = doc_json.filter((word) => {return word.span_highlighted}).map((word) => word.tkn_id)\r\n      doc_tkns = (turn_on) ? doc_tkns.concat(tkn_ids) : doc_tkns\r\n      doc_tkns = (turn_off) ? doc_tkns.filter((tkn) => {return (turn_off && !tkn_ids.includes(tkn))}) : doc_tkns\r\n      doc_tkns = [...new Set(doc_tkns)] // remove duplicates\r\n      doc_tkns = doc_tkns.filter((tkn_id) => {return !isPunct(doc_json.filter((word) => {return word.tkn_id===tkn_id})[0].word)}) // ignore punctuation    \r\n      doc_tkns = doc_tkns.sort(function(a, b) {return a - b;}) // sort\r\n\r\n      const msgs_json = guided_annotation_messages[\"goldMentions\"][CurrSentInd]\r\n\r\n      // unalignable parts\r\n      if (msgs_json[\"doc_tkns_alignments\"][curr_alignment_guiding_msg_id].length===0) {\r\n        if (doc_tkns.length===0){\r\n          return {\"alignment_ok\":true, \"highlighted_doc_tkns\":doc_tkns, \"gold_align_tkns\":[]} \r\n        } else {\r\n          return {\"alignment_ok\":false, \"highlighted_doc_tkns\":doc_tkns, \"gold_align_tkns\":[]} \r\n        }\r\n      }\r\n\r\n\r\n\r\n\r\n      \r\n      const gold_align_tkns  = msgs_json[\"doc_tkns_alignments\"][curr_alignment_guiding_msg_id].map((span) => string_to_span(span))\r\n      if (gold_align_tkns.map((span) => JSON.stringify(span)).includes(JSON.stringify(doc_tkns))) {\r\n          return {\"alignment_ok\":true, \"highlighted_doc_tkns\":doc_tkns, \"gold_align_tkns\":gold_align_tkns} \r\n      } else {\r\n        return {\"alignment_ok\":false, \"highlighted_doc_tkns\":doc_tkns, \"gold_align_tkns\":gold_align_tkns} \r\n      }\r\n    }\r\n\r\n\r\n\r\n    const OpenHint = () => {\r\n      window.scrollTo(0, 0)\r\n      g_setOpenHint(true)\r\n      g_setWithGlowHint(true)\r\n    }\r\n\r\n\r\n    const getAnswerModalMsg = (last_error_json) => {\r\n      if(last_error_json[\"highlighted_tkn_ids\"].length===0){\r\n        const where_to_highlight = (last_error_json[\"type\"] === \"summary_span\") ? \"summary\":\"doc\"\r\n        const what_next = (last_error_json[\"type\"] === \"summary_span\") ? \"proceeding to the document or hitting \\\"CONFIRM\\\"\" : \"hitting \\\"CONFIRM\\\"\"\r\n\r\n        g_setGuiderMsg({\"type\":\"reveal-answer\", \"where\":where_to_highlight, \"text\":`Start by highlighting something in the ${where_to_highlight}`})      \r\n        return `<div>Please highlight something in the <u>${where_to_highlight}</u> before ${what_next}!</div>`\r\n      }\r\n      const gold_mentions = guided_annotation_strike_messages[\"goldMentions\"][last_error_json[\"sent_id\"]]\r\n      const error_type = last_error_json[\"type\"];\r\n\r\n      let chosen_span_id = last_error_json[\"chosen_span_id\"];\r\n      if (chosen_span_id===\"-1\") {\r\n        chosen_span_id = Object.keys(gold_mentions[\"span_indicating_tkns\"]).filter((key) => {return string_to_span(gold_mentions[\"span_indicating_tkns\"][key]).includes(last_error_json[\"highlighted_tkn_ids\"][0])})    \r\n      }\r\n\r\n\r\n      const correct_span = gold_mentions[error_type][chosen_span_id][\"text\"]\r\n      if (correct_span===\"None\") {\r\n        g_setAnswerWordsToGlow({\"type\":\"unalignable-adujst-summary\", \"ids\":[], \"start_tkn\":\"\"})\r\n        g_setGuiderMsg({\"type\":\"reveal-answer\", \"where\":\"summary\", \"text\":\"Leave out \\\"from countries like Brazil\\\".\"})\r\n        return \"<div>It appears you are struggling a little, so let me help you. <br/>\\\"from countries like Brazil\\\" doesn't appear in the document. <br/>Remove it from the <u>summary</u> span, and then proceed to find the alignment in the document. <br/>Deal with \\\"from countries like Brazil\\\" separately.</div>\"\r\n      }\r\n      const where_to_highlight = (error_type===\"summary_span\") ? \"summary\":\"document\"\r\n      const what_is_correct = (correct_span===\"\") ? \"The summary span is unalignable\" : `<u>The correct span(s) is</u>: ${correct_span} (see glowing)`\r\n      const what_to_do = (correct_span===\"\") ? `<b>highlight nothing</b> in the <b>${where_to_highlight}</b>` : `<b>highlight it</b> in the <b><u>${where_to_highlight}</u></b>`\r\n      const what_next = (error_type===\"summary_span\") ? \"then proceed to find its alignment in the <u>document</u>\": `<b>hit \\\"${(StateMachineState===\"ANNOTATION\") ? \"CONFIRM\":\"\"}${(StateMachineState===\"SENTENCE END\") ? \"NEXT SENTENCE\":\"\"}${(StateMachineState===\"SUMMARY END\") ? \"SUBMIT\":\"\"}${(correct_span===\"\")? \" (NO ALIGN)\":\"\"}\\\"</b>`;\r\n\r\n      const tkns_type = (error_type===\"summary_span\") ? 'summary_tkns':'doc_tkns'\r\n      const answerMarker = (gold_mentions[tkns_type][chosen_span_id].length===0) ? {\"type\":\"unalignable-adujst-doc\", \"ids\":[], \"start_tkn\":\"\"} : {\"type\":error_type, \"ids\":gold_mentions[tkns_type][chosen_span_id], \"start_tkn\":gold_mentions[\"start_tkn\"]}\r\n      g_setAnswerWordsToGlow(answerMarker)\r\n\r\n      if (gold_mentions[tkns_type][chosen_span_id].length===0) {\r\n        g_setGuiderMsg({\"type\":\"reveal-answer\", \"where\":\"doc\", \"text\":`Un-highlight everything in the summary and ${what_next}`})\r\n      } else if (error_type===\"summary_span\") {\r\n        g_setGuiderMsg({\"type\":\"reveal-answer\", \"where\":\"summary\", \"text\":`Highlight <b>only</b> what is <b>glowing</b> and ${what_next}`})\r\n        setSummaryJson(summary_json.map((word) => {return {...word, span_highlighted:false}}))\r\n      } else {\r\n        g_setGuiderMsg({\"type\":\"reveal-answer\", \"where\":\"doc\", \"text\":`Highlight <b>only</b> what is <b>glowing</b> and ${what_next}`})\r\n        setDocJson(doc_json.map((word) => {return {...word, span_highlighted:false}}))\r\n      }\r\n      return `It appears you are struggling a little, so let me help you. <br/>${what_is_correct}. <hr/>Please ${what_to_do} and ${what_next}.`\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    \r\n\r\n  /********************************************************************************************************************************************************************* */\r\n\r\n  /*******  useState for smooth transition to \"SENTENCE END\" or \"SUMMARY END\" *******/\r\n  const finishedSent = useRef(false);\r\n\r\n  useEffect(() => {\r\n    const isNotStart = (StateMachineState !== \"START\" && summary_json.filter((word) => {return word.sent_id===CurrSentInd && word.shadowed}).length !== 0);\r\n    const isAllSentHighlighted = (summary_json.filter((word) => { return word.sent_id===CurrSentInd && !(word.all_highlighted || word.span_highlighted) && !isPunct(word.word)}).length === 0); // need \"isNotStart\" because also for \"START\" state isAllSentHighlighted=true because no sentence is span-highlighted yet \r\n    if (isAllSentHighlighted && isNotStart && !finishedSent.current && ![\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState)) {\r\n      finishedSent.current = true;\r\n\r\n\r\n      const isLastSent = (Math.max.apply(Math, summary_json.map(word => { return word.sent_id; })) === CurrSentInd)\r\n      if (isLastSent) {\r\n        MachineStateHandlerWrapper({forceState:\"SUMMARY END\"});   \r\n      } else {\r\n        MachineStateHandlerWrapper({forceState:\"SENTENCE END\"});   \r\n      }\r\n    }\r\n\r\n    // if regretted summary highlighting\r\n    else if(!isAllSentHighlighted && isNotStart && finishedSent.current && ![\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState)) { \r\n      finishedSent.current = false;\r\n      MachineStateHandlerWrapper({forceState:\"ANNOTATION\"});\r\n    }\r\n  }, [summary_json]);\r\n  /*********************************************************************************/ \r\n\r\n  /*********** useState to update the summary shadow when next sentence ***********/ \r\n  useEffect(() => {\r\n    // console.log(\"guided_annotation_messages:\")\r\n    // console.log(guided_annotation_messages);\r\n    SetSummaryShadowAndUpdateHighlights(CurrSentInd);\r\n  }, [CurrSentInd]);\r\n  /********************************************************************************/\r\n\r\n  /***************************** bolding controlling *****************************/ \r\n  useEffect(() => {\r\n    // when choosing a span - if nothing is span_highlighted then all sent matches are in bold, otherwise only span_highlighted matches (when highlighting - something must be span-highlighted so automatically is '2')\r\n    if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\"].includes(StateMachineState) && !sliderBoldStateActivated) {\r\n      const bold_state = (summary_json.filter((word) => {return word.span_highlighted}).length === 0) ? '3' : '2'; // if no span is current highlighted - bold everything, otherwise bold only currently highlighted span\r\n      boldStateHandler(undefined, bold_state);\r\n    } else if ([\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState) && !sliderBoldStateActivated) {\r\n      boldStateHandler(undefined, '1');\r\n    }\r\n  }, [StateMachineState, summary_json]);\r\n  /********************************************************************************/\r\n\r\n   /***************************** old alignments controlling *****************************/ \r\n   const prevState = useRef(\"\")\r\n   useEffect(() => {\r\n     if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\"].includes(StateMachineState)) {\r\n       oldAlignmentStateHandler({event:undefined, newValue:'3', sent_ind:-1});\r\n     } else if (StateMachineState === \"REVISE CLICKED\"){\r\n       oldAlignmentStateHandler({event:undefined, newValue:'1', sent_ind:-1});\r\n     } else if (StateMachineState === \"REVISE HOVER\"){\r\n       oldAlignmentStateHandler({event:undefined, newValue:'3', sent_ind:-1});\r\n     }\r\n     prevState.current = StateMachineState;\r\n   }, [StateMachineState, AlignmentCount]);\r\n   /********************************************************************************/\r\n  //  useEffect(() => {\r\n  //    console.log(`CurrSentInd is updated and is now ${CurrSentInd}`)\r\n  //   //  console.log(`AVIVSL: wanted words are:${JSON.stringify(doc_json.filter((word)=> { return [\"came\", \"come\"].includes(word.word)}).map((word) => word.tkn_id))}`)\r\n  //  }, [CurrSentInd]);\r\n\r\n   useEffect(() => {\r\n    console.log(`tkn_id of highlighted summary words: ${JSON.stringify(summary_json.filter((word)=>{return word.span_highlighted}).map((word) => word.tkn_id))}`)\r\n  }, [summary_json]);\r\n\r\n  useEffect(() => {\r\n    console.log(`tkn_id of highlighted doc words: ${JSON.stringify(doc_json.filter((word)=>{return word.span_highlighted}).map((word) => word.tkn_id))}`)\r\n  }, [doc_json]);\r\n\r\n\r\n  // useEffect(() => {\r\n  //   console.log(`g_guided_annotation_history: ${JSON.stringify(g_guided_annotation_history)}`)\r\n  // }, [g_guided_annotation_history]);\r\n  // useEffect(() => {\r\n  //   console.log(`guided_annotation_hints here: ${JSON.stringify(guided_annotation_hints)}`)\r\n  // }, []);\r\n\r\n   \r\n   /******************* highlighting while choosing spans to help *******************/ \r\n\r\n\r\n   useEffect(() => {\r\n     if (DocOnMouseDownID !== \"-1\"){\r\n       setDocOnMouseDownActivated(true)\r\n     } else if (DocOnMouseDownID === \"-1\"){\r\n       setDocOnMouseDownActivated(false)\r\n     } \r\n     \r\n     if (SummaryOnMouseDownID !== \"-1\") {\r\n       setSummaryOnMouseDownActivated(true)\r\n     } else {\r\n       setSummaryOnMouseDownActivated(false)\r\n     }\r\n   }, [DocOnMouseDownID,SummaryOnMouseDownID]);\r\n   \r\n   //AVIVSL: TODO: find way to reset the whole hovering process when the onMouseUp occurs outside of the text (maybe when docOnMouseDownActivated===false or summaryOnMouseDownActivated===false) --> maybe use a useRef to remember which one was the one activated - summary or doc?\r\n   useEffect(() => {\r\n     if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState)){\r\n       if(docOnMouseDownActivated) {\r\n        //  console.log(`DocOnMouseDownID is ${DocOnMouseDownID} and hoverActivatedId ia ${hoverActivatedId}`)\r\n         const min_ID =  (DocOnMouseDownID > hoverActivatedId) ? hoverActivatedId : DocOnMouseDownID;\r\n         const max_ID =  (DocOnMouseDownID > hoverActivatedId) ? DocOnMouseDownID : hoverActivatedId;\r\n         let chosen_IDs = [];\r\n         for(let i=min_ID; i<=max_ID; i++){\r\n           chosen_IDs.push(i);\r\n         }\r\n         setDocJson(doc_json.map((word) => chosen_IDs.includes(word.tkn_id)? {...word, span_alignment_hover:true}:{...word, span_alignment_hover:false}))\r\n       } else if (!docOnMouseDownActivated){\r\n         setDocJson(doc_json.map((word) => {return {...word, span_alignment_hover:false}}))\r\n       }\r\n       if(summaryOnMouseDownActivated) {\r\n        //  console.log(`SummaryOnMouseDownID is ${SummaryOnMouseDownID} and hoverActivatedId ia ${hoverActivatedId}`)\r\n         const min_ID =  (SummaryOnMouseDownID > hoverActivatedId) ? hoverActivatedId : SummaryOnMouseDownID;\r\n         const max_ID =  (SummaryOnMouseDownID > hoverActivatedId) ? SummaryOnMouseDownID : hoverActivatedId;\r\n         let chosen_IDs = [];\r\n         for(let i=min_ID; i<=max_ID; i++){\r\n           chosen_IDs.push(i);\r\n         }\r\n         setSummaryJson(summary_json.map((word) => chosen_IDs.includes(word.tkn_id)? {...word, span_alignment_hover:true}:{...word, span_alignment_hover:false}))\r\n       } else if (!summaryOnMouseDownActivated){\r\n         setSummaryJson(summary_json.map((word) => {return {...word, span_alignment_hover:false}}))\r\n         \r\n         if (isRedLettered(hoverActivatedId) && hoverActivatedDocOrSummary === \"summary\") {\r\n           const doc_tkn_ids = doc_json.map((word) => {return word.tkn_id}).filter((doc_id) => {return checkIfLemmasMatch({doc_id:doc_id, summary_ids:[hoverActivatedId], isHover:true})});\r\n\r\n           setDocJson(doc_json.map((word) => doc_tkn_ids.includes(word.tkn_id) ? {...word, red_color:true} : {...word, red_color:false}))  \r\n         }  \r\n       }\r\n     }\r\n   }, [docOnMouseDownActivated, summaryOnMouseDownActivated, hoverActivatedId]);\r\n\r\n\r\n   // close the guiding message\r\n   useEffect(() => {\r\n    if(guiding_msg_type!==\"closed\") {\r\n      window.setTimeout(()=>{setGuidingMsgType(\"closed\");setGuidingMsg({\"text\":\"\", \"title\":\"\"});},guiding_msg[\"timeout\"])\r\n    }\r\n   }, [guiding_msg_type])\r\n\r\n\r\n\r\n\r\n   // solve if too many errors in a row\r\n   useEffect(() => {\r\n    if(guiding_msg_type===\"danger\") {\r\n      if(g_strikes_counter>=MAX_ERR_CNT) {\r\n        const last_error_json = g_guided_annotation_history.at(-1)\r\n        g_setStrikesCounter(0)\r\n        g_setGuidedAnnotationHistory(g_guided_annotation_history.concat([\"strike!\"]))\r\n        g_setAnswerModalMsg(getAnswerModalMsg(last_error_json))\r\n      } else {\r\n        g_setStrikesCounter(g_strikes_counter+1)\r\n      }\r\n      // g_guided_annotation_history, g_setGuidedAnnotationHistory,\r\n      // g_open_answer_model, g_setAnswerModalMsg\r\n      // g_strikes_counter, g_setStrikesCounter\r\n    } else if (guiding_msg_type===\"success\") {\r\n      g_setStrikesCounter(0)\r\n\r\n      g_setAnswerWordsToGlow({\"type\":\"\", \"ids\":[], \"start_tkn\":\"\"})\r\n\r\n    }\r\n   }, [guiding_msg_type])\r\n\r\n\r\n\r\n\r\n   // reset Hint's attributes\r\n   useEffect(() => {\r\n    if(!g_show_hint) {\r\n      g_setOpenHint(false)\r\n      g_setWithGlowHint(false)\r\n    }\r\n   }, [g_show_hint])\r\n\r\n  // reset Hint's attributes when hint changes\r\n  useEffect(() => {\r\n      g_setOpenHint(false)\r\n      g_setWithGlowHint(false)\r\n    }, [g_hint_msg])\r\n\r\n  // if alignment is ok - press the \"CONFIRM\" or equivalent button to continue\r\n  useEffect(() => {\r\n    if (is_good_alignment) {\r\n      let next_step = \"continue\"\r\n      next_step = (StateMachineState === \"SENTENCE END\") ? \"proceed to the next sentence\" : next_step\r\n      next_step = (StateMachineState === \"SUMMARY END\") ? \"submit and finish your training\" : next_step\r\n      if(doc_json.filter((word) => {return word.span_highlighted}).length===0) {\r\n        g_setGuiderMsg({\"type\":\"info\", \"where\":\"next-button\", \"text\":`This summary span is <b>unalignable</b>, so press me to ${next_step} (<u>don't highlight</u> anything in the <u>document</u>).`})\r\n      } else {\r\n        g_setGuiderMsg({\"type\":\"info\", \"where\":\"next-button\", \"text\":`Press me to ${next_step}.`})\r\n      }\r\n    }\r\n  }, [is_good_alignment])\r\n\r\n\r\n    \r\n\r\n   \r\n\r\n\r\n   // check if alignment ok (for guidinbg annotation message)\r\n   useEffect(() => {\r\n     if(CurrSentInd>=0 && curr_alignment_guiding_msg_id!==\"-1\") {\r\n      const isAlignmentOkDict = isAlignmentOk(doc_json.filter((word) => {return word.span_highlighted}).map((word) => word.tkn_id), false, false)\r\n      const isSummarySpanOkDict = isSummarySpanOk(summary_json.filter((word) => {return word.span_highlighted}).map((word) => word.tkn_id), false, false) // if changes summary span after was approved\r\n      setIsGoodAlignment(isAlignmentOkDict[\"alignment_ok\"] && isSummarySpanOkDict[\"summary_span_ok\"])\r\n     }\r\n   }, [doc_json, summary_json])\r\n\r\n   // when entering revision mode - scroll up to see the instruction\r\n   useEffect(() => {\r\n    if(StateMachineState===\"REVISE HOVER\") {\r\n      window.scrollTo(0, 0);\r\n    }\r\n  }, [StateMachineState])\r\n\r\n\r\n\r\n   const SubmitHandler = (event) => {\r\n      // no alignment\r\n      if ((typeof forceState !== 'string') && (doc_json.filter((word) => {return word.span_highlighted}).length === 0) && (StateMachineState!==\"START\") && !noAlignApproved) {\r\n        setNoAlignModalShow(true)\r\n        return\r\n      }\r\n      setNoAlignApproved(false)\r\n\r\n\r\n    //hitting submit when the summary span is bad....\r\n    const isSummarySpanOkDict = isSummarySpanOk([], false, false)\r\n    \r\n    if(!isSummarySpanOkDict[\"summary_span_ok\"]) {\r\n      if (isSummarySpanOkDict[\"highlighted_tkn_ids\"].length===0 && StateMachineState !== \"REVISE HOVER\") { // nothing highlighted in summary\r\n        // setGuidingMsg(guided_annotation_messages[\"empty_summary_span_msg\"])\r\n        // setGuidingMsgType(\"danger\")\r\n        update_guiding_msg(\"danger\", guided_annotation_messages[\"empty_summary_span_msg\"])\r\n        g_setGuidedAnnotationHistory(g_guided_annotation_history.concat([{\"status\":\"error\", \"sent_id\":CurrSentInd, \"type\":\"summary_span\", \"problem\":\"short\", \"chosen_span_id\":\"-1\", \"highlighted_tkn_ids\":isSummarySpanOkDict[\"highlighted_tkn_ids\"], \"gold_tkn_ids\":[]}]))\r\n\r\n      } else if (isSummarySpanOkDict[\"chosen_span_id\"]===undefined){\r\n        // setGuidingMsg(guided_annotation_messages[\"default_too_short_summary_msg\"])\r\n        // setGuidingMsgType(\"danger\")\r\n        update_guiding_msg(\"danger\", guided_annotation_messages[\"default_too_short_summary_msg\"])\r\n        g_setGuidedAnnotationHistory(g_guided_annotation_history.concat([{\"status\":\"error\", \"sent_id\":CurrSentInd, \"type\":\"summary_span\", \"problem\":\"short\", \"chosen_span_id\":\"-1\", \"highlighted_tkn_ids\":isSummarySpanOkDict[\"highlighted_tkn_ids\"], \"gold_tkn_ids\":[]}]))\r\n\r\n        g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n        g_setShowHint(false)\r\n      } else {\r\n        let gold_tkns = guided_annotation_messages[\"goldMentions\"][CurrSentInd][\"good_summary_spans\"][isSummarySpanOkDict[\"chosen_span_id\"]]\r\n        gold_tkns = gold_tkns.map((span) => {return string_to_span(span)})\r\n        update_error_message(gold_tkns, isSummarySpanOkDict[\"highlighted_tkn_ids\"], isSummarySpanOkDict[\"chosen_span_id\"], false)\r\n      }\r\n      return\r\n    }\r\n\r\n    \r\n    const isAlignmentOkDict = isAlignmentOk();\r\n    if (isAlignmentOkDict[\"alignment_ok\"]) {\r\n      // setGuidingMsg(guided_annotation_messages[\"default_good_alignment_msg\"]) // AVIVSL: add custom success messages\r\n      // setGuidingMsgType(\"success\");\r\n      setCurrAlignmentGuidingMsgId(\"-1\");\r\n      g_setHintMsg({\"text\":\"\", \"title\":\"\"})\r\n      g_setShowHint(false);\r\n    } else {\r\n      update_error_message(isAlignmentOkDict[\"gold_align_tkns\"], isAlignmentOkDict[\"highlighted_doc_tkns\"], curr_alignment_guiding_msg_id, true);\r\n      return\r\n    }\r\n\r\n    setCompleted(true)\r\n    setOpeningModalShow(false)\r\n    setFinishedModalShow(true)\r\n    resetGuidedAnnotation()\r\n    setGuidedUnhighlight(false)\r\n    window.scrollTo(0, 0)\r\n    // alert(\"Submitted!\");\r\n  }\r\n\r\n\r\n\r\n\r\n   return (\r\n     <>\r\n          <Annotation\r\n              isTutorial = {false}                                        isGuidedAnnotation = {true} \r\n              task_id = {'0'}                                             doc_paragraph_breaks = {doc_paragraph_breaks}\r\n              doc_json = {doc_json}                                       setDocJson = {setDocJson}\r\n              summary_json = {summary_json}                               setSummaryJson = {setSummaryJson}\r\n              all_lemma_match_mtx = {all_lemma_match_mtx}                 important_lemma_match_mtx = {important_lemma_match_mtx}\r\n              StateMachineState = {StateMachineState}                     SetStateMachineState = {SetStateMachineState}\r\n              handleErrorOpen = {handleErrorOpen}                         isPunct = {isPunct}\r\n              toggleSummarySpanHighlight = {toggleSummarySpanHighlight}   toggleDocSpanHighlight = {toggleDocSpanHighlight}\r\n              boldState = {boldState}                                     boldStateHandler = {boldStateHandler}\r\n              SubmitHandler = {SubmitHandler}                             hoverHandler = {hoverHandler}\r\n              CurrSentInd = {CurrSentInd}                                 SetCurrSentInd = {SetCurrSentInd}\r\n              InfoMessage = {InfoMessage}                                 MachineStateHandlerWrapper = {MachineStateHandlerWrapper}\r\n              AlignmentCount = {AlignmentCount}                           SetAlignmentCount = {SetAlignmentCount}\r\n              oldAlignmentState = {oldAlignmentState}                     oldAlignmentStateHandler = {oldAlignmentStateHandler}\r\n              DocOnMouseDownID = {DocOnMouseDownID}                       SetDocOnMouseDownID = {SetDocOnMouseDownID}\r\n              SummaryOnMouseDownID = {SummaryOnMouseDownID}               SetSummaryOnMouseDownID = {SetSummaryOnMouseDownID}\r\n              docOnMouseDownActivated = {docOnMouseDownActivated}         setDocOnMouseDownActivated = {setDocOnMouseDownActivated}\r\n              summaryOnMouseDownActivated = {summaryOnMouseDownActivated} setSummaryOnMouseDownActivated = {setSummaryOnMouseDownActivated}\r\n              setHoverActivatedId = {setHoverActivatedId}                 setHoverActivatedDocOrSummary = {setHoverActivatedDocOrSummary}\r\n              hoverActivatedId = {hoverActivatedId}\r\n              t_StateMachineStateId = {undefined}                          t_SetStateMachineStateId = {undefined}\r\n              t_start_doc_json = {undefined}                               t_middle_doc_json = {undefined}\r\n              t_sent_end_doc_json = {undefined}                            t_submit_doc_json = {undefined}\r\n              t_start_summary_json = {undefined}                           t_middle_summary_json = {undefined}\r\n              t_sent_end_summary_json = {undefined}                        t_submit_summary_json = {undefined}\r\n              t_state_messages = {undefined}\r\n              g_guiding_info_msg = {guiding_info_msg}                      g_is_good_alignment = {is_good_alignment}\r\n              g_show_hint = {g_show_hint}                                  g_setShowHint = {g_setShowHint}\r\n              g_hint_msg = {g_hint_msg}                                    g_showWhereNavbar = {showWhereNavbar}\r\n              g_open_hint={g_open_hint}                                    g_setOpenHint={g_setOpenHint}\r\n              g_with_glow_hint={g_with_glow_hint}                          g_setWithGlowHint={g_setWithGlowHint}\r\n              g_answer_words_to_glow={g_answer_words_to_glow}              g_FinishedModalShow={FinishedModalShow}\r\n              g_Guider_msg={g_Guider_msg}                                  g_setGuiderMsg={g_setGuiderMsg}\r\n              \r\n              OpeningModalShow = {undefined}                               setOpeningModalShow = {undefined}\r\n              noAlignModalShow = {noAlignModalShow}                        setNoAlignModalShow = {setNoAlignModalShow}\r\n              noAlignApproved = {noAlignApproved}                          setNoAlignApproved = {setNoAlignApproved}\r\n            />\r\n\r\n                <Alert show={guiding_msg_type!==\"closed\" && g_answer_modal_msg===\"\"} style={{position:\"fixed\", bottom:\"1%\", left:\"50%\", transform:\"translate(-50%, 0%)\", width:\"50%\", zIndex:\"10000\"}} variant={guiding_msg_type} onClose={() => setGuidingMsgType(\"closed\")} dismissible>\r\n                        <Alert.Heading>{guiding_msg[\"title\"]}</Alert.Heading>\r\n                        <p>\r\n                          <Markup content={guiding_msg[\"text\"]} />\r\n                          {guiding_msg[\"with hint\"] && (<div><Button variant=\"link\" onClick={OpenHint}>hint</Button></div>)}\r\n                          <Markup content={add_text_to_GuidedAnnotationInfoAlert(is_good_alignment,StateMachineState, doc_json)} />\r\n                        </p>\r\n                </Alert>\r\n\r\n                <Modal size=\"lg\" aria-labelledby=\"contained-modal-title-vcenter\" centered show={FinishedModalShow} onHide={() => {setFinishedModalShow(false)}}>\r\n                  <Modal.Header closeButton>\r\n                    <Modal.Title>{guided_annotation_messages[\"submitted_msg\"]['title']}</Modal.Title>\r\n                  </Modal.Header>\r\n                  <Modal.Body>\r\n                    {<Markup content={guided_annotation_messages[\"submitted_msg\"][\"text\"]} />}\r\n                  </Modal.Body>\r\n                  <Modal.Footer className='FinishedModalFooter'>\r\n                        <Button active variant=\"btn btn-warning btn-lg left-button\" onClick={() => {setShowWhereNavbar(!showWhereNavbar)}}>\r\n                            SHOW NAVIGATION BAR\r\n                        </Button>\r\n\r\n\r\n                    <Button variant=\"btn btn-secondary btn-lg right-button\" onClick={() => {setFinishedModalShow(false)}}>\r\n                      REDO\r\n                    </Button>\r\n                    <Link to=\"/\">\r\n                      <Button className=\"btn btn-success btn-lg right-button\">\r\n                        ANNOTATION\r\n                      </Button>\r\n                    </Link>\r\n                  </Modal.Footer>\r\n                </Modal>\r\n\r\n\r\n                <Modal\r\n                  show={g_answer_modal_msg!==\"\"}\r\n                  backdrop=\"static\"\r\n                  keyboard={false}\r\n                  className=\"answer-modal-textbox\"\r\n                  style={{zIndex:\"10000\"}}\r\n                >\r\n                  <Modal.Header>\r\n                    <Modal.Title>UH-OH</Modal.Title>\r\n                  </Modal.Header>\r\n                  <Modal.Body>\r\n                    {<Markup content={g_answer_modal_msg} />}\r\n                  </Modal.Body>\r\n                  <Modal.Footer>\r\n                    <Button variant=\"primary\" onClick={() => {g_setAnswerModalMsg(\"\")}}>\r\n                      GOT IT\r\n                    </Button>\r\n                  </Modal.Footer>\r\n                </Modal>\r\n\r\n\r\n\r\n\r\n      </>\r\n   )\r\n\r\n}\r\n\r\nexport default GuidedAnnotation","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\Annotation.js",["148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173"],[],"import { useState, useEffect, useRef } from 'react';\r\nimport DocWord from './DocWord';\r\nimport SummaryWord from './SummaryWord';\r\nimport ResponsiveAppBar from './ResponsiveAppBar';\r\nimport MuiAlert from '@mui/material/Alert';\r\nimport * as React from 'react';\r\nimport { ArrowBackIosTwoTone, ArrowForwardIosTwoTone } from '@mui/icons-material';\r\nimport SendIcon from '@mui/icons-material/Send';\r\nimport Typography from '@mui/material/Typography';\r\n\r\nimport Fab from '@mui/material/Fab';\r\n// import Card from '@mui/material/Card';\r\nimport { Card } from 'react-bootstrap';\r\n\r\nimport CardHeader from '@mui/material/CardHeader';\r\nimport CardActions from '@mui/material/CardActions';\r\nimport CardContent from '@mui/material/CardContent';\r\n// import Button from '@mui/material/Button';\r\nimport Box from '@mui/material/Box';\r\nimport { borderColor } from '@mui/system';\r\n\r\n\r\nimport Container from 'react-bootstrap/Container'\r\nimport Row from 'react-bootstrap/Row'\r\nimport Col from 'react-bootstrap/Col'\r\nimport Alert from 'react-bootstrap/Alert'\r\nimport { ChevronLeft, ChevronRight, SendFill } from 'react-bootstrap-icons';\r\nimport { Markup } from 'interweave';\r\nimport Modal from 'react-bootstrap/Modal'\r\nimport Button from 'react-bootstrap/Button';\r\nimport { Link } from 'react-router-dom';\r\nimport Overlay from 'react-bootstrap/Overlay'\r\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger'\r\nimport Tooltip from 'react-bootstrap/Tooltip'\r\n\r\nimport Popover from 'react-bootstrap/Popover'\r\nimport { Player, BigPlayButton } from 'video-react';\r\n\r\n\r\nimport { TutorialCard } from './TutorialCard';\r\nimport { getTutorialCardTitle } from './Tutorial_utils'\r\nimport { add_text_to_GuidedAnnotationInfoAlert, string_to_span, get_span_groups } from './GuidedAnnotation_utils'\r\n// import Card from 'react-bootstrap/Card'\r\n// import { Container, Row, Col } from 'react-bootstrap';\r\n\r\n\r\nconst Annotation = ({isTutorial, isGuidedAnnotation, \r\n                    task_id, doc_paragraph_breaks,\r\n                    doc_json, setDocJson, \r\n                    summary_json, setSummaryJson,\r\n                    all_lemma_match_mtx, important_lemma_match_mtx, \r\n                    StateMachineState, SetStateMachineState,\r\n                    handleErrorOpen, isPunct,\r\n                    toggleSummarySpanHighlight, toggleDocSpanHighlight, \r\n                    boldState, boldStateHandler,\r\n                    SubmitHandler, hoverHandler,\r\n                    CurrSentInd, SetCurrSentInd,\r\n                    InfoMessage,\r\n                    MachineStateHandlerWrapper,\r\n                    AlignmentCount, SetAlignmentCount,\r\n                    oldAlignmentState, oldAlignmentStateHandler,\r\n                    DocOnMouseDownID, SetDocOnMouseDownID, \r\n                    SummaryOnMouseDownID, SetSummaryOnMouseDownID,\r\n                    docOnMouseDownActivated, setDocOnMouseDownActivated, \r\n                    summaryOnMouseDownActivated, setSummaryOnMouseDownActivated, \r\n                    setHoverActivatedId, setHoverActivatedDocOrSummary,\r\n                    hoverActivatedId,\r\n                    t_StateMachineStateId, t_SetStateMachineStateId, \r\n                    t_start_doc_json, t_middle_doc_json, \r\n                    t_sent_end_doc_json, t_submit_doc_json, \r\n                    t_start_summary_json, t_middle_summary_json, \r\n                    t_sent_end_summary_json, t_submit_summary_json,\r\n                    t_state_messages,\r\n                    g_guiding_info_msg, g_is_good_alignment,\r\n                    g_show_hint, g_setShowHint,\r\n                    g_hint_msg, g_showWhereNavbar,\r\n                    g_open_hint, g_setOpenHint,\r\n                    g_with_glow_hint, g_setWithGlowHint,\r\n                    g_answer_words_to_glow, g_FinishedModalShow,\r\n                    g_Guider_msg, g_setGuiderMsg,\r\n\r\n                    OpeningModalShow, setOpeningModalShow,\r\n                    noAlignModalShow, setNoAlignModalShow,\r\n                    noAlignApproved, setNoAlignApproved\r\n                  }) => {\r\n\r\n\r\n  const [DocMouseclickStartID, SetDocMouseDownStartID] = useState(\"-1\");\r\n  const [DocMouseclicked, SetDocMouseclicked] = useState(false);\r\n  const [SummaryMouseclickStartID, SetSummaryMouseDownStartID] = useState(\"-1\");\r\n  const [SummaryMouseclicked, SetSummaryMouseclicked] = useState(false);\r\n\r\n  const [summaryOnMouseDownInCorrectSent, setSummaryOnMouseDownInCorrectSent] = useState(true)\r\n  const [ctrlButtonDown, setCtrlButtonDown] = useState(false)\r\n  const [toastVisible, setToastVisible] = useState(true)\r\n\r\n  const docGuider = useRef(null);\r\n  const summaryGuider = useRef(null);\r\n  const nextButtonGuider = useRef(null);     \r\n  const backButtonGuider = useRef(null);              \r\n  const ExitReviseButtonGuider = useRef(null)\r\n\r\n  const isDocSpanExist = () => {\r\n    return doc_json.filter((word) => {return word.span_highlighted}).length !== 0\r\n  }\r\n\r\n  const nextButtonText = () => {\r\n    let btn_text = \"\"\r\n    if(StateMachineState===\"START\"){btn_text = \"START\";}\r\n    else if(StateMachineState===\"ANNOTATION\"){btn_text = \"CONFIRM\";}\r\n    else if(StateMachineState===\"SENTENCE START\"){btn_text = \"CONFIRM\";}\r\n    else if(StateMachineState===\"SENTENCE END\"){btn_text = \"NEXT SENTENCE\";}\r\n    else if(StateMachineState===\"SUMMARY END\"){btn_text = \"SUBMIT\";}\r\n    else if(StateMachineState===\"REVISE CLICKED\"){btn_text = \"CONFIRM\";}\r\n\r\n    // add no align\r\n    if (StateMachineState!==\"START\" && !isDocSpanExist()) {\r\n      btn_text = btn_text + \"<br/>(NO ALIGN)\"\r\n    }\r\n    return btn_text\r\n  }\r\n\r\n  const getInfoAlertTitle = () => {\r\n    if(StateMachineState===\"ANNOTATION\"){return \"Find Alignments\"}\r\n    if(StateMachineState===\"SENTENCE START\"){return \"Find Alignments\";}\r\n    if(StateMachineState===\"SENTENCE END\"){return \"Finished Sentence\";}\r\n    if(StateMachineState===\"SUMMARY END\"){return \"Finished\";}\r\n    if(StateMachineState===\"REVISE HOVER\"){return \"Choose Alignment\";}\r\n    if(StateMachineState===\"REVISE CLICKED\"){return \"Adjust Alignments\";}\r\n  }\r\n\r\n  const InfoAlert = (InfoMessage) => {\r\n    return (\r\n      <Alert variant=\"info\">\r\n        <Alert.Heading>{getInfoAlertTitle()}</Alert.Heading>\r\n        <p className=\"mb-0\">\r\n          {InfoMessage}\r\n        </p>\r\n      </Alert>\r\n    )}\r\n\r\n\r\n    // const add_text_to_GuidedAnnotationInfoAlert = () => {\r\n    //   if(g_is_good_alignment) {\r\n    //     if(StateMachineState===\"ANNOTATION\"){return \"<br/><b>Hit the \\\"CONFIRM\\\" button to confirm&proceed.</b>\"}\r\n    //     if(StateMachineState===\"SENTENCE END\"){return \"<br/><b>Hit the \\\"NEXT SENTENCE\\\" button to confirm&proceed to the next sentence.</b>\"}\r\n    //     if(StateMachineState===\"SUMMARY END\"){return \"<br/><b>Hit the \\\"CONFIRM\\\" button to confirm&finish.</b>\"}\r\n    //   } else {\r\n    //     if(StateMachineState===\"SENTENCE END\"){return \"<br/>When you are finished, <b>hit the \\\"NEXT SENTENCE\\\" button</b> to confirm and proceed to the next sentence.\"}\r\n    //     if(StateMachineState===\"SUMMARY END\"){return \"<br/>When you are finished, <b>hit the \\\"SUBMIT\\\" button</b> to confirm and finish.\"}\r\n    //   }\r\n    //   return \"\"\r\n    // }\r\n\r\n    const GuidedAnnotationInfoAlert = () => {\r\n      return (\r\n        <Alert variant=\"warning\" className='guidedAnnotationInfoAlert'>\r\n          <Alert.Heading><Markup content={g_guiding_info_msg[\"title\"]} /></Alert.Heading>\r\n          <p className=\"mb-0\">\r\n          {(isGuidedAnnotation && g_show_hint && g_hint_msg!==undefined && g_hint_msg[\"Text\"]!==\"\") &&\r\n                    <OverlayTrigger className={`${(g_with_glow_hint)? 'with-glow':''}`} show={g_open_hint} placement=\"left\" overlay={GuidedAnnotationHint}>\r\n                      <Button className=\"guidedAnnotationHintButton\" active variant=\"btn btn-primary btn-lg right-button\" onClick={() => {g_setOpenHint(!g_open_hint); g_setWithGlowHint(false)}}>\r\n                          HINT\r\n                      </Button>\r\n                    </OverlayTrigger>\r\n          }\r\n            <Markup content={`${g_guiding_info_msg[\"text\"]}  ${add_text_to_GuidedAnnotationInfoAlert(g_is_good_alignment,StateMachineState, doc_json)}`} />\r\n          </p>\r\n        </Alert>\r\n      )}\r\n\r\n\r\n      const GuidedAnnotationHint = (\r\n        <Popover variant=\"primary\" className={`hintText ${(g_with_glow_hint)? 'with-glow-hint':''}`} id=\"popover-basic\">\r\n          <Popover.Header as=\"h3\">{g_hint_msg[\"title\"]}</Popover.Header>\r\n          <Popover.Body as=\"h4\">\r\n            <Markup content={`${g_hint_msg[\"text\"]}`} />\r\n          </Popover.Body>\r\n        </Popover>\r\n      );\r\n\r\n\r\n      \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  const DocOnMouseDownHandler = (tkn_id) => {\r\n    if (StateMachineState === \"START\"){ // during START state no highlighting\r\n      handleErrorOpen({ msg : \"Can't highlight words yet. Press \\\"START\\\" to begin.\"});\r\n    } else if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState)) {\r\n      SetDocOnMouseDownID(tkn_id);\r\n    }\r\n  }\r\n\r\n  const SummaryOnMouseDownHandler = (tkn_id) => {\r\n    if (StateMachineState === \"START\"){ // during START state no highlighting\r\n      handleErrorOpen({ msg : \"Can't highlight words yet. Press \\\"START\\\" to begin.\"});\r\n    }  \r\n    else if ((summary_json.filter((word) => {return word.tkn_id === tkn_id && word.sent_id !== CurrSentInd}).length !== 0) && (StateMachineState !== \"REVISE HOVER\")){ // check if span chosen is from the correct sentence first.\r\n      handleErrorOpen({ msg : \"Span chosen is not from the correct sentence.\" });\r\n      setSummaryOnMouseDownInCorrectSent(false);\r\n    } \r\n    else if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState)) {\r\n      SetSummaryOnMouseDownID(tkn_id);\r\n    }\r\n  }\r\n\r\n  const DocOnMouseUpHandler = () => {\r\n    if (StateMachineState === \"START\"){ // during START state no highlighting\r\n      return\r\n      // handleErrorOpen({ msg : \"Can't highlight words yet. Press \\\"START\\\" to begin.\"});\r\n    } else if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState)) {\r\n        const chosen_IDs = doc_json.filter((word) => {return word.span_alignment_hover}).map((word) => {return word.tkn_id})\r\n        if (ctrlButtonDown) {\r\n          toggleDocSpanHighlight({tkn_ids:chosen_IDs, turn_off:true});\r\n        } else {\r\n            toggleDocSpanHighlight({tkn_ids:chosen_IDs, turn_on:true});\r\n        }\r\n        SetDocOnMouseDownID(\"-1\"); \r\n    }\r\n  }\r\n\r\n  const SummaryOnMouseUpHandler = () => {\r\n    if (StateMachineState == \"START\"){ // during start state no clicking is needed\r\n      return\r\n      // handleErrorOpen({ msg : \"Can't highlight words yet. Press \\\"START\\\" to begin.\"});\r\n    } \r\n    else if ((summary_json.filter((word) => {return word.span_alignment_hover && word.sent_id !== CurrSentInd}).length !== 0) && (StateMachineState !== \"REVISE HOVER\") ){ // check if span chosen is from the correct sentence first.\r\n      handleErrorOpen({ msg : \"Span chosen is not from the correct sentence.\" });\r\n    } \r\n    else if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState) && summaryOnMouseDownInCorrectSent){   \r\n      console.log(\"up!\")\r\n      const chosen_IDs = summary_json.filter((word) => {return word.span_alignment_hover}).map((word) => {return word.tkn_id})\r\n      if (ctrlButtonDown) {\r\n        toggleSummarySpanHighlight({tkn_ids:chosen_IDs, turn_off:true});\r\n      } else {\r\n        toggleSummarySpanHighlight({tkn_ids:chosen_IDs, turn_on:true});\r\n      }   \r\n      SetSummaryOnMouseDownID(\"-1\");\r\n     } \r\n     else {\r\n      if (summaryOnMouseDownInCorrectSent && StateMachineState !== \"REVISE HOVER\") {console.log(`AVIVSL: state is ${StateMachineState}`); alert(`state not defined yet! state: ${StateMachineState}`);}\r\n    }\r\n\r\n    // reset the states\r\n    setSummaryOnMouseDownInCorrectSent(true)\r\n    SetSummaryOnMouseDownID(\"-1\")\r\n  }\r\n\r\n\r\n\r\n  const DocMouseClickHandlerWrapper = (tkn_id) => {\r\n    if ((StateMachineState === \"REVISE HOVER\") && (doc_json.filter((word) => {return word.tkn_id === tkn_id})[0].alignment_id.length > 0)) {\r\n        MachineStateHandlerWrapper({clickedWordInfo:[\"doc\", tkn_id]});\r\n    }\r\n  }\r\n\r\n  const SummaryMouseClickHandlerWrapper = (tkn_id) => {\r\n  if ((StateMachineState === \"REVISE HOVER\") && (summary_json.filter((word) => {return word.tkn_id === tkn_id})[0].alignment_id.length > 0)) {\r\n        MachineStateHandlerWrapper({clickedWordInfo:[\"summary\", tkn_id]});\r\n    }\r\n  }\r\n\r\n  // for the \"REVISE HOVER\" state\r\n  const hoverHandlerWrapper = ({inOrOut, curr_alignment_id, tkn_id, isSummary}) => {\r\n    if ((StateMachineState === \"REVISE CLICKED\") && (summary_json.filter((word) => {return word.tkn_id === tkn_id && word.sent_id > CurrSentInd}).length !== 0)){\r\n      return\r\n    } else if ((summary_json.filter((word) => {return word.tkn_id === tkn_id && word.sent_id !== CurrSentInd}).length !== 0) && !([\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState))) {\r\n      return\r\n    }\r\n    hoverHandler({inOrOut, curr_alignment_id, tkn_id, isSummary});\r\n  }\r\n\r\n  hoverHandlerWrapper.defaultProps = {\r\n    tkn_id: -1,\r\n    isSummary: false\r\n  }\r\n\r\n\r\n  const get_range = (start_i, end_i) => {\r\n    return [...Array(end_i - start_i + 1).keys()].map(x => x + start_i)\r\n  }\r\n\r\n  const getDocText = () => {\r\n    if ((!isTutorial || t_StateMachineStateId !== 7) && (!isGuidedAnnotation || g_answer_words_to_glow[\"type\"]!==\"doc_span\")){\r\n      return doc_json.map((word_json, index) => (\r\n                <DocWord key={index} word_json={word_json} doc_paragraph_breaks={doc_paragraph_breaks} StateMachineState={StateMachineState} DocMouseClickHandlerWrapper={DocMouseClickHandlerWrapper} hoverHandlerWrapper={hoverHandlerWrapper} DocOnMouseDownHandler={DocOnMouseDownHandler} DocOnMouseUpHandler={DocOnMouseUpHandler} setDocOnMouseDownActivated={setDocOnMouseDownActivated} docOnMouseDownActivated={docOnMouseDownActivated} setHoverActivatedId={setHoverActivatedId} ctrlButtonDown={ctrlButtonDown} setHoverActivatedDocOrSummary={setHoverActivatedDocOrSummary}/>\r\n              ))\r\n    } else if(isTutorial) {\r\n        const start_1 = 0;\r\n        const end_1 = 13;\r\n        const start_2 = end_1+1;\r\n        const end_2 = 104;\r\n        const start_3 = end_2+1;\r\n        const end_3 = 108;\r\n        const start_4 = end_3+1;\r\n        const end_4 = 417;\r\n        const span_groups = [doc_json.filter((word, ind) => {return ind>=start_1 && ind <=end_1}), doc_json.filter((word, ind) => {return ind>=start_2 && ind <=end_2}), doc_json.filter((word, ind) => {return ind>=start_3 && ind <=end_3}), doc_json.filter((word, ind) => {return ind>=start_4 && ind <=end_4})]\r\n        \r\n        return span_groups.map((summary_words, index) => \r\n                  <div className={`${([0,2].includes(index)) ?  'with-glow': ''}`}>\r\n                      {summary_words.map((word_json, index) => (\r\n                          <DocWord key={index} word_json={word_json} doc_paragraph_breaks={doc_paragraph_breaks} StateMachineState={StateMachineState} DocMouseClickHandlerWrapper={DocMouseClickHandlerWrapper} hoverHandlerWrapper={hoverHandlerWrapper} DocOnMouseDownHandler={DocOnMouseDownHandler} DocOnMouseUpHandler={DocOnMouseUpHandler} setDocOnMouseDownActivated={setDocOnMouseDownActivated} docOnMouseDownActivated={docOnMouseDownActivated} setHoverActivatedId={setHoverActivatedId} ctrlButtonDown={ctrlButtonDown} setHoverActivatedDocOrSummary={setHoverActivatedDocOrSummary}/>\r\n                        ))}\r\n                  </div>\r\n                )\r\n    } else {\r\n      \r\n      const doc_words_groups = get_span_groups(g_answer_words_to_glow, doc_json, false)\r\n      return doc_words_groups.map((doc_words, index) => \r\n      <div className={`${([1,3,5,7,9,11,13,15].includes(index)) ?  'with-glow': ''}`}>\r\n          {doc_words.map((word_json, index) => (\r\n              <DocWord key={index} word_json={word_json} doc_paragraph_breaks={doc_paragraph_breaks} StateMachineState={StateMachineState} DocMouseClickHandlerWrapper={DocMouseClickHandlerWrapper} hoverHandlerWrapper={hoverHandlerWrapper} DocOnMouseDownHandler={DocOnMouseDownHandler} DocOnMouseUpHandler={DocOnMouseUpHandler} setDocOnMouseDownActivated={setDocOnMouseDownActivated} docOnMouseDownActivated={docOnMouseDownActivated} setHoverActivatedId={setHoverActivatedId} ctrlButtonDown={ctrlButtonDown} setHoverActivatedDocOrSummary={setHoverActivatedDocOrSummary}/>\r\n            ))}\r\n      </div>\r\n    )\r\n\r\n    }\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n  const getSummaryText = () => {\r\n\r\n    // when rebooting\r\n    if (summary_json.length === 0){\r\n      return\r\n    } \r\n    else if (!isGuidedAnnotation || g_answer_words_to_glow[\"type\"]!==\"summary_span\") {\r\n      const max_sent_id = summary_json.map((word) =>{return word.sent_id}).reduce(function(a, b) {return Math.max(a, b)}, -Infinity);\r\n      const summary_per_sent_id = [...Array(max_sent_id+1).keys()].map((sent_id) => {return summary_json.filter((word) => {return word.sent_id===sent_id})})\r\n      return summary_per_sent_id.map((summary_words, index) => \r\n                                                        <div>\r\n                                                          <p  className={`${(index===CurrSentInd) ?  'bordered_sent': ''} ${(isTutorial && t_StateMachineStateId===4 && index===CurrSentInd) ? 'with-glow' : ''}`}>\r\n                                                            {summary_words.map((word_json, index) => (\r\n                                                              <SummaryWord key={index} word_json={word_json}  StateMachineState={StateMachineState} SummaryMouseClickHandlerWrapper={SummaryMouseClickHandlerWrapper} hoverHandlerWrapper={hoverHandlerWrapper} SummaryOnMouseDownHandler={SummaryOnMouseDownHandler} SummaryOnMouseUpHandler={SummaryOnMouseUpHandler} setSummaryOnMouseDownActivated={setSummaryOnMouseDownActivated} summaryOnMouseDownActivated={summaryOnMouseDownActivated} setHoverActivatedId={setHoverActivatedId}  ctrlButtonDown={ctrlButtonDown} setHoverActivatedDocOrSummary={setHoverActivatedDocOrSummary}/> \r\n                                                              ))}\r\n                                                          </p>\r\n                                                          <span className=\"br-class\"></span>\r\n                                                        </div>\r\n                                                        )\r\n    }\r\n    else {\r\n      const doc_words_groups = get_span_groups(g_answer_words_to_glow, summary_json)\r\n      const max_sent_id = summary_json.map((word) =>{return word.sent_id}).reduce(function(a, b) {return Math.max(a, b)}, -Infinity);\r\n      const summary_per_sent_id = [...Array(max_sent_id+1).keys()].map((sent_id) => {return summary_json.filter((word) => {return word.sent_id===sent_id})})\r\n      return summary_per_sent_id.map((summary_words, index) => \r\n                                                        <div>\r\n                                                          <p  className={`${(index===CurrSentInd) ?  'bordered_sent': ''}`}>\r\n                                                            {(index===CurrSentInd) && (\r\n                                                              get_span_groups(g_answer_words_to_glow, summary_words, true).map((words, index) => \r\n                                                                <div className={`${([1,3,5,7,9,11,13,15].includes(index)) ?  'with-glow': ''}`}>\r\n                                                                    {words.map((word_json, index) => (\r\n                                                                      <SummaryWord key={index} word_json={word_json}  StateMachineState={StateMachineState} SummaryMouseClickHandlerWrapper={SummaryMouseClickHandlerWrapper} hoverHandlerWrapper={hoverHandlerWrapper} SummaryOnMouseDownHandler={SummaryOnMouseDownHandler} SummaryOnMouseUpHandler={SummaryOnMouseUpHandler} setSummaryOnMouseDownActivated={setSummaryOnMouseDownActivated} summaryOnMouseDownActivated={summaryOnMouseDownActivated} setHoverActivatedId={setHoverActivatedId}  ctrlButtonDown={ctrlButtonDown} setHoverActivatedDocOrSummary={setHoverActivatedDocOrSummary}/> \r\n                                                                    ))}\r\n                                                                </div>\r\n                                                              )\r\n                                                            )}\r\n\r\n                                                            {(index!==CurrSentInd) && (summary_words.map((word_json, index) => (\r\n                                                              <SummaryWord key={index} word_json={word_json}  StateMachineState={StateMachineState} SummaryMouseClickHandlerWrapper={SummaryMouseClickHandlerWrapper} hoverHandlerWrapper={hoverHandlerWrapper} SummaryOnMouseDownHandler={SummaryOnMouseDownHandler} SummaryOnMouseUpHandler={SummaryOnMouseUpHandler} setSummaryOnMouseDownActivated={setSummaryOnMouseDownActivated} summaryOnMouseDownActivated={summaryOnMouseDownActivated} setHoverActivatedId={setHoverActivatedId}  ctrlButtonDown={ctrlButtonDown} setHoverActivatedDocOrSummary={setHoverActivatedDocOrSummary}/> \r\n                                                              )))}\r\n                                                          </p>\r\n                                                          <span className=\"br-class\"></span>\r\n                                                        </div>\r\n                                                        )\r\n    }\r\n  }\r\n\r\n  const getResponsiveAppBarTitle = () => {\r\n    if (isTutorial){\r\n      return \"Tutorial\";\r\n    } else if (isGuidedAnnotation) {\r\n      return \"Guided Annotation\";\r\n    } else {\r\n      return \"Annotation\";\r\n    }\r\n  }\r\n\r\n\r\n\r\n  const outsideSummarySent = useRef(true)\r\n  const RedHintSmoother = (event) => {\r\n    if(DocOnMouseDownID!==\"-1\" || SummaryOnMouseDownID!==\"-1\" || StateMachineState===\"REVISE HOVER\" || event.target.parentNode.parentNode.parentNode.className===undefined) {\r\n      return\r\n    } else if (!event.target.parentNode.parentNode.parentNode.className.includes(\"bordered_sent\")) {\r\n      if(!outsideSummarySent.current){\r\n        setHoverActivatedId(\"-1\")\r\n        outsideSummarySent.current=true\r\n      } else if (doc_json.filter((word) => {return word.red_color}).length!==0) {\r\n        setDocJson(doc_json.map((word) => {return {...word, red_color:false}}))\r\n      }\r\n    } else {\r\n      if(hoverActivatedId===\"-1\"){\r\n        setHoverActivatedId(parseInt(event.target.parentElement.id.match(/\\d+/)[0]))\r\n      }\r\n      outsideSummarySent.current = false\r\n    }\r\n  }\r\n\r\n\r\n\r\n  \r\n\r\n/************ TO MAKE SURE THAT WHEN DOC TOO LONG THE SUMMARY IS ALWAYS VISIBLE ****************************** */\r\nconst containerRef = useRef(null)\r\nconst prevIsVisibleFullySummary = useRef(false)\r\nconst [ isVisibleFullySummary, setIsVisibleFullySummary ] = useState(true)\r\n\r\nconst callbackFunction = (entries) => {\r\n  const [ entry ] = entries\r\n  prevIsVisibleFullySummary.current = isVisibleFullySummary;\r\n  setIsVisibleFullySummary(entry.isIntersecting)\r\n}\r\n\r\nconst options = {\r\n  root: null,\r\n  rootMargin: \"0px\",\r\n  threshold:0.01\r\n}\r\n\r\nuseEffect(() => {\r\n  \r\n  const observer = new IntersectionObserver(callbackFunction, options)\r\n  if (containerRef.current) observer.observe(containerRef.current)\r\n  \r\n  return () => {\r\n    if(containerRef.current) observer.unobserve(containerRef.current)\r\n  }\r\n}, [containerRef, options])\r\n/************************************************************************************************************* */\r\n\r\n\r\nuseEffect(() => {\r\n  console.log(`g_hint_msg:`)\r\n  console.log(g_hint_msg)\r\n}, []);\r\n\r\n\r\n// // to make sure the guided annotation guiding messages start with something\r\n  // useEffect(() => {\r\n  //   console.log(`StateMachineState is: ${StateMachineState}`)\r\n  //   if (StateMachineState===\"START\") {\r\n  //     setGuidedAnnotationMessage(\"To begin, press the \\\"START\\\" button.\")\r\n  //   }\r\n  // }, []);\r\n\r\n  // reset clickings between states\r\n  useEffect(() => {\r\n    SetDocMouseDownStartID(\"-1\");\r\n    SetDocMouseclicked(false);\r\n    SetSummaryMouseDownStartID(\"-1\");\r\n    SetSummaryMouseclicked(false);\r\n  }, [StateMachineState]);\r\n  \r\n\r\n\r\n    useEffect(() => {\r\n      if (!ctrlButtonDown){\r\n        if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState)) {\r\n        const doc_chosen_IDs = doc_json.filter((word) => {return word.span_alignment_hover}).map((word) => {return word.tkn_id})\r\n        toggleDocSpanHighlight({tkn_ids:doc_chosen_IDs, turn_off:true});\r\n        const summary_chosen_IDs = summary_json.filter((word) => {return word.span_alignment_hover}).map((word) => {return word.tkn_id})\r\n        toggleSummarySpanHighlight({tkn_ids:summary_chosen_IDs, turn_off:true});\r\n        }\r\n      }\r\n    }, [ctrlButtonDown]);\r\n\r\n    // when approving no alignment - close modal and call MachineStateHandlerWrapper\r\n    useEffect(() => {\r\n      if (noAlignApproved) {\r\n        setNoAlignModalShow(false);\r\n        if (StateMachineState === \"SUMMARY END\") {\r\n          SubmitHandler()\r\n        } else {\r\n          MachineStateHandlerWrapper({});\r\n        }\r\n      }\r\n    }, [noAlignApproved])\r\n\r\n  // whenever entering the guided annotation - will go to the top\r\n  useEffect(() => {\r\n    window.scrollTo(0, 0)\r\n  }, [])\r\n\r\n    // ask turkers to go over the tutorial and the guided annotation\r\n    // useEffect(() => {\r\n    //   setOpeningModalShow(false)\r\n    // }, [])\r\n\r\n\r\n  \r\n\r\n  return (\r\n    <div \r\n      onMouseUp={() => {SummaryOnMouseUpHandler(); DocOnMouseUpHandler();}}\r\n      onKeyDown={(event) => {if (event.ctrlKey || event.altKey) {setCtrlButtonDown(true)}}}\r\n      onKeyUp={() => {setCtrlButtonDown(false)}}\r\n      onMouseOver={(event) => RedHintSmoother(event)}\r\n    >\r\n      <Container tabIndex=\"0\" className='annotation-container'>\r\n        <Row className='annotation-row' ref={containerRef}>\r\n          <Col>\r\n            <ResponsiveAppBar\r\n                  title={getResponsiveAppBarTitle()} \r\n                  StateMachineState = {StateMachineState} \r\n                  MachineStateHandlerWrapper={MachineStateHandlerWrapper}\r\n                  boldState={boldState}\r\n                  boldStateHandler={boldStateHandler}\r\n                  oldAlignmentState={oldAlignmentState}\r\n                  oldAlignmentStateHandler={oldAlignmentStateHandler}\r\n                  t_StateMachineStateId = {t_StateMachineStateId}\r\n                  g_showWhereNavbar = {g_showWhereNavbar}\r\n            />\r\n            {(InfoMessage !== \"\" && !isTutorial && !isGuidedAnnotation) && (InfoAlert(InfoMessage))}\r\n            {(isTutorial) && (<TutorialCard t_StateMachineStateId = {t_StateMachineStateId} \r\n                                            t_SetStateMachineStateId = {t_SetStateMachineStateId}\r\n                                            t_state_messages = {t_state_messages}\r\n                                            SetStateMachineState = {SetStateMachineState}\r\n                                            setDocJson = {setDocJson} \r\n                                            t_start_doc_json = {t_start_doc_json}\r\n                                            t_middle_doc_json = {t_middle_doc_json} \r\n                                            t_sent_end_doc_json = {t_sent_end_doc_json} \r\n                                            t_submit_doc_json = {t_submit_doc_json}\r\n                                            setSummaryJson = {setSummaryJson} \r\n                                            t_start_summary_json = {t_start_summary_json} \r\n                                            t_middle_summary_json = {t_middle_summary_json} \r\n                                            t_sent_end_summary_json = {t_sent_end_summary_json} \r\n                                            t_submit_summary_json = {t_submit_summary_json}\r\n                                            SetCurrSentInd = {SetCurrSentInd}\r\n                                            MachineStateHandlerWrapper = {MachineStateHandlerWrapper} />)}\r\n            {(isGuidedAnnotation && [\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState)) && (GuidedAnnotationInfoAlert())}\r\n            {(isGuidedAnnotation && ![\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState) && g_show_hint && g_hint_msg!==undefined && g_hint_msg[\"Text\"]!==\"\") &&\r\n                    <OverlayTrigger className={`${(g_with_glow_hint)? 'with-glow':''}`} show={g_open_hint} placement=\"right\" overlay={GuidedAnnotationHint}>\r\n                      <Button className=\"guidedAnnotationHintButton2\" active variant=\"btn btn-primary btn-lg\" onClick={() => {g_setOpenHint(!g_open_hint); g_setWithGlowHint(false)}}>\r\n                          HINT\r\n                      </Button>\r\n                    </OverlayTrigger>\r\n          }\r\n\r\n\r\n\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* {(isGuidedAnnotation && guidingAnnotationAlertText!==\"\") && (\r\n          guidingAnnotationAlert(guidingAnnotationAlertText, guidingAnnotationAlertTitle, guidingAnnotationAlertType, closeGuidingAnnotationAlert)\r\n        )} */}\r\n        \r\n\r\n        {/* {isGuidedAnnotation && (\r\n              GuidedAnnotationToast(toastVisible, setToastVisible, g_StateMachineStateIndex)\r\n        )} */}\r\n\r\n        {(!isTutorial || [4,6,7].includes(t_StateMachineStateId)) && (\r\n          <Row className='annotation-row' id={`${(InfoMessage === \"\" || isGuidedAnnotation) ? 'doc-summary-row': ''}`}>\r\n            <Col md={ 8 }>\r\n              <Card border=\"secondary\" bg=\"light\"  id=\"doc-text\" ref={docGuider}>\r\n                  <Card.Header>Document</Card.Header>\r\n                  <Card.Body>\r\n                    {getDocText()}\r\n                    {/* {doc_json.map((word_json, index) => (\r\n                        <DocWord key={index} word_json={word_json} doc_paragraph_breaks={doc_paragraph_breaks} StateMachineState={StateMachineState} DocMouseClickHandlerWrapper={DocMouseClickHandlerWrapper} hoverHandlerWrapper={hoverHandlerWrapper} DocOnMouseDownHandler={DocOnMouseDownHandler} DocOnMouseUpHandler={DocOnMouseUpHandler} setDocOnMouseDownActivated={setDocOnMouseDownActivated} docOnMouseDownActivated={docOnMouseDownActivated} setHoverActivatedId={setHoverActivatedId} ctrlButtonDown={ctrlButtonDown} setHoverActivatedDocOrSummary={setHoverActivatedDocOrSummary}/>\r\n                      ))}; */}\r\n                  </Card.Body>\r\n                </Card>\r\n            </Col>\r\n\r\n            <Col md={4}>\r\n              <div id={`${(isVisibleFullySummary) ?  '': 'fixed-summary-and-buttons'}`}>\r\n              <Row>\r\n                <Col>\r\n                  <Card border=\"secondary\" bg=\"light\" id=\"summary-text\" ref={summaryGuider}>\r\n                    <Card.Header>Summary</Card.Header>\r\n                    <Card.Body>\r\n                      {getSummaryText()}\r\n                      {/* {summary_json.map((word_json, index) => (\r\n                        <SummaryWord key={index} word_json={word_json}  StateMachineState={StateMachineState} SummaryMouseClickHandlerWrapper={SummaryMouseClickHandlerWrapper} hoverHandlerWrapper={hoverHandlerWrapper} SummaryOnMouseDownHandler={SummaryOnMouseDownHandler} SummaryOnMouseUpHandler={SummaryOnMouseUpHandler} setSummaryOnMouseDownActivated={setSummaryOnMouseDownActivated} summaryOnMouseDownActivated={summaryOnMouseDownActivated} setHoverActivatedId={setHoverActivatedId}  ctrlButtonDown={ctrlButtonDown} setHoverActivatedDocOrSummary={setHoverActivatedDocOrSummary}/> \r\n                      ))}; */}\r\n                    </Card.Body>\r\n                  </Card>\r\n                </Col>\r\n              </Row>\r\n\r\n              {!isTutorial && (\r\n                <Row className=\"justify-content-md-center\">\r\n                    {[\"SUMMARY END\", \"SENTENCE END\", \"ANNOTATION\", \"SENTENCE START\"].includes(StateMachineState) && (\r\n                      <Col>\r\n                        <button type=\"button\" className={`btn btn-dark btn-lg ${(isTutorial && t_StateMachineStateId===11) ? 'with-glow' : ''}`} onClick={() => MachineStateHandlerWrapper({forceState:\"REVISE HOVER\"})}>REVISE</button>\r\n                      </Col>\r\n                    )}\r\n\r\n                    {StateMachineState === \"REVISE HOVER\" && (\r\n                      <Col>\r\n                        <button ref={ExitReviseButtonGuider} type=\"button\" className={`btn btn-success btn-lg ${(isTutorial && t_StateMachineStateId===11) ? 'with-glow' : ''}`} onClick={() => MachineStateHandlerWrapper({forceState:\"FINISH REVISION\"})}>EXIT REVISION</button>\r\n                      </Col>\r\n                    )}\r\n\r\n                  {StateMachineState === \"REVISE CLICKED\" && (\r\n                      <Col md={{span:4, offset:0}}>\r\n                        <button ref={backButtonGuider} type=\"button\" className={`btn btn-secondary btn-lg ${(isTutorial && t_StateMachineStateId===11) ? 'with-glow' : ''}`} onClick={() => MachineStateHandlerWrapper({forceState:\"REVISE HOVER\", isBackBtn:true })}>\r\n                        <ChevronLeft className=\"button-icon\"/>\r\n                        BACK\r\n                        </button>\r\n                      </Col>\r\n                    )}\r\n\r\n                  {![\"REVISE HOVER\", \"SUMMARY END\", \"SENTENCE END\", \"START\"].includes(StateMachineState) && (\r\n                      <Col md={{span:5, offset:3}}>\r\n                        <button ref={nextButtonGuider} type=\"button\" className={`btn ${(isDocSpanExist())? 'btn-success':'btn-danger'} btn-lg right-button ${((isTutorial && [5,11,14].includes(t_StateMachineStateId)) || (isGuidedAnnotation && g_is_good_alignment)) ? 'with-glow' : ''}`} onClick={MachineStateHandlerWrapper}>\r\n                        <Markup content={nextButtonText()} />\r\n                          {(isDocSpanExist()) && <ChevronRight className=\"button-icon\"/>}\r\n                        </button>\r\n                      </Col>\r\n                  )}\r\n\r\n                  {StateMachineState === \"START\"  && (\r\n                        <Col md={{span:3, offset:9}}>\r\n                          <button ref={nextButtonGuider} type=\"button\" className={`btn btn-primary btn-lg right-button ${(isGuidedAnnotation || isTutorial) ? 'with-glow' : ''}`} onClick={MachineStateHandlerWrapper}>\r\n                          <Markup content={nextButtonText()} />\r\n                          </button>\r\n                        </Col>\r\n                    )}\r\n\r\n                  {StateMachineState === \"SENTENCE END\"  && (\r\n                        <Col md={{span:7, offset:1}}>\r\n                          <button ref={nextButtonGuider} type=\"button\" className={`btn ${(isDocSpanExist())? 'btn-success':'btn-danger'} btn-lg right-button ${((isTutorial && t_StateMachineStateId===12) || (isGuidedAnnotation && g_is_good_alignment)) ? 'with-glow' : ''}`} onClick={MachineStateHandlerWrapper}>\r\n                            <Markup content={nextButtonText()} /> \r\n                            {(StateMachineState !== \"START\" && isDocSpanExist()) && (<ChevronRight className=\"button-icon\"/>) }\r\n                          </button>\r\n                        </Col>\r\n                    )}\r\n\r\n                  {StateMachineState === \"SUMMARY END\" && (\r\n                    <Col md={{span:5, offset:3}}>\r\n                      <button ref={nextButtonGuider} type=\"button\" className={`btn ${(isDocSpanExist())? 'btn-success':'btn-danger'} btn-lg right-button ${((isTutorial && t_StateMachineStateId===13) || (isGuidedAnnotation && g_is_good_alignment)) ? 'with-glow' : ''}`} onClick={SubmitHandler}>\r\n                        <Markup content={nextButtonText()} />\r\n                        {(StateMachineState !== \"START\" && isDocSpanExist()) && (<SendFill className=\"button-icon\"/>) }\r\n                      </button>\r\n                    </Col>\r\n                  )}\r\n                </Row>\r\n              )}\r\n              </div>\r\n            </Col>\r\n          </Row>\r\n        )}\r\n\r\n\r\n\r\n        {(isTutorial && ![0,4,6,7,15].includes(t_StateMachineStateId)) && (\r\n\r\n          <Row className='annotation-row' id='doc-summary-row'>\r\n            <Col>\r\n              <Player\r\n                playsInline\r\n                src={`./Videos/${getTutorialCardTitle(t_state_messages,t_StateMachineStateId).replace(/\\s+/g, '-').toLowerCase()}.mp4`}\r\n                fluid={false}\r\n                aspectRatio=\"auto\"\r\n              >\r\n                <BigPlayButton position=\"center\" />\r\n              </Player>\r\n            </Col>\r\n          </Row>\r\n        )}\r\n      </Container>\r\n\r\n      <Modal  aria-labelledby=\"contained-modal-title-vcenter\" centered show={OpeningModalShow && !isTutorial && !isGuidedAnnotation} onHide={() => {setOpeningModalShow(false)}}>\r\n                  <Modal.Header closeButton>\r\n                    <Modal.Title>Attention!</Modal.Title>\r\n                  </Modal.Header>\r\n                  <Modal.Body>\r\n                    Please get the required training by going over the <u>Tutorial</u> and performing the <u>Guided Annotation</u> at least once.\r\n                    <br/>\r\n                    If you have already done both, you may skip the training and proceed directly to the task.\r\n                  </Modal.Body>\r\n                  <Modal.Footer>\r\n                    <Button variant=\"btn btn-secondary btn-lg right-button\" onClick={() => {setOpeningModalShow(false)}}>\r\n                      SKIP TRAINING\r\n                    </Button>\r\n                    <Link to=\"/tutorial\">\r\n                      <Button className=\"btn btn-success btn-lg right-button\">\r\n                        BEGIN\r\n                      </Button>\r\n                    </Link>\r\n                  </Modal.Footer>\r\n        </Modal>\r\n\r\n        <Modal style={{ zIndex:\"100001\" }} aria-labelledby=\"contained-modal-title-vcenter\" centered show={noAlignModalShow} onHide={() => {setNoAlignModalShow(false)}}>\r\n                  <Modal.Header closeButton>\r\n                    <Modal.Title>Are You Sure?</Modal.Title>\r\n                  </Modal.Header>\r\n                  <Modal.Body>\r\n                    Are you sure this summary span is un-aligned?\r\n                  </Modal.Body>\r\n                  <Modal.Footer>\r\n                    <Button variant=\"btn btn-danger btn-lg right-button\" onClick={() => {setNoAlignModalShow(false)}}>\r\n                      NO\r\n                    </Button>\r\n                    <Button variant=\"btn btn-success btn-lg right-button\" onClick={() => {setNoAlignApproved(true)}}>\r\n                        YES\r\n                    </Button>\r\n                  </Modal.Footer>\r\n        </Modal>\r\n\r\n\r\n        <Overlay target={docGuider.current} show={isGuidedAnnotation && g_Guider_msg[\"where\"]===\"doc\" && g_Guider_msg[\"text\"]!==\"\"} placement=\"right\">\r\n          {(props) => (\r\n            <Tooltip {...props} id={`${(g_Guider_msg[\"type\"]===\"info\")? \"overlay-doc-info-guider\":\"overlay-doc-reveal-answer-guider\"}`}>\r\n                <Markup content={g_Guider_msg[\"text\"]} />\r\n            </Tooltip>\r\n          )}\r\n        </Overlay>\r\n\r\n        <Overlay target={summaryGuider.current} show={isGuidedAnnotation && g_Guider_msg[\"where\"]===\"summary\" && g_Guider_msg[\"text\"]!==\"\"} placement=\"left\">\r\n          {(props) => (\r\n            <Tooltip {...props}  id={`${(g_Guider_msg[\"type\"]===\"info\")? \"overlay-summary-info-guider\":\"overlay-summary-reveal-answer-guider\"}`}>\r\n                <Markup content={g_Guider_msg[\"text\"]} />\r\n            </Tooltip>\r\n          )}\r\n        </Overlay>\r\n\r\n        <Overlay target={nextButtonGuider.current} show={isGuidedAnnotation && g_Guider_msg[\"where\"]===\"next-button\" && g_Guider_msg[\"text\"]!==\"\" && !g_FinishedModalShow} placement=\"bottom\">\r\n          {(props) => (\r\n            <Tooltip {...props}  id={`${(StateMachineState===\"START\")? \"overlay-start-button-guider\":\"overlay-next-button-guider\"}`}>\r\n                <Markup content={g_Guider_msg[\"text\"]} />\r\n            </Tooltip>\r\n          )}\r\n        </Overlay>\r\n        \r\n        {StateMachineState === \"REVISE CLICKED\" && (\r\n        <Overlay target={backButtonGuider.current} show={isGuidedAnnotation} placement=\"bottom\">\r\n          {(props) => (\r\n            <Tooltip {...props}  id=\"overlay-back-button-guider\">\r\n                If you regret your changes, press me to dicard them!\r\n            </Tooltip>\r\n          )}\r\n        </Overlay>\r\n        )}\r\n\r\n        {StateMachineState === \"REVISE HOVER\" && (\r\n        <Overlay target={ExitReviseButtonGuider.current} show={isGuidedAnnotation} placement=\"bottom\">\r\n          {(props) => (\r\n            <Tooltip {...props}  id=\"overlay-finish-revision-button-guider\">\r\n                When you are satisfied with all your revisions, press me to exit the revision mode.\r\n            </Tooltip>\r\n          )}\r\n        </Overlay>\r\n        )}\r\n\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Annotation","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\StartPage.js",["174","175","176","177"],[],"import { Link } from 'react-router-dom';\r\nimport * as React from 'react';\r\nimport AppBar from '@mui/material/AppBar';\r\nimport Toolbar from '@mui/material/Toolbar';\r\nimport Typography from '@mui/material/Typography';\r\nimport Container from '@mui/material/Container';\r\nimport Box from '@mui/material/Box';\r\nimport Button from '@mui/material/Button';\r\nimport ButtonGroup from '@mui/material/ButtonGroup';\r\nimport { spacing } from \"@material-ui/system\";\r\n\r\n\r\n\r\nconst pages = {'Instructions': 'instructions', 'Guided Annotation': 'guidedAnnotation'}; \r\n\r\n\r\n\r\nconst StartPage = () => {\r\n  return (\r\n    <>\r\n      {/* <header className='GeneralPageHeader'>\r\n          <h2>Highlighting Extraction UI</h2>\r\n      </header> */}\r\n\r\n      <AppBar id=\"startPageAppBar\" position=\"static\">\r\n      <div>\r\n        <Container maxWidth=\"xl\">\r\n          <Toolbar disableGutters>\r\n          <Typography\r\n            variant=\"h6\"\r\n            noWrap\r\n            component=\"div\"\r\n            sx={{ mr: 2, display: { xs: 'none', md: 'flex' } }}\r\n          >\r\n            Highlighting Extraction UI\r\n          </Typography>\r\n\r\n          <Typography\r\n            variant=\"h6\"\r\n            noWrap\r\n            component=\"div\"\r\n            sx={{ my: 2, flexGrow: 1, display: {xs: 'flex', md: 'none' } }}\r\n          >\r\n            Highlighting Extraction UI\r\n          </Typography>\r\n          </Toolbar>\r\n        </Container>\r\n      </div>\r\n    </AppBar>\r\n\r\n    <div className=\"jumbotron text-center StartPageBody\" /*className='StartPageBody'*/>\r\n        <div className='StartPageText'>\r\n          <p id=\"StartPageTitle\">\r\n            Welcome to\r\n            <br></br>\r\n            the Highlight Extraction UI\r\n          </p>\r\n          <p id=\"StartPageContent\">Before starting annotating, please read the Instructions first and practice using the Guided Annotation option.</p>\r\n\r\n          <div id=\"ButtonGroupBox\">\r\n            {/* <ButtonGroup> */}\r\n              <Button className=\"StartPageButton\" variant=\"contained\" color=\"primary\" component={Link} to={'/instructions'} >Instructions</Button>\r\n              <Button className=\"StartPageButton\" variant=\"contained\" color=\"secondary\" component={Link} to={'/guidedAnnotation'}>Guided<br></br>Annotation</Button>\r\n              <Button className=\"StartPageButton\" variant=\"contained\" color=\"success\" component={Link} to={'/annotation'}>Annotation</Button>\r\n            {/* </ButtonGroup> */}\r\n          </div>\r\n        </div>\r\n    </div>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default StartPage","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\Instructions.js",["178"],[],"import BackButton from './BackButton'\r\nimport ResponsiveAppBar from './ResponsiveAppBar'\r\nimport start_window_img from '../data/Instructions_img/start.JPG'; // Tell webpack this JS file uses this image\r\nimport some_span_chosen_img from '../data/Instructions_img/some_span_chosen.JPG'; // Tell webpack this JS file uses this image\r\nimport appbar_img from '../data/Instructions_img/appbar.JPG'; // Tell webpack this JS file uses this image\r\nimport revise_hover_img from '../data/Instructions_img/revise_hover.png'; // Tell webpack this JS file uses this image\r\nimport revise_clicked_img from '../data/Instructions_img/revise_clicked.JPG'; // Tell webpack this JS file uses this image\r\nimport appbar_finish_revision_img from '../data/Instructions_img/appbar_finish_revision.JPG'; // Tell webpack this JS file uses this image\r\nimport submit_img from '../data/Instructions_img/submit.JPG'; // Tell webpack this JS file uses this image\r\n\r\n\r\nconst Instructions = () => {\r\n  return (\r\n    <>\r\n        <ResponsiveAppBar\r\n           title={\"Instructions\"}\r\n        />\r\n      <div>\r\n        <section  className=\"InstructionsBody\">\r\n          <h4>\r\n            In this task, you are presented with a document and its summary. \r\n            <br></br>\r\n            The summary was constructed by an expert summarizer who first highlighted important information in the document and then merged it in a coherent manner. \r\n            <br></br>\r\n            Your goal is to locate those spans the summarizer highlighted.\r\n            <br></br>\r\n            You will first be presented with the summary and document without any extra markings:\r\n            <br></br>\r\n            <img className=\"instruction_images\" src={start_window_img} alt=\"start\" />\r\n            <br></br>\r\n            We encourage you to skim through the summary so you are familiar with its content, before starting.\r\n            <br></br>\r\n            You will work sentence by sentence, where you will not be able to continue to the next sentence before \"highlighting\" all of the current sentence's words.\r\n            <br></br>\r\n            To help you focus, the sentence you need to work on will be in bold.\r\n            <br></br>\r\n            You goal is to choose alignments between the summary and the doc. To help you, when highlighting a span from the document,  all the words in the document who have identical or relating words to that span will be <text className=\"boldfaced-word\">boldfaced and increased:</text>\r\n            <br></br>\r\n            <img className=\"instruction_images\" src={some_span_chosen_img} alt=\"some_span_chosen\" />\r\n            <br></br>\r\n            <br></br>\r\n            <br></br>\r\n            If no span was chosen, all the words in the document who have identical or relating words in current sentence will be <text className=\"boldfaced-word\">boldfaced and increased</text>.\r\n            <br></br>\r\n            At any given time, you can adjust the level of bolding, using the slider at the top-right corner of the UI:\r\n            <br></br>\r\n            <img className=\"instruction_images\" src={appbar_img} alt=\"appbar\" />\r\n            <br></br>\r\n            with the following bolding options:\r\n            <ul>\r\n              <li >No bolding (leftmost)</li>\r\n              <li>Current span bolding (middle)</li>\r\n              <li>Current sentence bolding (rightmost)</li>\r\n            </ul>\r\n            <br></br>\r\n            You will work in iterations:\r\n            <ol>\r\n              <li>\r\n                Start by choosing a subspan of the summary sentence which contains at least one event (by highlighting it).\r\n                <br></br>\r\n                This will boldface all the words in the document identical or similar to those in the span.\r\n              </li>\r\n\r\n              <li>Then, highlight spans in the document aligning to the information in the span.</li>\r\n              <li>Before heading on to the next span, please make sure you covered all the span's information and only it. If needed, make adjustments to the highlightings.</li>\r\n            </ol>\r\n            When finishing all the summary document, wou would be able to continue to the next sentence.\r\n            You may follow these questions to help you decide what span to choose:\r\n            <ul>\r\n              <li>Is the information presented in the span missing something? Or is it self-informative?</li>\r\n              <li>Is the information presented in the span specific? Or is it too general?</li>\r\n            </ul>\r\n            For long sentences, we strongly advice against highlighting the full sentence all at once, as doing so could lead to missing small details.\r\n            <br></br>\r\n            Alternatively, if a sentence is short enough, aligning it all at once is acceptable.\r\n            <br></br>\r\n            When choosing a span, a general rule of thumb should be a span that when reading it, you manage to remember all the details in it.\r\n            <br></br>\r\n            For example, the sentence:\r\n          </h4>\r\n          \r\n          <h3>\r\n            Sixty Forest Service firefighters brought Michigan's four-day Hiawatha\r\n            <br></br> \r\n            National Forest fire under control after it burned 1100 acres of woodlands.\r\n          </h3>\r\n\r\n          <h4>\r\n            can be seperated like this:\r\n\r\n            <ol>\r\n              <li>Sixty Forest Service firefighters brought Michigan's four-day Hiawatha National Forest fire under control</li>\r\n              <li>fire under control after it burned 1100 acres of woodlands.</li>\r\n            </ol>\r\n\r\n            Or like this:\r\n\r\n            <ol>\r\n              <li>Sixty Forest Service firefighters brought ... fire under control</li>\r\n              <li>Michigan's four-day Hiawatha National Forest fire</li>\r\n              <li>fire under control after it burned 1100 acres of woodlands.</li>\r\n            </ol>\r\n            and shouldn't be handled all at once.\r\n            <br></br>\r\n            <b> Notice! Make sure that what you highlight in the document covers all the information in the summary and only it.</b>\r\n            <br></br>\r\n            After choosing and confirming alignments, they will be shown in light-gray color (in juxtaposition to currenly chosen alignments, which are in yellow).\r\n             At any given time, you can adjust how much of previously chosen alignments to see, using the slider adjacent to the bolding slider (see image above), with the following options:\r\n            <ul>\r\n              <li>No previous highlightings (leftmost)</li>\r\n              <li>Only Current sentence's previous highlightings (middle)</li>\r\n              <li>All previous highlightings (rightmost)</li>\r\n            </ul>\r\n            \r\n            In addition, you can also revise old highlightings, by clicking the \"REVISE\" button that is located on the right side of the app-bar (see image above). \r\n            <br></br>\r\n            When in \"Revise\" mode you can hover over old highlightings, and their alignments will show to help you choose:\r\n            <br></br>\r\n            <img className=\"instruction_images\" src={revise_hover_img} alt=\"revise_hover\" />\r\n            <br></br>\r\n            <br></br>\r\n            <br></br>\r\n            By clicking one of them, only the chosen alignment will stay, which you could then revise:\r\n            <br></br>\r\n            <img className=\"instruction_images\" src={revise_clicked_img} alt=\"revise_clicked\" />\r\n            <br></br>\r\n            <br></br>\r\n            <br></br>\r\n            When finishing revising, you will need to return to the main session to continue, by clicking the \"FINISH REVISION\" button at the top of the window:\r\n            <br></br>\r\n            <img className=\"instruction_images\" src={appbar_finish_revision_img} alt=\"appbar_finish_revision\" />\r\n            <br></br>\r\n            <br></br>\r\n            <br></br>\r\n\r\n            Finally, after finishing the last summary sentence, you will be able to submit:\r\n            <img className=\"instruction_images\" src={submit_img} alt=\"submit\" />\r\n          </h4>\r\n        </section>\r\n      </div>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Instructions\r\n",["179","180"],"C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\Annotation_event_handlers.js",["181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252"],[],"const MachineStateHandler = (summary_json,\r\n                                 StateMachineState, SetStateMachineState,\r\n                                 SetInfoMessage, handleErrorOpen, isPunct,\r\n                                 CurrSentInd, SetCurrSentInd, SetSummaryShadow,\r\n                                 AlignmentCount, SetAlignmentCount,\r\n                                 approveHighlightHandler,\r\n                                 clickedWordInfo, forceState, \r\n                                 StartReviseStateHandler, ExitReviseHandler,\r\n                                 ReviseChooseAlignHandler,\r\n                                 isBackBtn,\r\n                                 setPrevSummaryJsonRevise, setPrevDocJsonRevise) => {\r\n\r\n\r\n\r\n    // forceState: \"SENTENCE END\"\r\n    if (forceState === \"SENTENCE END\"){\r\n      console.log(`forceState: \\\"SENTENCE END\\\"`);\r\n      SetStateMachineState(\"SENTENCE END\");\r\n      SetInfoMessage(\"Finished sentence highlighting. When ready, press \\\"NEXT SENTENCE\\\".\");\r\n    }\r\n\r\n    // forceState: \"SUMMARY END\"\r\n    else if (forceState === \"SUMMARY END\"){\r\n      console.log(`forceState: \\\"SUMMARY END\\\"`);\r\n      SetStateMachineState(\"SUMMARY END\");\r\n      SetInfoMessage(\"Finished summary highlighting. When ready, press \\\"SUBMIT\\\".\");\r\n    }\r\n\r\n    // forceState: \"ANNOTATION\"\r\n    else if (forceState === \"ANNOTATION\"){\r\n      console.log(`forceState: \\\"ANNOTATION\\\"`);\r\n      SetStateMachineState(\"ANNOTATION\");\r\n      SetInfoMessage(\"Highlight document and summary alignment and then press \\\"CONFIRM\\\".\");\r\n    }\r\n\r\n    // forceState: \"REVISE HOVER\"\r\n    else if (forceState === \"REVISE HOVER\"){\r\n      StartReviseStateHandler(isBackBtn);\r\n      console.log(`forceState: \\\"REVISE HOVER\\\"`);\r\n      SetStateMachineState(\"REVISE HOVER\");\r\n      SetInfoMessage(\"Choose alignment to revise.\");\r\n    }\r\n\r\n    // forceState: \"FINISH REVISION\" --> namely go back to state before revision with all-highlighted updated\r\n    else if (forceState === \"FINISH REVISION\"){\r\n      const prev_state = ExitReviseHandler();\r\n      if ([\"ANNOTATION\", \"SENTENCE START\".includes(prev_state)]) {\r\n        SetInfoMessage(\"Highlight document and summary alignment and then press \\\"CONFIRM\\\".\");\r\n      } else if (prev_state === \"SENTENCE END\"){\r\n        SetInfoMessage(\"Finished sentence highlighting. When ready, press \\\"NEXT SENTENCE\\\".\");\r\n      } else if (prev_state === \"SUMMARY END\") {\r\n        SetInfoMessage(\"Finished summary highlighting. When ready, press \\\"SUBMIT\\\".\");\r\n      } else{\r\n        alert(`Coming back from Revision to an unsupported state... state is ${prev_state}`);\r\n      }\r\n    }\r\n\r\n    // \"START\" state --> \"ANNOTATION\" state\r\n    else if (StateMachineState === \"START\"){\r\n        console.log(`Old state: \\\"START\\\"; New state: \\\"ANNOTATION\\\" with SentInd=${CurrSentInd+1}.`);\r\n        SetStateMachineState(\"ANNOTATION\");\r\n        SetSummaryShadow(CurrSentInd+1);\r\n        SetCurrSentInd(CurrSentInd+1);\r\n        SetInfoMessage(\"Highlight document and summary alignment and then press \\\"CONFIRM\\\".\");\r\n    }\r\n    \r\n    // \"ANNOTATION\" state --> \"ANNOTATION\" with next alignment\r\n    else if (StateMachineState === \"ANNOTATION\"){\r\n      console.log(`curr AlignmentCount is ${AlignmentCount}`);\r\n      console.log(`Old state: \\\"ANNOTATION\\\"; New state: \\\"ANNOTATION\\\" with AlignmentCount=${AlignmentCount}.`);\r\n      approveHighlightHandler();\r\n      SetAlignmentCount(AlignmentCount+1);\r\n      SetInfoMessage(\"Highlight document and summary alignment and then press \\\"CONFIRM\\\".\");\r\n    }\r\n\r\n    // \"SENTENCE END\" state --> \"SENTENCE START\" \r\n    else if (StateMachineState === \"SENTENCE END\"){\r\n      // adding last sentence alignment\r\n      console.log(`curr AlignmentCount is ${AlignmentCount}`);\r\n      approveHighlightHandler();\r\n      SetAlignmentCount(AlignmentCount+1);\r\n\r\n      // moving to next sentence\r\n      // update of summary sentence shadow is done in App.js in a designated useEffect\r\n      console.log(`Old state: \\\"SENTENCE END\\\"; New state: \\\"SENTENCE START\\\" with SentInd=${CurrSentInd+1}.`);\r\n      SetStateMachineState(\"SENTENCE START\");\r\n      SetCurrSentInd(CurrSentInd+1);\r\n      SetInfoMessage(\"Highlight document and summary alignment and then press \\\"CONFIRM\\\".\");\r\n    }\r\n      // \"SENTENCE START\" state --> \"ANNOTATION\" with next alignment \r\n      else if (StateMachineState === \"SENTENCE START\"){\r\n        console.log(`curr AlignmentCount is ${AlignmentCount}`);\r\n        console.log(`Old state: \\\"SENTENCE START\\\"; New state: \\\"ANNOTATION\\\" with AlignmentCount=${AlignmentCount}.`);\r\n        SetStateMachineState(\"ANNOTATION\");\r\n        approveHighlightHandler();\r\n        SetAlignmentCount(AlignmentCount+1);\r\n        SetInfoMessage(\"Highlight document and summary alignment and then press \\\"CONFIRM\\\".\");\r\n  \r\n      }\r\n      // \"SUMMARY END\" state --> \"SUBMIT\" state \r\n      else if (StateMachineState === \"SUMMARY END\"){\r\n        console.log(`Old state: \\\"SUMMARY END\\\"; New state: \\\"SUBMIT\\\"`);\r\n        SetStateMachineState(\"SUBMIT\");\r\n        SetInfoMessage(\"\");\r\n      }\r\n\r\n      // \"REVISE HOVER\" state --> \"REVISE CLICKED\" state \r\n      else if (StateMachineState === \"REVISE HOVER\"){\r\n        console.log(`Old state: \\\"REVISE HOVER\\\"; New state: \\\"REVISE CLICKED\\\"`);\r\n        console.log(`clickedWordInfo:${JSON.stringify(clickedWordInfo)}`)\r\n        ReviseChooseAlignHandler(clickedWordInfo);\r\n        SetStateMachineState(\"REVISE CLICKED\");\r\n        SetInfoMessage(\"\");\r\n      }\r\n\r\n      // \"REVISE CLICKED\" state --> \"REVISE HOVER\" state \r\n      else if (StateMachineState === \"REVISE CLICKED\"){\r\n        console.log(`curr AlignmentCount is ${AlignmentCount}`);\r\n        console.log(`Old state: \\\"REVISE CLICKED\\\"; New state: \\\"REVISE HOVER\\\"`);\r\n        SetStateMachineState(\"REVISE HOVER\");\r\n        SetCurrSentInd(-1)\r\n        approveHighlightHandler();\r\n        SetAlignmentCount(AlignmentCount+1);\r\n        SetInfoMessage(\"Choose alignment to revise.\");\r\n        setPrevSummaryJsonRevise([]);\r\n        setPrevDocJsonRevise([]);\r\n      }\r\n  }\r\n\r\n  MachineStateHandler.defaultProps = {\r\n    forceState: '',\r\n    isBackBtn: false\r\n  }\r\n\r\n\r\n\r\n  /************************************************************************************************************************************/\r\n\r\n\r\n  const g_MachineStateHandler = (summary_json,\r\n    StateMachineState, SetStateMachineState,\r\n    SetInfoMessage, handleErrorOpen, isPunct,\r\n    CurrSentInd, SetCurrSentInd, SetSummaryShadow,\r\n    AlignmentCount, SetAlignmentCount,\r\n    approveHighlightHandler,\r\n    clickedWordInfo, forceState, \r\n    StartReviseStateHandler, ExitReviseHandler,\r\n    ReviseChooseAlignHandler,\r\n    isBackBtn,\r\n    setPrevSummaryJsonRevise, setPrevDocJsonRevise) => {\r\n\r\n\r\n\r\n// forceState: \"SENTENCE END\"\r\nif (forceState === \"SENTENCE END\"){\r\nconsole.log(`forceState: \\\"SENTENCE END\\\"`);\r\nSetStateMachineState(\"SENTENCE END\");\r\nSetInfoMessage(\"Finished sentence highlighting. When ready, press \\\"NEXT SENTENCE\\\".\");\r\n}\r\n\r\n// forceState: \"SUMMARY END\"\r\nelse if (forceState === \"SUMMARY END\"){\r\nconsole.log(`forceState: \\\"SUMMARY END\\\"`);\r\nSetStateMachineState(\"SUMMARY END\");\r\nSetInfoMessage(\"Finished summary highlighting. When ready, press \\\"SUBMIT\\\".\");\r\n}\r\n\r\n// forceState: \"ANNOTATION\"\r\nelse if (forceState === \"ANNOTATION\"){\r\nconsole.log(`forceState: \\\"ANNOTATION\\\"`);\r\nSetStateMachineState(\"ANNOTATION\");\r\nSetInfoMessage(\"Highlight document and summary alignment and then press \\\"CONFIRM\\\".\");\r\n}\r\n\r\n// forceState: \"REVISE HOVER\"\r\nelse if (forceState === \"REVISE HOVER\"){\r\nStartReviseStateHandler(isBackBtn);\r\nconsole.log(`forceState: \\\"REVISE HOVER\\\"`);\r\nSetStateMachineState(\"REVISE HOVER\");\r\nSetInfoMessage(\"Choose alignment to revise.\");\r\n}\r\n\r\n// forceState: \"FINISH REVISION\" --> namely go back to state before revision with all-highlighted updated\r\nelse if (forceState === \"FINISH REVISION\"){\r\nconst prev_state = ExitReviseHandler();\r\nif ([\"ANNOTATION\", \"SENTENCE START\".includes(prev_state)]) {\r\nSetInfoMessage(\"Highlight document and summary alignment and then press \\\"CONFIRM\\\".\");\r\n} else if (prev_state === \"SENTENCE END\"){\r\nSetInfoMessage(\"Finished sentence highlighting. When ready, press \\\"NEXT SENTENCE\\\".\");\r\n} else if (prev_state === \"SUMMARY END\") {\r\nSetInfoMessage(\"Finished summary highlighting. When ready, press \\\"SUBMIT\\\".\");\r\n} else{\r\nalert(`Coming back from Revision to an unsupported state... state is ${prev_state}`);\r\n}\r\n}\r\n\r\n// \"START\" state --> \"ANNOTATION\" state\r\nelse if (StateMachineState === \"START\"){\r\nconsole.log(`Old state: \\\"START\\\"; New state: \\\"ANNOTATION\\\" with SentInd=${CurrSentInd+1}.`);\r\nSetStateMachineState(\"ANNOTATION\");\r\nSetSummaryShadow(CurrSentInd+1);\r\nSetCurrSentInd(CurrSentInd+1);\r\nSetInfoMessage(\"Highlight document and summary alignment and then press \\\"CONFIRM\\\".\");\r\n\r\n// g_setStateMachineStateIndex(1.0)\r\n}\r\n\r\n// \"ANNOTATION\" state --> \"ANNOTATION\" with next alignment\r\nelse if (StateMachineState === \"ANNOTATION\"){\r\nconsole.log(`curr AlignmentCount is ${AlignmentCount}`);\r\nconsole.log(`Old state: \\\"ANNOTATION\\\"; New state: \\\"ANNOTATION\\\" with AlignmentCount=${AlignmentCount}.`);\r\napproveHighlightHandler();\r\nSetAlignmentCount(AlignmentCount+1);\r\nSetInfoMessage(\"Highlight document and summary alignment and then press \\\"CONFIRM\\\".\");\r\n}\r\n\r\n// \"SENTENCE END\" state --> \"SENTENCE START\" \r\nelse if (StateMachineState === \"SENTENCE END\"){\r\n// adding last sentence alignment\r\nconsole.log(`curr AlignmentCount is ${AlignmentCount}`);\r\napproveHighlightHandler();\r\nSetAlignmentCount(AlignmentCount+1);\r\n\r\n// moving to next sentence\r\n// update of summary sentence shadow is done in App.js in a designated useEffect\r\nconsole.log(`Old state: \\\"SENTENCE END\\\"; New state: \\\"SENTENCE START\\\" with SentInd=${CurrSentInd+1}.`);\r\nSetStateMachineState(\"SENTENCE START\");\r\nSetCurrSentInd(CurrSentInd+1);\r\nSetInfoMessage(\"Highlight document and summary alignment and then press \\\"CONFIRM\\\".\");\r\n}\r\n// \"SENTENCE START\" state --> \"ANNOTATION\" with next alignment \r\nelse if (StateMachineState === \"SENTENCE START\"){\r\nconsole.log(`curr AlignmentCount is ${AlignmentCount}`);\r\nconsole.log(`Old state: \\\"SENTENCE START\\\"; New state: \\\"ANNOTATION\\\" with AlignmentCount=${AlignmentCount}.`);\r\nSetStateMachineState(\"ANNOTATION\");\r\napproveHighlightHandler();\r\nSetAlignmentCount(AlignmentCount+1);\r\nSetInfoMessage(\"Highlight document and summary alignment and then press \\\"CONFIRM\\\".\");\r\n\r\n}\r\n// \"SUMMARY END\" state --> \"SUBMIT\" state \r\nelse if (StateMachineState === \"SUMMARY END\"){\r\nconsole.log(`Old state: \\\"SUMMARY END\\\"; New state: \\\"SUBMIT\\\"`);\r\nSetStateMachineState(\"SUBMIT\");\r\nSetInfoMessage(\"\");\r\n}\r\n\r\n// \"REVISE HOVER\" state --> \"REVISE CLICKED\" state \r\nelse if (StateMachineState === \"REVISE HOVER\"){\r\nconsole.log(`Old state: \\\"REVISE HOVER\\\"; New state: \\\"REVISE CLICKED\\\"`);\r\nReviseChooseAlignHandler(clickedWordInfo);\r\nSetStateMachineState(\"REVISE CLICKED\");\r\nSetInfoMessage(\"\");\r\n}\r\n\r\n// \"REVISE CLICKED\" state --> \"REVISE HOVER\" state \r\nelse if (StateMachineState === \"REVISE CLICKED\"){\r\nconsole.log(`curr AlignmentCount is ${AlignmentCount}`);\r\nconsole.log(`Old state: \\\"REVISE CLICKED\\\"; New state: \\\"REVISE HOVER\\\"`);\r\nSetStateMachineState(\"REVISE HOVER\");\r\napproveHighlightHandler();\r\nSetAlignmentCount(AlignmentCount+1);\r\nSetInfoMessage(\"Choose alignment to revise.\");\r\nsetPrevSummaryJsonRevise([]);\r\nsetPrevDocJsonRevise([]);\r\n}\r\n}\r\n\r\ng_MachineStateHandler.defaultProps = {\r\nforceState: '',\r\nisBackBtn: false\r\n}\r\n\r\n\r\n  export { MachineStateHandler, g_MachineStateHandler }\r\n","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\DocWord.js",["253"],[],"import Typography from '@mui/material/Typography';\r\n\r\nconst DocWord = ({ word_json, doc_paragraph_breaks, StateMachineState, DocMouseClickHandlerWrapper, hoverHandlerWrapper, DocOnMouseDownHandler, DocOnMouseUpHandler, setDocOnMouseDownActivated, docOnMouseDownActivated, setHoverActivatedId, ctrlButtonDown, setHoverActivatedDocOrSummary }) => {\r\n    // const XOR = (a,b) => {\r\n    //   return ( ( a && !b ) || ( !a && b ) )\r\n    // }\r\n\r\n    // const is_span_highlighted = () => {\r\n    //   if (ctrlButtonDown) {\r\n    //     return word_json.span_highlighted && !word_json.span_alignment_hover\r\n    //   } \r\n    //   else {\r\n    //     return word_json.span_highlighted\r\n    //   }\r\n    // }\r\n\r\n    const show_word = () => {\r\n      if (word_json.word !== \"\\n\"){\r\n        return word_json.word\r\n      } else {\r\n        return \"\"\r\n      }\r\n    }\r\n  \r\n    // the \"&nbsp;\" is to add space after word\r\n    return (\r\n      <div>\r\n        {/* {(word_json.word !== \"\\n\") && (\r\n          <div\r\n            className={`docWord noselect\r\n                        ${(word_json.span_highlighted && !word_json.span_alignment_hover) ?  'span-highlighted-word': ''} \r\n                        ${(word_json.span_alignment_hover && !ctrlButtonDown) ?  'span-aligned-hover-word': ''} \r\n                        ${(word_json.old_alignments && !word_json.span_highlighted) ? 'old-aligned-word': ''}\r\n                        ${word_json.boldfaced ? 'boldfaced-word': 'normal-sized-word'}\r\n                        ${(word_json.old_alignment_hover && StateMachineState===\"REVISE HOVER\") ? 'old-aligned-hover-word': ''}\r\n                        ${(StateMachineState !== \"REVISE HOVER\") ? 'cursor-span' : ''}\r\n                        ${(word_json.old_alignments && StateMachineState===\"REVISE HOVER\") ? 'cursor-pointer': ''}\r\n                        ${(word_json.red_color) ? 'red-color-word': 'text-muted'}\r\n                        `}\r\n            \r\n            style={{fontFamily: \"IBM Plex Sans\", lineHeight: \"0\"}}\r\n            onClick={() => DocMouseClickHandlerWrapper(word_json.tkn_id)}\r\n            onMouseEnter={() => {setHoverActivatedId(word_json.tkn_id); setHoverActivatedDocOrSummary(\"doc\"); hoverHandlerWrapper({inOrOut:\"in\", curr_alignment_id:word_json.alignment_id[0], isSummary:false})}}\r\n            onMouseLeave={() => hoverHandlerWrapper({inOrOut:\"out\", curr_alignment_id:word_json.alignment_id[0], tkn_id:word_json.tkn_id, isSummary:false})}\r\n            onMouseDown={() => DocOnMouseDownHandler(word_json.tkn_id)}\r\n            onMouseUp={() => DocOnMouseUpHandler()}\r\n          >\r\n              <nobr>\r\n                {word_json.word}\r\n              </nobr>&nbsp;\r\n          </div>\r\n        )}\r\n\r\n        {(word_json.word === \"\\n\") && (\r\n          <span className=\"br-class\"></span>\r\n        )} */}\r\n\r\n          <div\r\n            className={`docWord noselect\r\n                        ${(word_json.span_highlighted && !word_json.span_alignment_hover) ?  'span-highlighted-word': ''} \r\n                        ${(word_json.span_alignment_hover && !ctrlButtonDown) ?  'span-aligned-hover-word': ''} \r\n                        ${(word_json.old_alignments && !word_json.span_highlighted) ? 'old-aligned-word': ''}\r\n                        ${(word_json.red_color && !docOnMouseDownActivated) ? 'red-color-word': ''}\r\n                        ${(word_json.boldfaced && !word_json.red_color) ? 'boldfaced-word': ''}\r\n                        ${(!word_json.boldfaced && !word_json.red_color) ? 'text-muted': ''}\r\n                        ${(word_json.old_alignment_hover && StateMachineState===\"REVISE HOVER\") ? 'old-aligned-hover-word': ''}\r\n                        ${(StateMachineState !== \"REVISE HOVER\") ? 'cursor-span-doc' : ''}\r\n                        ${(word_json.old_alignments && StateMachineState===\"REVISE HOVER\") ? 'cursor-pointer': ''}\r\n                        `}\r\n            \r\n            style={{fontFamily: \"IBM Plex Sans\", lineHeight: \"1\"}}\r\n            onClick={() => DocMouseClickHandlerWrapper(word_json.tkn_id)}\r\n            onMouseEnter={() => {setHoverActivatedId(word_json.tkn_id); setHoverActivatedDocOrSummary(\"doc\"); hoverHandlerWrapper({inOrOut:\"in\", curr_alignment_id:word_json.alignment_id[0], isSummary:false})}}\r\n            onMouseLeave={() => {hoverHandlerWrapper({inOrOut:\"out\", curr_alignment_id:word_json.alignment_id[0], tkn_id:word_json.tkn_id, isSummary:false})}}\r\n            onMouseDown={() => DocOnMouseDownHandler(word_json.tkn_id)}\r\n            // onMouseUp={() => DocOnMouseUpHandler()}\r\n          >\r\n              <nobr>\r\n                {show_word()}\r\n              </nobr>&nbsp;\r\n          </div>\r\n\r\n          {(doc_paragraph_breaks.includes(word_json.tkn_id)) && (\r\n          <span className=\"br-class\"></span>\r\n        )}\r\n\r\n      </div>\r\n    )\r\n  }\r\n  \r\n  export default DocWord","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\ResponsiveAppBar.js",["254","255","256","257","258","259","260","261","262","263","264","265","266","267"],[],"import * as React from 'react';\r\nimport { useRef } from 'react'\r\nimport AppBar from '@mui/material/AppBar';\r\nimport Box from '@mui/material/Box';\r\nimport Toolbar from '@mui/material/Toolbar';\r\nimport Typography from '@mui/material/Typography';\r\n// import Container from '@mui/material/Container';\r\nimport Button from '@mui/material/Button';\r\nimport { Link } from 'react-router-dom'\r\nimport { ArrowForwardIosTwoTone } from '@mui/icons-material';\r\nimport Slider from '@mui/material/Slider';\r\nimport { withStyles } from \"@material-ui/core/styles\";\r\nimport { padding } from '@mui/system';\r\nimport { styled } from '@mui/material/styles';\r\nimport { StyledSliderHighlighting, StyledSliderBolding } from './styled-sliders'\r\nimport Overlay from 'react-bootstrap/Overlay'\r\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger'\r\nimport Tooltip from 'react-bootstrap/Tooltip'\r\n\r\nimport Navbar from 'react-bootstrap/Navbar';\r\nimport Nav from 'react-bootstrap/Nav';\r\nimport Container from 'react-bootstrap/Container'\r\nimport Row from 'react-bootstrap/Row'\r\nimport Col from 'react-bootstrap/Col'\r\n\r\nconst pages = {\"Tutorial\": \"tutorial\", 'Guided Annotation': 'guidedAnnotation',  'Annotation': ''}; \r\n\r\n\r\nconst ResponsiveAppBar = ({ title, StateMachineState, MachineStateHandlerWrapper, boldState, boldStateHandler, oldAlignmentState, oldAlignmentStateHandler, t_StateMachineStateId, g_showWhereNavbar }) => {\r\n  const whereNavBar = useRef(null);\r\n  const whereNavBarArr = {\"Tutorial\": undefined, 'Guided Annotation': whereNavBar,  'Annotation': undefined}; \r\n  \r\n  const BlackTextTypography = withStyles({\r\n    root: {\r\n      color: \"white\",\r\n      fontSize: \"15pt\",\r\n      fontWeight: \"14\"\r\n    }\r\n  })(Typography);\r\n\r\n\r\n\r\n  const BoldingSliderTags = (value) =>{\r\n    if (value===1) {\r\n      return \"None\";\r\n    } else if (value===2) {\r\n      return \"Span\";\r\n    } else {\r\n      return \"Sentence\";\r\n    }\r\n  }\r\n\r\n  const BoldingSliderDefaultValue = () =>{\r\n    if (boldState === \"none\") {\r\n      return 1;\r\n    } else if (boldState === \"span\") {\r\n      return 2;\r\n    } else {\r\n      return 3;\r\n    }\r\n  }\r\n\r\n  const OldHighlightingSliderTags = (value) =>{\r\n    if (value===1) {\r\n      return \"None\";\r\n    } else if (value===2) {\r\n      return \"Sentence\";\r\n    } else {\r\n      return \"All\";\r\n    }\r\n  }\r\n\r\n  const OldHighlightingSliderDefaultValue = () =>{\r\n    if (oldAlignmentState === \"none\") {\r\n      return 1;\r\n    } else if (oldAlignmentState === \"sent\") {\r\n      return 2;\r\n    } else {\r\n      return 3;\r\n    }\r\n  }\r\n\r\n  const margin_left = (curr_ttl) =>{\r\n    if (title===\"Guided Annotation\" && curr_ttl==\"Tutorial\") {\r\n      return \"6%\"\r\n    } else if (title===\"Annotation\" && curr_ttl===\"Tutorial\") {\r\n      return \"-2%\"\r\n    } else if (title===\"Tutorial\" && curr_ttl===\"Tutorial\") {\r\n      return \"-6%\"\r\n    } \r\n    \r\n    else if (title===\"Guided Annotation\" && curr_ttl==\"Guided Annotation\") {\r\n      return \"-2%\"\r\n    } else if (title===\"Annotation\" && curr_ttl===\"Guided Annotation\") {\r\n      return \"-5%\"\r\n    } else if (title===\"Tutorial\" && curr_ttl===\"Guided Annotation\") {\r\n      return \"-6%\"\r\n    }     \r\n    \r\n    else if (title===\"Guided Annotation\" && curr_ttl==\"Annotation\") {\r\n      return \"-4%\"\r\n    } else if (title===\"Annotation\" && curr_ttl===\"Annotation\") {\r\n      return \"-6%\"\r\n    } else if (title===\"Tutorial\" && curr_ttl===\"Annotation\") {\r\n      return \"-8%\"\r\n    } \r\n  }\r\n\r\n\r\n  const renderTooltip = (props) => (\r\n    <Tooltip id=\"button-tooltip\" {...props}>\r\n      Simple tooltip\r\n    </Tooltip>\r\n  );\r\n\r\n  return (\r\n\r\n    <>\r\n      <Navbar bg=\"secondary\" variant=\"dark\" className=\"w-100 p-2\">\r\n        <Container className='navbar-container'>\r\n          {/* <Row  className=\"navbar-row\"> */}\r\n            <Col md={{span:1, offset:0}}>\r\n                      <Navbar.Brand>{title}</Navbar.Brand>\r\n            </Col>\r\n            {/* <Col md={{span:12, offset:0}}>\r\n              <Nav className=\"me-auto\"> */}\r\n                  {Object.keys(pages).map((ttl, index) => {\r\n                      return (<Col style={{marginLeft:`${margin_left(ttl)}`}} md={(ttl===\"Guided Annotation\")? {span:2, offset:0}:{span:1, offset:0}}>\r\n                        <Nav className=\"me-auto\" ref={whereNavBarArr[ttl]}>\r\n                          <Nav.Item as=\"li\">\r\n                            <Nav.Link\r\n                              key={ttl}\r\n                              as={Link} to={`/${pages[ttl]}`}\r\n                            >\r\n                              {ttl}\r\n                              </Nav.Link>\r\n                          </Nav.Item>\r\n                          </Nav>\r\n                      </Col>)\r\n                  }\r\n                  )}\r\n              {/* </Nav>\r\n            </Col> */}\r\n          {/* </Row> */}\r\n\r\n            { title !== \"Instructions\" && (\r\n                  <Col md={{span:2, offset:2}}>\r\n                    <BlackTextTypography  id=\"old-highlighting-slider-title\">\r\n                        OLD ALIGNMENTS\r\n                    </BlackTextTypography>\r\n                    <StyledSliderHighlighting\r\n                      className={`${(t_StateMachineStateId === 10) ? 'with-glow':''}`} \r\n                      aria-label=\"Old-Highlighting-option\"\r\n                      defaultValue={3}\r\n                      getAriaValueText={OldHighlightingSliderTags}\r\n                      valueLabelFormat={OldHighlightingSliderTags}\r\n                      valueLabelDisplay=\"auto\"\r\n                      value={OldHighlightingSliderDefaultValue()}\r\n                      sx={{ color: 'primary.dark' }}\r\n                      step={1}\r\n                      marks\r\n                      min={1}\r\n                      max={3}\r\n                      onChangeCommitted={(event, newValue) => oldAlignmentStateHandler({event:event, newValue:newValue, sent_ind:-1})}\r\n                    />\r\n                  </Col>\r\n            )}\r\n\r\n\r\n            { title !== \"Instructions\" && (\r\n                <Col style={{marginLeft:\"3%\"}} md={{span:2, offset:0}}>\r\n                  <BlackTextTypography  id=\"bolding-slider-title\">\r\n                    BOLDING\r\n                  </BlackTextTypography>\r\n                  <StyledSliderBolding\r\n                    className={`${(t_StateMachineStateId === 8) ? 'with-glow':''}`}\r\n                    aria-label=\"Bolding-option\"\r\n                    defaultValue={3}\r\n                    getAriaValueText={BoldingSliderTags}\r\n                    valueLabelFormat={BoldingSliderTags}\r\n                    valueLabelDisplay=\"auto\"\r\n                    value={BoldingSliderDefaultValue()}\r\n                    color=\"error\"\r\n                    step={1}\r\n                    marks\r\n                    min={1}\r\n                    max={3}\r\n                    onChangeCommitted={boldStateHandler}\r\n                  />\r\n                </Col>\r\n              )}\r\n        </Container>\r\n      </Navbar>\r\n\r\n\r\n\r\n\r\n      <Overlay target={whereNavBar.current} show={g_showWhereNavbar} placement=\"bottom\">\r\n        {(props) => (\r\n          <Tooltip {...props} id=\"overlay-where-navbar\">\r\n              I'm right here!\r\n          </Tooltip>\r\n        )}\r\n      </Overlay>\r\n    </>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // <AppBar position=\"static\" color=\"primary\" width=\"100%\">\r\n    //   <Container maxWidth=\"xl\">\r\n    //     <Toolbar disableGutters>\r\n    //       <Typography\r\n    //         variant=\"h6\"\r\n    //         noWrap\r\n    //         component=\"div\"\r\n    //         sx={{ mr: 2, display: { xs: 'none', md: 'flex' } }}\r\n    //       >\r\n    //         {title}\r\n    //       </Typography>\r\n\r\n    //       <Typography\r\n    //         variant=\"h6\"\r\n    //         noWrap\r\n    //         component=\"div\"\r\n    //         sx={{ flexGrow: 1, display: {xs: 'flex', md: 'none' } }}\r\n    //       >\r\n    //         {title}\r\n    //       </Typography>\r\n    //       <Box sx={{ flexGrow: 1, display: { xs: 'none', md: 'flex' } }}>\r\n    //         {Object.keys(pages).filter(key => key !== title).map((ttl) => (\r\n    //           <Button\r\n    //             key={ttl}\r\n    //             component={Link} to={`/${pages[ttl]}`}\r\n    //             sx={{ my: 2, color: 'white', display: 'block' }}\r\n    //           >\r\n    //             {ttl}\r\n    //           </Button>\r\n    //         ))}\r\n    //       </Box>\r\n          \r\n    //       {[\"SUMMARY END\", \"SENTENCE END\", \"ANNOTATION\", \"SENTENCE START\"].includes(StateMachineState) && (\r\n    //         <Box sx={{ margin:'0 30px' }}>\r\n    //           <Button color=\"warning\" variant=\"contained\" onClick={() => MachineStateHandlerWrapper({forceState:\"REVISE HOVER\"})}>Revise</Button>\r\n    //         </Box>\r\n    //       )}\r\n\r\n    //       {StateMachineState === \"REVISE HOVER\" && (\r\n    //         <Box sx={{ margin:'0 30px' }}>\r\n    //           <Button color=\"success\" variant=\"contained\" onClick={() => MachineStateHandlerWrapper({forceState:\"FINISH REVISION\"})}>Finish Revision</Button>\r\n    //         </Box>\r\n    //       )}\r\n\r\n\r\n\r\n    //       { title !== \"Instructions\" && (\r\n    //         <Box sx={{ width: 190, alignItems: 'center', padding: '0 40px 0 0' }}>\r\n    //           <BlackTextTypography  id=\"old-highlighting-slider-title\" color=\"secondary\">\r\n    //               OLD ALIGNMENTS\r\n    //           </BlackTextTypography>\r\n    //           <StyledSliderHighlighting \r\n    //             aria-label=\"Old-Highlighting-option\"\r\n    //             defaultValue={3}\r\n    //             getAriaValueText={OldHighlightingSliderTags}\r\n    //             valueLabelFormat={OldHighlightingSliderTags}\r\n    //             valueLabelDisplay=\"auto\"\r\n    //             value={OldHighlightingSliderDefaultValue()}\r\n    //             color=\"info\"\r\n    //             step={1}\r\n    //             marks\r\n    //             min={1}\r\n    //             max={3}\r\n    //             onChangeCommitted={(event, newValue) => oldAlignmentStateHandler({event:event, newValue:newValue, sent_ind:-1})}\r\n    //           />\r\n    //         </Box>\r\n    //       )}\r\n\r\n    //       { title !== \"Instructions\" && (\r\n    //         <Box sx={{ width: 190, alignItems: 'center' }}>\r\n    //           <BlackTextTypography  id=\"bolding-slider-title\" color=\"secondary\">\r\n    //             BOLDING\r\n    //           </BlackTextTypography>\r\n    //           <StyledSliderBolding\r\n    //             aria-label=\"Bolding-option\"\r\n    //             defaultValue={3}\r\n    //             getAriaValueText={BoldingSliderTags}\r\n    //             valueLabelFormat={BoldingSliderTags}\r\n    //             valueLabelDisplay=\"auto\"\r\n    //             value={BoldingSliderDefaultValue()}\r\n    //             color=\"error\"\r\n    //             step={1}\r\n    //             marks\r\n    //             min={1}\r\n    //             max={3}\r\n    //             onChangeCommitted={boldStateHandler}\r\n    //           />\r\n    //         </Box>\r\n    //       )}\r\n    //     </Toolbar>\r\n    //   </Container>\r\n    // </AppBar>\r\n  );\r\n};\r\nexport default ResponsiveAppBar;\r\n","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\BackButton.js",["268"],[],"import { Link } from 'react-router-dom'\r\nimport Button from '@material-ui/core/Button';\r\nimport ArrowBackIosNewIcon from '@mui/icons-material/ArrowBackIosNew';\r\nimport ResponsiveAppBar from './ResponsiveAppBar'\r\n\r\nconst BackButton = ({ back_path }) => {\r\n    return (\r\n        <Button component={Link} to={back_path} startIcon={<ArrowBackIosNewIcon />}>\r\n              back\r\n        </Button>\r\n\r\n    )\r\n  }\r\n  \r\n  export default BackButton","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\SummaryWord.js",[],[],"C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\styled-sliders.js",[],[],"C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\GuidedAnnotation_utils.js",["269","270","271","272","273","274","275","276","277","278","279","280","281"],[],"import Alert from 'react-bootstrap/Alert'\r\nimport Modal from 'react-bootstrap/Modal'\r\nimport Toast from 'react-bootstrap/Toast'\r\nimport ToastHeader from 'react-bootstrap/ToastHeader'\r\nimport ToastBody from 'react-bootstrap/ToastBody'\r\nimport ToastContainer from 'react-bootstrap/ToastContainer'\r\nimport Carousel from 'react-bootstrap/Carousel'\r\n\r\n\r\nconst add_text_to_GuidedAnnotationInfoAlert = (g_is_good_alignment,StateMachineState, doc_json) => {\r\n    const NoAlign = (doc_json.filter((word) => {return word.span_highlighted}).length===0) ? \"(NO ALIGN)\":\"\"\r\n    if(g_is_good_alignment) {\r\n      if(StateMachineState===\"ANNOTATION\"){return `<br/><b>Hit \\\"CONFIRM ${NoAlign}\\\" to proceed.</b>`}\r\n      if(StateMachineState===\"SENTENCE END\"){return `<br/><b>Hit \\\"NEXT SENTENCE ${NoAlign}\\\" to proceed.</b>`}\r\n      if(StateMachineState===\"SUMMARY END\"){return `<br/><b>Hit \\\"SUBMIT ${NoAlign}\\\" to finish.</b>`}\r\n    } \r\n    // else {\r\n    //   if(StateMachineState===\"SENTENCE END\"){return \"<br/>When you are finished, <b>hit \\\"NEXT SENTENCE ${NoAlign}\\\"</b> to confirm and proceed to the next sentence.\"}\r\n    //   if(StateMachineState===\"SUMMARY END\"){return \"<br/>When you are finished, <b>hit \\\"SUBMIT ${NoAlign}\\\"</b> to confirm and finish.\"}\r\n    // }\r\n    return \"\"\r\n  }\r\n\r\n\r\n  const string_to_span = (span_str) => {\r\n    const sub_strings = span_str.split(\";\");\r\n    const lims = sub_strings.map((sub_string) => sub_string.split(\"-\").map((lim) => parseInt(lim)))\r\n    // console.log(`lims:${JSON.stringify(span_str)}`)\r\n    const ids = lims.map(([start, end]) => Array(end - start + 1).fill().map((_, idx) => start + idx)).flat(1)\r\n    return ids.sort(function(a, b) {return a - b;})\r\n  }\r\n\r\n\r\n\r\n\r\n  const get_span_groups = (g_answer_words_to_glow, words_json, isSummary) => {\r\n    const str_spans = g_answer_words_to_glow[\"ids\"].split(\";\")\r\n    let non_glow_min_lim = (isSummary) ? g_answer_words_to_glow[\"start_tkn\"].toString() : \"0\";\r\n    let span_groups = []\r\n    for (let i = 0; i < str_spans.length; i++) {\r\n      const lims = str_spans[i].split(\"-\")\r\n      let non_glow_max_lim = parseInt(lims[0]) - 1;\r\n      non_glow_max_lim = non_glow_max_lim.toString()\r\n      // start with an empty array because the glowing words are the odd spans (1,3,5,7... rather than 0,2,4...)\r\n      if (lims[0]===non_glow_min_lim){\r\n        span_groups=span_groups.concat([[]])\r\n      } else {\r\n        span_groups=span_groups.concat([string_to_span(`${non_glow_min_lim}-${non_glow_max_lim}`)])\r\n      }\r\n      span_groups=span_groups.concat([string_to_span(str_spans[i])])\r\n      non_glow_min_lim = parseInt(lims[1]) + 1\r\n      non_glow_min_lim = non_glow_min_lim.toString()\r\n    }\r\n    // final span\r\n    let non_glow_max_lim = (isSummary) ?  words_json.length + g_answer_words_to_glow[\"start_tkn\"] : words_json.length\r\n    non_glow_max_lim = non_glow_max_lim.toString()\r\n    console.log(`span_groups:${JSON.stringify(span_groups)}`)\r\n    console.log(`non_glow_min_lim:${non_glow_min_lim} and non_glow_max_lim:${non_glow_max_lim}`)\r\n    span_groups=span_groups.concat([string_to_span(`${non_glow_min_lim}-${non_glow_max_lim}`)])\r\n    console.log(\"span_groups:\")\r\n    console.log(span_groups)\r\n\r\n    const doc_words_groups = span_groups.map((tkns) => {return words_json.filter((word) => {return tkns.includes(word.tkn_id)})})\r\n    return doc_words_groups\r\n  }\r\n\r\n  export { add_text_to_GuidedAnnotationInfoAlert, string_to_span, get_span_groups }\r\n\r\n\r\n","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\Tutorial.js",["282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314"],[],"import { useState, useEffect, useRef } from 'react'\r\nimport { BrowserRouter as Router, Route, Routes } from 'react-router-dom'\r\nimport Snackbar from '@mui/material/Snackbar';\r\nimport MuiAlert from '@mui/material/Alert';\r\nimport * as React from 'react';\r\nimport Card from 'react-bootstrap/Card';\r\nimport Button from 'react-bootstrap/Button';\r\nimport DropdownButton from 'react-bootstrap/DropdownButton'\r\nimport Dropdown from 'react-bootstrap/Dropdown'\r\nimport Row from 'react-bootstrap/Row'\r\nimport Col from 'react-bootstrap/Col'\r\nimport Annotation from './Annotation';\r\nimport { Player, BigPlayButton } from 'video-react';\r\nimport \"../../node_modules/video-react/dist/video-react.css\"; // import css\r\n\r\nimport { MachineStateHandler,  } from './Annotation_event_handlers';\r\nimport { TutorialCard } from './TutorialCard';\r\nimport { t_StateMachineStateIdHandler, getTutorialCardTitle, getTutorialCardText } from './Tutorial_utils'\r\nimport _ from 'underscore';\r\n\r\n\r\nconst Tutorial = ({doc_json, setDocJson,\r\n                  t_start_doc_json, t_middle_doc_json, t_sent_end_doc_json, t_submit_doc_json, \r\n                  summary_json, setSummaryJson,\r\n                  t_start_summary_json, t_middle_summary_json, t_sent_end_summary_json, t_submit_summary_json,\r\n                  all_lemma_match_mtx, setAllLemmaMtx,\r\n                  important_lemma_match_mtx, setImportantLemmaMtx,\r\n                  doc_paragraph_breaks, setDocParagraphBreaks,\r\n                  t_state_messages}) => {\r\n\r\n                    \r\n  const [boldState, setBoldState] = useState(\"sent\"); // for user to choose if want full sentence, span or no lemma matching (denoted as \"sent\", \"span\" and \"none\", accordingly)\r\n  const [oldAlignmentState, setOldAlignmentState] = useState(\"all\"); // for user to choose if want full highlighting history, only current sentence's highlighting history or no history (denoted as \"all\", \"sent\" and \"none\", accordingly)\r\n  const [StateMachineState, SetStateMachineState] = useState(\"ANNOTATION\");\r\n  const [error_message, setErrorMessage] = React.useState(\"\");\r\n  const [CurrSentInd, SetCurrSentInd] = useState(-1);\r\n  const [InfoMessage, SetInfoMessage] = useState(\"\");\r\n  const [AlignmentCount, SetAlignmentCount] = useState(3)\r\n\r\n  const [prevStateMachineState, setPrevStateMachineState] = useState(\"\")\r\n  \r\n  const [prevSummarySpanHighlights, setPrevSummarySpanHighlights] = useState([]) // relevant for restoring span alignments before going to \"revise\" mode\r\n  const [prevDocSpanHighlights, setPrevDocSpanHighlights] = useState([]) // relevant for restoring span alignments before going to \"revise\" mode\r\n  const [prevSummaryJsonRevise, setPrevSummaryJsonRevise] = useState([]) // relevant for restoring All alignments before choosing an alignment in revise mode so can be restored if pressing the back button\r\n  const [prevDocJsonRevise, setPrevDocJsonRevise] = useState([]) // relevant for restoring All alignments before choosing an alignment in revise mode so can be restored if pressing the back button\r\n  const [prevCurrSentInd, setPrevCurrSentInd] = useState(-1) // relevant for restoring previous current sentence\r\n\r\n\r\n  const [DocOnMouseDownID, SetDocOnMouseDownID] = useState(\"-1\");\r\n  const [SummaryOnMouseDownID, SetSummaryOnMouseDownID] = useState(\"-1\");\r\n  const [docOnMouseDownActivated, setDocOnMouseDownActivated] = useState(false);\r\n  const [summaryOnMouseDownActivated, setSummaryOnMouseDownActivated] = useState(false);\r\n  const [hoverActivatedId, setHoverActivatedId] = useState(\"-1\"); // value will be of tkn_id of elem hovered over\r\n  const [hoverActivatedDocOrSummary, setHoverActivatedDocOrSummary] = useState(\"doc\"); // value will be of tkn_id of elem hovered over\r\n  const [sliderBoldStateActivated, setSliderBoldStateActivated] = useState(false);\r\n  const [noAlignModalShow, setNoAlignModalShow] = useState(false)\r\n  const [noAlignApproved, setNoAlignApproved] = useState(false)\r\n\r\n  const [t_StateMachineStateId, t_SetStateMachineStateId] = useState(0);\r\n\r\n  /*************************************** error handling *************************************************/\r\n  const Alert = React.forwardRef(function Alert(props, ref) {return <MuiAlert elevation={6} ref={ref} variant=\"filled\" {...props} />;});\r\n  \r\n\r\n\r\n  const handleErrorOpen = ({ msg }) => { \r\n    setErrorMessage(msg); \r\n  };\r\n\r\n  const handleErrorClose = (event, reason) => {\r\n    if (reason === 'clickaway') {\r\n      return;\r\n    }\r\n\r\n    setErrorMessage(\"\");\r\n  };\r\n\r\n\r\n/************************************************************************************************************* */\r\n\r\n  const isPunct = (tkn_txt) => {\r\n    const regex = /[!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~]/g;\r\n    const result = tkn_txt.replace(regex, '').replace(/(\\r\\n|\\n|\\r)/gm, \"\");\r\n    return (result === '');\r\n  }\r\n\r\n  const toggleDocSpanHighlight = ({tkn_ids, turn_on, turn_off}) => {\r\n    setSliderBoldStateActivated(false)\r\n    if (turn_on){\r\n      setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: true } : word))\r\n    } else if (turn_off){\r\n        setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: false,  span_alignment_hover:false } : word))\r\n    } else {\r\n        setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: !word.span_highlighted } : word))\r\n    }\r\n  }\r\n\r\n  toggleDocSpanHighlight.defaultProps = {\r\n    turn_on: false,\r\n    turn_off: false\r\n  }\r\n\r\n  const toggleSummarySpanHighlight = ({tkn_ids, turn_on, turn_off}) => {\r\n    console.log(\"inside toggleSummarySpanHighlight:\")\r\n    console.log(tkn_ids)\r\n    setSliderBoldStateActivated(false)\r\n    if (turn_on){\r\n      setSummaryJson(summary_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: true } : word));\r\n    } else if (turn_off){\r\n      setSummaryJson(summary_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: false,  span_alignment_hover:false } : word));\r\n    } else {\r\n      setSummaryJson(summary_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, span_highlighted: !word.span_highlighted } : word));\r\n    }\r\n  }\r\n\r\n  toggleSummarySpanHighlight.defaultProps = {\r\n    turn_on: false,\r\n    turn_off: false\r\n  }\r\n\r\n\r\n  const approveHighlightHandler = () => {\r\n    const doc_tkn_ids = doc_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id});\r\n    setDocJson(doc_json.map((word) => doc_tkn_ids.includes(word.tkn_id) ? { ...word, all_highlighted: true, alignment_id: [...word.alignment_id, AlignmentCount], span_highlighted: false } : word));\r\n\r\n\r\n    const summary_tkn_ids = summary_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id});\r\n    setSummaryJson(summary_json.map((word) => summary_tkn_ids.includes(word.tkn_id) ? { ...word, all_highlighted: true, alignment_id: [...word.alignment_id, AlignmentCount], span_highlighted: false } : word));    \r\n \r\n  }\r\n\r\n  const StartReviseStateHandler = (isBackBtn) => {\r\n    if (isBackBtn){\r\n      setDocJson(doc_json.map((word, ind) => {return {...word, all_highlighted: prevDocJsonRevise[ind].all_highlighted, span_highlighted: prevDocJsonRevise[ind].span_highlighted, alignment_id: prevDocJsonRevise[ind].alignment_id}}))\r\n      setSummaryJson(summary_json.map((word, ind) => {return {...word, all_highlighted: prevSummaryJsonRevise[ind].all_highlighted, span_highlighted: prevSummaryJsonRevise[ind].span_highlighted, alignment_id: prevSummaryJsonRevise[ind].alignment_id}}))\r\n    } else{\r\n      const current_sentence_id = CurrSentInd\r\n\r\n      setPrevStateMachineState(StateMachineState);\r\n      setPrevDocSpanHighlights(doc_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id}));\r\n      setPrevSummarySpanHighlights(summary_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id}));\r\n      setPrevCurrSentInd(current_sentence_id)\r\n\r\n      setDocJson(doc_json.map((word) => {return {...word, span_highlighted: false}}))\r\n      setSummaryJson(summary_json.map((word) => {return {...word, span_highlighted: false}}))\r\n    }\r\n    SetCurrSentInd(-1)\r\n  }\r\n\r\n  const ExitReviseHandler = () => {\r\n    setDocJson(doc_json.map((word, ind) => prevDocSpanHighlights.includes(word.tkn_id) ? {...word, span_highlighted: true}:{...word, span_highlighted: false}))\r\n    setSummaryJson(summary_json.map((word, ind) => prevSummarySpanHighlights.includes(word.tkn_id) ? {...word, span_highlighted: true}:{...word, span_highlighted: false}))               \r\n    const prev_state = prevStateMachineState;\r\n    SetStateMachineState(prevStateMachineState);\r\n\r\n    const prev_current_sent_id = prevCurrSentInd\r\n    SetCurrSentInd(prev_current_sent_id)\r\n    \r\n    setPrevCurrSentInd(-1)\r\n    setPrevStateMachineState(\"\");\r\n    setPrevSummarySpanHighlights([]);\r\n    setPrevDocSpanHighlights([]);\r\n    return prev_state\r\n  }\r\n\r\n  const RemoveAlignmentId = (word, chosen_align_id) => {\r\n    const new_alignment_id = word.alignment_id.filter((elem) => {return elem !== chosen_align_id});\r\n    return new_alignment_id;\r\n  }\r\n\r\n  const ReviseChooseAlignHandler = (clickedWordInfo) => {\r\n    setPrevSummaryJsonRevise(summary_json);\r\n    setPrevDocJsonRevise(doc_json);\r\n\r\n    const chosen_align_id = (clickedWordInfo[0] === 'doc') ? doc_json.filter((word) => {return word.tkn_id === clickedWordInfo[1]})[0].alignment_id[0] : \r\n                                                             summary_json.filter((word) => {return word.tkn_id === clickedWordInfo[1]})[0].alignment_id[0]\r\n\r\n    setSummaryJson(summary_json.map((word) => word.alignment_id.includes(chosen_align_id) ? {...word, span_highlighted: true, all_highlighted: false, old_alignments: false, old_alignment_hover:false, alignment_id: RemoveAlignmentId(word, chosen_align_id)} : {...word, span_highlighted: false}))\r\n    setDocJson(doc_json.map((word) => word.alignment_id.includes(chosen_align_id) ? {...word, span_highlighted: true, all_highlighted: false, old_alignments: false, old_alignment_hover:false, alignment_id: RemoveAlignmentId(word, chosen_align_id)} : {...word, span_highlighted: false}))\r\n    \r\n    const chosen_align_currSentId = summary_json.filter((word) => {return word.alignment_id.includes(chosen_align_id)})[0].sent_id\r\n    SetCurrSentInd(chosen_align_currSentId)\r\n  }\r\n\r\n\r\n  const SetSummaryShadow = (sent_id) => {\r\n    setSummaryJson(summary_json.map((word) => word.sent_id === sent_id ? { ...word, shadowed: true } : { ...word, shadowed: false }))\r\n  }\r\n\r\n\r\n  const SetSummaryShadowAndUpdateHighlights = (sent_id) => {\r\n    setSummaryJson(\r\n      summary_json.map((word) => word.sent_id === sent_id ? { ...word, shadowed: true } : { ...word, shadowed: false }).map(\r\n      (word) => word.span_highlighted ? {...word, span_highlighted: false, all_highlighted:true} : word)\r\n      )\r\n  }\r\n\r\n  const SetDocBoldface = (tkn_ids) => {\r\n    setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, boldfaced: true } : { ...word, boldfaced: false }))\r\n  }\r\n\r\n  const checkIfLemmasMatch = ({doc_id, summary_ids, isHover}) => {\r\n    const which_match_mtx = important_lemma_match_mtx;\r\n    const matching_summary_ids = summary_ids.filter((summary_id) => {return all_lemma_match_mtx[doc_id][summary_id] === 1;})\r\n    return matching_summary_ids.length > 0\r\n  }\r\n\r\n  const boldStateHandler = (event, newValue) => {\r\n    if (event !== undefined){\r\n      setSliderBoldStateActivated(true)\r\n    }\r\n    if (newValue=='1'){\r\n      setBoldState(\"none\");\r\n      SetDocBoldface([]);\r\n    } else if (newValue=='2'){\r\n      setBoldState(\"span\");\r\n      const summary_ids = summary_json.filter((word) => {return word.span_highlighted}).map((word) => {return word.tkn_id});\r\n      const isSpan = true;\r\n      const tkn_ids = doc_json.map((word) => {return word.tkn_id}).filter((doc_id) => {return checkIfLemmasMatch({doc_id:doc_id, summary_ids:summary_ids, isHover:false})});\r\n      SetDocBoldface(tkn_ids);\r\n    } else {\r\n      setBoldState(\"sent\");\r\n      const isSpan = false;\r\n      const summary_ids = summary_json.filter((word) => {return word.shadowed}).map((word) => {return word.tkn_id});\r\n      const tkn_ids = doc_json.map((word) => {return word.tkn_id}).filter((doc_id) => {return checkIfLemmasMatch({doc_id:doc_id, summary_ids:summary_ids, isHover:false})});\r\n      SetDocBoldface(tkn_ids);\r\n    }\r\n  }\r\n\r\n\r\n  const SetDocOldHighlights = (tkn_ids) => {\r\n    setDocJson(doc_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, old_alignments: true } : { ...word, old_alignments: false }))\r\n  }\r\n\r\n  const SetSummaryOldHighlights = (tkn_ids) => {\r\n    setSummaryJson(summary_json.map((word) => tkn_ids.includes(word.tkn_id) ? { ...word, old_alignments: true } : { ...word, old_alignments: false }))\r\n  }\r\n\r\n  const FindDocAlignmentPerSent = (sent_ind) => {\r\n    let curr_sent_alignment_ids = summary_json.map((word) => {return (word.sent_id===sent_ind) ? word.alignment_id : []});\r\n    curr_sent_alignment_ids = [].concat.apply([], curr_sent_alignment_ids); // merge into a single array (before was an array of arrays)\r\n    const doc_ids = doc_json.filter((word) => {return word.alignment_id.some(r=> curr_sent_alignment_ids.includes(r))}).map((word) => {return word.tkn_id});\r\n    return doc_ids\r\n  }\r\n\r\n\r\n  const oldAlignmentStateHandler = ({event, newValue, sent_ind}) => {\r\n\r\n    if (newValue=='1'){\r\n      setOldAlignmentState(\"none\");\r\n      SetDocOldHighlights([]);\r\n      SetSummaryOldHighlights([]);\r\n    } else if (newValue=='2'){\r\n      setOldAlignmentState(\"sent\");\r\n      sent_ind = (sent_ind===-1) ? CurrSentInd : sent_ind\r\n      const doc_ids = FindDocAlignmentPerSent(sent_ind)\r\n      const summary_ids = summary_json.filter((word) => {return (word.all_highlighted && word.sent_id === sent_ind)}).map((word) => {return word.tkn_id});\r\n      SetDocOldHighlights(doc_ids);\r\n      SetSummaryOldHighlights(summary_ids);\r\n    } else {\r\n      setOldAlignmentState(\"all\");\r\n      const doc_ids = doc_json.filter((word) => {return word.all_highlighted}).map((word) => {return word.tkn_id});\r\n      const summary_ids = summary_json.filter((word) => {return word.all_highlighted}).map((word) => {return word.tkn_id});\r\n      SetDocOldHighlights(doc_ids);\r\n      SetSummaryOldHighlights(summary_ids);\r\n    }\r\n  }\r\n\r\n  oldAlignmentStateHandler.defaultProps = {\r\n    sent_ind: -1\r\n  }\r\n\r\n\r\n  \r\n  const hoverHandler = ({inOrOut, curr_alignment_id, tkn_id, isSummary}) => {\r\n    // onMouseEnter for \"REVISE HOVER\"\r\n    if (inOrOut === \"in\" && StateMachineState===\"REVISE HOVER\") { \r\n      setDocJson(doc_json.map((word) => word.alignment_id.includes(curr_alignment_id) ? {...word, old_alignment_hover: true} : {...word, old_alignment_hover: false}))\r\n      setSummaryJson(summary_json.map((word) => word.alignment_id.includes(curr_alignment_id) ? {...word, old_alignment_hover: true} : {...word, old_alignment_hover: false}))\r\n    } \r\n    // onMouseLeave for \"REVISE HOVER\"\r\n    else if (inOrOut === \"out\" && StateMachineState===\"REVISE HOVER\") { \r\n      setDocJson(doc_json.map((word) => {return {...word, old_alignment_hover:false}}))\r\n      setSummaryJson(summary_json.map((word) => {return {...word, old_alignment_hover:false}}))\r\n    }\r\n    // onMouseEnter for all the alignments choosing states\r\n    // else if (inOrOut === \"in\" && [\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState) && isSummary) { \r\n      // const doc_tkn_ids = doc_json.map((word) => {return word.tkn_id}).filter((doc_id) => {return checkIfLemmasMatch({doc_id:doc_id, summary_ids:[tkn_id], isHover:true})});\r\n      // setDocJson(doc_json.map((word) => doc_tkn_ids.includes(word.tkn_id) ? {...word, red_color:true} : {...word, red_color:false}))\r\n    // } \r\n    // onMouseLeave for all the alignments choosing states\r\n    else if (inOrOut === \"out\" && [\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState) && isSummary) { \r\n      setDocJson(doc_json.map((word) => {return {...word, red_color:false}}))\r\n    }\r\n\r\n  }\r\n\r\n  const isRedLettered = (summary_tkn_id) => {\r\n    if ((StateMachineState === \"REVISE CLICKED\") && (summary_json.filter((word) => {return word.tkn_id === summary_tkn_id && word.sent_id > CurrSentInd}).length !== 0)){\r\n      return false\r\n    } else if ((summary_json.filter((word) => {return word.tkn_id === summary_tkn_id && word.sent_id !== CurrSentInd}).length !== 0) && !([\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState))) {\r\n      return false\r\n    } else if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState)) {\r\n      return true\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n  const MachineStateHandlerWrapper = ({clickedWordInfo, forceState, isBackBtn}) => {\r\n    \r\n    // // no alignment\r\n    if ([16].includes(t_StateMachineStateId) && (typeof forceState !== 'string')  && (StateMachineState !== \"REVISE HOVER\") && (doc_json.filter((word) => {return word.span_highlighted}).length === 0) && (StateMachineState!==\"START\") && !noAlignApproved) {\r\n      setNoAlignModalShow(true)\r\n      return\r\n    }\r\n    setNoAlignApproved(false)\r\n    \r\n    \r\n    \r\n    setSliderBoldStateActivated(false);\r\n    // if ([5,16].includes(t_StateMachineStateId) || ([11,13].includes(t_StateMachineStateId) && forceState===\"REVISE HOVER\") || (t_StateMachineStateId === 12 && forceState !== \"FINISH REVISION\") || ([14,15].includes(t_StateMachineStateId) && [\"SENTENCE END\", \"ANNOTATION\", \"SUMMARY END\", undefined].includes(forceState))) {\r\n    //   console.log(`forceState situation with: state ${forceState}`);\r\n    // }\r\n    // else{\r\n    //   console.log(\"ignore MachineStateHandlerWrapper\");\r\n    //   return; // AVIVSL: added this so people can't change anything\r\n    // }\r\n    MachineStateHandler(summary_json,\r\n                          StateMachineState, SetStateMachineState,\r\n                          SetInfoMessage, handleErrorOpen, isPunct,\r\n                          CurrSentInd, SetCurrSentInd, SetSummaryShadow,\r\n                          AlignmentCount, SetAlignmentCount,\r\n                          approveHighlightHandler,\r\n                          clickedWordInfo, forceState, \r\n                          StartReviseStateHandler, ExitReviseHandler,\r\n                          ReviseChooseAlignHandler, \r\n                          isBackBtn,\r\n                          setPrevSummaryJsonRevise, setPrevDocJsonRevise\r\n                         );\r\n  }\r\n\r\n  MachineStateHandlerWrapper.defaultProps = {\r\n    forceState: '',\r\n    clickedWordInfo: [],\r\n    isBackBtn: false\r\n  }\r\n\r\n\r\n/**************************************************************************************************************/\r\n\r\n  /*******  useState for smooth transition to \"SENTENCE END\" or \"SUMMARY END\" *******/\r\n  const finishedSent = useRef(false);\r\n\r\n  useEffect(() => {\r\n    const isNotStart = (StateMachineState !== \"START\" && summary_json.filter((word) => {return word.sent_id===CurrSentInd && word.shadowed}).length !== 0);\r\n    const isAllSentHighlighted = (summary_json.filter((word) => { return word.sent_id===CurrSentInd && !(word.all_highlighted || word.span_highlighted) && !isPunct(word.word)}).length === 0); // need \"isNotStart\" because also for \"START\" state isAllSentHighlighted=true because no sentence is span-highlighted yet \r\n    if (isAllSentHighlighted && isNotStart && !finishedSent.current && ![\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState)) {\r\n      finishedSent.current = true;\r\n\r\n\r\n      const isLastSent = (Math.max.apply(Math, summary_json.map(word => { return word.sent_id; })) === CurrSentInd)\r\n      if (isLastSent) {\r\n        MachineStateHandlerWrapper({forceState:\"SUMMARY END\"});   \r\n      } else {\r\n        MachineStateHandlerWrapper({forceState:\"SENTENCE END\"});   \r\n      }\r\n    }\r\n\r\n    // if regretted summary highlighting\r\n    else if(!isAllSentHighlighted && isNotStart && finishedSent.current && ![\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState)) { \r\n      console.log(`curr state is ${StateMachineState}`);\r\n      console.log(`curr CurrSentInd is ${CurrSentInd}`)\r\n      console.log(\"back to square one\");\r\n      finishedSent.current = false;\r\n      MachineStateHandlerWrapper({forceState:\"ANNOTATION\"});\r\n    }\r\n  }, [summary_json]);\r\n  /*********************************************************************************/ \r\n\r\n\r\n  \r\n  /*********** useState to update the summary shadow when next sentence ***********/ \r\n  useEffect(() => {\r\n    SetSummaryShadowAndUpdateHighlights(CurrSentInd);\r\n  }, [CurrSentInd]);\r\n  /********************************************************************************/\r\n\r\n\r\n  /***************************** bolding controlling *****************************/ \r\n  useEffect(() => {\r\n    // when choosing a span - if nothing is span_highlighted then all sent matches are in bold, otherwise only span_highlighted matches (when highlighting - something must be span-highlighted so automatically is '2')\r\n    if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\"].includes(StateMachineState) && !sliderBoldStateActivated) {\r\n      const bold_state = (summary_json.filter((word) => {return word.span_highlighted}).length === 0) ? '3' : '2'; // if no span is current highlighted - bold everything, otherwise bold only currently highlighted span\r\n      boldStateHandler(undefined, bold_state);\r\n    } else if ([\"REVISE HOVER\", \"REVISE CLICKED\"].includes(StateMachineState) && !sliderBoldStateActivated) {\r\n      boldStateHandler(undefined, '1');\r\n    }\r\n  }, [StateMachineState, summary_json]);\r\n  /********************************************************************************/\r\n\r\n\r\n    /***************************** old alignments controlling *****************************/ \r\n    const prevState = useRef(\"\")\r\n    useEffect(() => {\r\n      if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\"].includes(StateMachineState)) {\r\n        oldAlignmentStateHandler({event:undefined, newValue:'3', sent_ind:-1});\r\n      } else if (StateMachineState === \"REVISE CLICKED\"){\r\n        oldAlignmentStateHandler({event:undefined, newValue:'1', sent_ind:-1});\r\n      } else if (StateMachineState === \"REVISE HOVER\"){\r\n        oldAlignmentStateHandler({event:undefined, newValue:'3', sent_ind:-1});\r\n      }\r\n      prevState.current = StateMachineState;\r\n    }, [StateMachineState, AlignmentCount]);\r\n    /********************************************************************************/\r\n    useEffect(() => {\r\n      console.log(`t_doc_json is:`)\r\n      console.log(doc_json)\r\n    }, []);\r\n    \r\n    \r\n    \r\n    /******************* highlighting while choosing spans to help *******************/ \r\n\r\n\r\n    useEffect(() => {\r\n      if (DocOnMouseDownID !== \"-1\"){\r\n        setDocOnMouseDownActivated(true)\r\n      } else if (DocOnMouseDownID === \"-1\"){\r\n        setDocOnMouseDownActivated(false)\r\n      } \r\n      \r\n      if (SummaryOnMouseDownID !== \"-1\") {\r\n        setSummaryOnMouseDownActivated(true)\r\n      } else {\r\n        setSummaryOnMouseDownActivated(false)\r\n      }\r\n    }, [DocOnMouseDownID,SummaryOnMouseDownID]);\r\n    \r\n    useEffect(() => {\r\n      if ([\"ANNOTATION\", \"SENTENCE END\", \"SUMMARY END\", \"REVISE CLICKED\", \"SENTENCE START\"].includes(StateMachineState)){\r\n        if(docOnMouseDownActivated) {\r\n          console.log(`DocOnMouseDownID is ${DocOnMouseDownID} and hoverActivatedId ia ${hoverActivatedId}`)\r\n          const min_ID =  (DocOnMouseDownID > hoverActivatedId) ? hoverActivatedId : DocOnMouseDownID;\r\n          const max_ID =  (DocOnMouseDownID > hoverActivatedId) ? DocOnMouseDownID : hoverActivatedId;\r\n          let chosen_IDs = [];\r\n          for(let i=min_ID; i<=max_ID; i++){\r\n            chosen_IDs.push(i);\r\n          }\r\n          setDocJson(doc_json.map((word) => chosen_IDs.includes(word.tkn_id)? {...word, span_alignment_hover:true}:{...word, span_alignment_hover:false}))\r\n        } else if (!docOnMouseDownActivated){\r\n          setDocJson(doc_json.map((word) => {return {...word, span_alignment_hover:false}}))\r\n        }\r\n        if(summaryOnMouseDownActivated) {\r\n          console.log(`SummaryOnMouseDownID is ${SummaryOnMouseDownID} and hoverActivatedId ia ${hoverActivatedId}`)\r\n          const min_ID =  (SummaryOnMouseDownID > hoverActivatedId) ? hoverActivatedId : SummaryOnMouseDownID;\r\n          const max_ID =  (SummaryOnMouseDownID > hoverActivatedId) ? SummaryOnMouseDownID : hoverActivatedId;\r\n          let chosen_IDs = [];\r\n          for(let i=min_ID; i<=max_ID; i++){\r\n            chosen_IDs.push(i);\r\n          }\r\n          setSummaryJson(summary_json.map((word) => chosen_IDs.includes(word.tkn_id)? {...word, span_alignment_hover:true}:{...word, span_alignment_hover:false}))\r\n        } else if (!summaryOnMouseDownActivated){\r\n          setSummaryJson(summary_json.map((word) => {return {...word, span_alignment_hover:false}}))\r\n          \r\n          if (isRedLettered(hoverActivatedId) && hoverActivatedDocOrSummary === \"summary\") {\r\n            const doc_tkn_ids = doc_json.map((word) => {return word.tkn_id}).filter((doc_id) => {return checkIfLemmasMatch({doc_id:doc_id, summary_ids:[hoverActivatedId], isHover:true})});\r\n            \r\n            console.log(\"red is activated:\")\r\n            console.log(doc_json.filter((word) => {return doc_tkn_ids.includes(word.tkn_id)}).map((word) => {return word.word}))\r\n\r\n            setDocJson(doc_json.map((word) => doc_tkn_ids.includes(word.tkn_id) ? {...word, red_color:true} : {...word, red_color:false}))  \r\n          }  \r\n        }\r\n      }\r\n    }, [docOnMouseDownActivated, summaryOnMouseDownActivated, hoverActivatedId]);\r\n    /********************************************************************************/ \r\n/**************************************************************************************************************/\r\n\r\n\r\n\r\n    const SubmitHandler = (event) => {\r\n      return\r\n    }\r\n\r\n\r\n  return ( \r\n      <>\r\n         <Annotation \r\n                    isTutorial = {true}                                         isGuidedAnnotation={false} \r\n                    task_id={'0'}                                               doc_paragraph_breaks = {doc_paragraph_breaks}\r\n                    doc_json = {doc_json}                                       setDocJson = {setDocJson}\r\n                    summary_json = {summary_json}                               setSummaryJson = {setSummaryJson}\r\n                    all_lemma_match_mtx = {all_lemma_match_mtx}                 important_lemma_match_mtx = {important_lemma_match_mtx}\r\n                    StateMachineState = {StateMachineState}                     SetStateMachineState = {SetStateMachineState}\r\n                    handleErrorOpen = {handleErrorOpen}                         isPunct = {isPunct}\r\n                    toggleSummarySpanHighlight = {toggleSummarySpanHighlight}   toggleDocSpanHighlight = {toggleDocSpanHighlight}\r\n                    boldState = {boldState}                                     boldStateHandler = {boldStateHandler}\r\n                    SubmitHandler = {SubmitHandler}                             hoverHandler = {hoverHandler}\r\n                    CurrSentInd = {CurrSentInd}                                 SetCurrSentInd = {SetCurrSentInd}\r\n                    InfoMessage = {InfoMessage}                                 MachineStateHandlerWrapper = {MachineStateHandlerWrapper}\r\n                    AlignmentCount = {AlignmentCount}                           SetAlignmentCount = {SetAlignmentCount}\r\n                    oldAlignmentState = {oldAlignmentState}                     oldAlignmentStateHandler = {oldAlignmentStateHandler}\r\n                    DocOnMouseDownID = {DocOnMouseDownID}                       SetDocOnMouseDownID = {SetDocOnMouseDownID}\r\n                    SummaryOnMouseDownID = {SummaryOnMouseDownID}               SetSummaryOnMouseDownID = {SetSummaryOnMouseDownID}\r\n                    docOnMouseDownActivated = {docOnMouseDownActivated}         setDocOnMouseDownActivated = {setDocOnMouseDownActivated}\r\n                    summaryOnMouseDownActivated = {summaryOnMouseDownActivated} setSummaryOnMouseDownActivated = {setSummaryOnMouseDownActivated}\r\n                    setHoverActivatedId = {setHoverActivatedId}                 setHoverActivatedDocOrSummary = {setHoverActivatedDocOrSummary}\r\n                    hoverActivatedId = {hoverActivatedId}\r\n                    t_StateMachineStateId = {t_StateMachineStateId}             t_SetStateMachineStateId = {t_SetStateMachineStateId}\r\n                    t_start_doc_json = {t_start_doc_json}                       t_middle_doc_json = {t_middle_doc_json}\r\n                    t_sent_end_doc_json = {t_sent_end_doc_json}                 t_submit_doc_json = {t_submit_doc_json}\r\n                    t_start_summary_json = {t_start_summary_json}               t_middle_summary_json = {t_middle_summary_json}\r\n                    t_sent_end_summary_json = {t_sent_end_summary_json}         t_submit_summary_json = {t_submit_summary_json}\r\n                    t_state_messages = {t_state_messages}\r\n                    g_guiding_info_msg = {undefined}                            g_is_good_alignment = {undefined}\r\n                    g_show_hint = {undefined}                                   g_setShowHint = {undefined}\r\n                    g_hint_msg = {{\"text\":\"\", \"title\":\"\"}}                      g_showWhereNavbar = {undefined}\r\n                    g_open_hint={undefined}                                     g_setOpenHint={undefined}\r\n                    g_with_glow_hint={undefined}                                g_setWithGlowHint={undefined}\r\n                    g_answer_words_to_glow={{\"type\":\"\", \"ids\":[]}}              g_FinishedModalShow={undefined}\r\n                    g_Guider_msg={{\"type\":\"\", \"where\":\"\", \"text\":\"\"}}           g_setGuiderMsg={undefined}\r\n                    \r\n                    OpeningModalShow = {undefined}                              setOpeningModalShow = {undefined}\r\n                    noAlignModalShow = {noAlignModalShow}                       setNoAlignModalShow = {setNoAlignModalShow}\r\n                    noAlignApproved = {noAlignApproved}                         setNoAlignApproved = {setNoAlignApproved}\r\n                    />\r\n        \r\n        {/* <Player\r\n          playsInline\r\n          src=\"./Videos/old-highlights_m.mp4\"\r\n          fluid={false}\r\n          aspectRatio=\"auto\"\r\n        >\r\n          <BigPlayButton position=\"center\" />\r\n        </Player> */}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Tutorial\r\n","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\Tutorial_utils.js",[],[],"C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\TutorialCard.js",["315","316"],[],"import Card from 'react-bootstrap/Card';\r\nimport Button from 'react-bootstrap/Button';\r\nimport DropdownButton from 'react-bootstrap/DropdownButton'\r\nimport Dropdown from 'react-bootstrap/Dropdown'\r\nimport { t_StateMachineStateIdHandler, getTutorialCardTitle, getTutorialCardText } from './Tutorial_utils'\r\nimport { Link } from 'react-router-dom';\r\n\r\n\r\n\r\nconst TutorialCard = ({t_StateMachineStateId, t_SetStateMachineStateId, t_state_messages, SetStateMachineState, \r\n                      setDocJson, t_start_doc_json, t_middle_doc_json, t_sent_end_doc_json, t_submit_doc_json,\r\n                      setSummaryJson, t_start_summary_json, t_middle_summary_json, t_sent_end_summary_json, t_submit_summary_json,\r\n                      SetCurrSentInd,\r\n                      MachineStateHandlerWrapper}) => {\r\n    return (\r\n        <Card className={`${(t_StateMachineStateId==0) ? 'tutorial-card-intro' : ''} \r\n                          ${(t_StateMachineStateId==`15`) ? 'tutorial-card-end' : ''}\r\n                          ${(![0,15].includes(t_StateMachineStateId)) ? 'tutorial-card-not-intro' : ''}`}\r\n                            bg=\"info\" border=\"primary\" style={{ width: '30%' }}>\r\n          <Card.Body>\r\n            <Card.Title className='tutorial-title'>{getTutorialCardTitle(t_state_messages,t_StateMachineStateId)}</Card.Title>\r\n            <Card.Text>\r\n              {getTutorialCardText(t_state_messages,t_StateMachineStateId)}\r\n            </Card.Text>\r\n              {(t_StateMachineStateId === 0) && (\r\n                <DropdownButton className=\"tutorial-drop-down-button\" size=\"lg\" variant=\"secondary\" drop=\"end\" id=\"dropdown-button-drop-end\" title=\"Sections\">\r\n                  {t_state_messages.map((t_state) => (\r\n                      <Dropdown.Item as=\"button\" onClick={() => {t_StateMachineStateIdHandler({newStateId:t_state.state_cnt, SetStateMachineState:SetStateMachineState, t_SetStateMachineStateId:t_SetStateMachineStateId, t_StateMachineStateId:t_StateMachineStateId, \r\n                                                                      setDocJson:setDocJson, t_start_doc_json:t_start_doc_json, t_middle_doc_json:t_middle_doc_json, t_sent_end_doc_json:t_sent_end_doc_json, t_submit_doc_json:t_submit_doc_json,\r\n                                                                      setSummaryJson:setSummaryJson, t_start_summary_json:t_start_summary_json, t_middle_summary_json:t_middle_summary_json, t_sent_end_summary_json:t_sent_end_summary_json, t_submit_summary_json:t_submit_summary_json,\r\n                                                                      SetCurrSentInd:SetCurrSentInd,\r\n                                                                      MachineStateHandlerWrapper:MachineStateHandlerWrapper}\r\n                                                                      )}}\r\n                        >\r\n                      {t_state.title}\r\n                      </Dropdown.Item>\r\n                    ))}\r\n              </DropdownButton>\r\n              )}\r\n                {(t_StateMachineStateId !== 0) && (\r\n                <Button style={{marginRight:\"1%\"}} className=\"btn btn-warning btn-lg\" onClick={() => {t_StateMachineStateIdHandler({newStateId:0, SetStateMachineState:SetStateMachineState, t_SetStateMachineStateId:t_SetStateMachineStateId, t_StateMachineStateId:t_StateMachineStateId, \r\n                                                                                                      setDocJson:setDocJson, t_start_doc_json:t_start_doc_json, t_middle_doc_json:t_middle_doc_json, t_sent_end_doc_json:t_sent_end_doc_json, t_submit_doc_json:t_submit_doc_json,\r\n                                                                                                      setSummaryJson:setSummaryJson, t_start_summary_json:t_start_summary_json, t_middle_summary_json:t_middle_summary_json, t_sent_end_summary_json:t_sent_end_summary_json, t_submit_summary_json:t_submit_summary_json,\r\n                                                                                                      SetCurrSentInd:SetCurrSentInd,\r\n                                                                                                      MachineStateHandlerWrapper:MachineStateHandlerWrapper})}}\r\n                >\r\n                  Back to Intro\r\n              </Button>\r\n              )}\r\n              {(t_StateMachineStateId !== 0) && (\r\n                <Button className=\"btn btn-dark btn-lg\" onClick={() => {t_StateMachineStateIdHandler({newStateId:t_StateMachineStateId-1, SetStateMachineState:SetStateMachineState, t_SetStateMachineStateId:t_SetStateMachineStateId, t_StateMachineStateId:t_StateMachineStateId, \r\n                                                                                                      setDocJson:setDocJson, t_start_doc_json:t_start_doc_json, t_middle_doc_json:t_middle_doc_json, t_sent_end_doc_json:t_sent_end_doc_json, t_submit_doc_json:t_submit_doc_json,\r\n                                                                                                      setSummaryJson:setSummaryJson, t_start_summary_json:t_start_summary_json, t_middle_summary_json:t_middle_summary_json, t_sent_end_summary_json:t_sent_end_summary_json, t_submit_summary_json:t_submit_summary_json,\r\n                                                                                                      SetCurrSentInd:SetCurrSentInd,\r\n                                                                                                      MachineStateHandlerWrapper:MachineStateHandlerWrapper})}}\r\n                >\r\n                  Back\r\n              </Button>\r\n              )}\r\n\r\n            {(t_StateMachineStateId !== 15) && (\r\n                <Button className=\"btn btn-primary btn-lg right-button\" onClick={() => {t_StateMachineStateIdHandler({newStateId:t_StateMachineStateId+1, SetStateMachineState:SetStateMachineState, t_SetStateMachineStateId:t_SetStateMachineStateId, t_StateMachineStateId:t_StateMachineStateId, \r\n                                                                                                      setDocJson:setDocJson, t_start_doc_json:t_start_doc_json, t_middle_doc_json:t_middle_doc_json, t_sent_end_doc_json:t_sent_end_doc_json, t_submit_doc_json:t_submit_doc_json,\r\n                                                                                                      setSummaryJson:setSummaryJson, t_start_summary_json:t_start_summary_json, t_middle_summary_json:t_middle_summary_json, t_sent_end_summary_json:t_sent_end_summary_json, t_submit_summary_json:t_submit_summary_json,\r\n                                                                                                      SetCurrSentInd:SetCurrSentInd,\r\n                                                                                                      MachineStateHandlerWrapper:MachineStateHandlerWrapper})}}\r\n                >\r\n                  Next\r\n              </Button>\r\n            )}\r\n            {(t_StateMachineStateId === 15) && (\r\n              <Link to=\"/guidedAnnotation\">\r\n                <Button className=\"btn btn-success btn-lg right-button\">\r\n              To Guided Annotation\r\n              </Button>\r\n              </Link>\r\n            )}\r\n          </Card.Body>\r\n        </Card>\r\n    )\r\n}\r\n\r\n\r\nexport { TutorialCard }\r\n","C:\\Users\\aviv\\OneDrive\\Desktop\\highlights-extract-app\\src\\components\\mturk_utils.js",["317"],[],"/**\r\n * Gets a URL parameter from the query string\r\n */\r\n function turkGetParam( name, defaultValue ) { \r\n    var regexS = \"[?&]\"+name+\"=([^&#]*)\"; \r\n    var regex = new RegExp( regexS ); \r\n    var tmpURL = window.location.href; \r\n    var results = regex.exec( tmpURL ); \r\n    if( results == null ) { \r\n      return defaultValue; \r\n    } else { \r\n      return results[1];    \r\n    } \r\n }\r\n \r\n /**\r\n  * URL decode a parameter\r\n  */\r\n function decode(strToDecode)\r\n {\r\n   var encoded = strToDecode;\r\n   return unescape(encoded.replace(/\\+/g,  \" \"));\r\n }\r\n \r\n \r\n /**\r\n  * Returns the Mechanical Turk Site to post the HIT to (sandbox. prod)\r\n  */\r\n export function turkGetSubmitToHost() {\r\n     var defaultHost = \"https://www.mturk.com\";\r\n     var submitToHost = decode(turkGetParam(\"turkSubmitTo\", defaultHost));\r\n     if (stringStartsWith(submitToHost, \"https://\")) {\r\n         return submitToHost;\r\n     }\r\n     if (stringStartsWith(submitToHost, \"http://\")) {\r\n         return submitToHost;\r\n     }\r\n     if (stringStartsWith(submitToHost, \"//\")) {\r\n         return submitToHost;\r\n     }\r\n     return defaultHost;\r\n }\r\n \r\n export function turkGetAssignmentId() {\r\n   const assignmentID = turkGetParam('assignmentId', \"\");\r\n   return assignmentID;\r\n }\r\n \r\n \r\n /**\r\n  * Sets the assignment ID in the form. Defaults to use mturk_form and submitButton\r\n  */ \r\n function turkSetAssignmentID( form_name, button_name ) {\r\n \r\n   if (form_name == null) {\r\n     form_name = \"mturk_form\";\r\n   }\r\n \r\n   if (button_name == null) {\r\n     button_name = \"submitButton\";\r\n   }\r\n \r\n   const assignmentID = turkGetParam('assignmentId', \"\");\r\n   const submit = document.getElementById('assignmentId');\r\n   submit.value = assignmentID;\r\n \r\n   if (!assignmentID || (assignmentID === \"ASSIGNMENT_ID_NOT_AVAILABLE\")) { \r\n     // If we're previewing, disable the button and give it a helpful message\r\n     const btn = document.getElementById(button_name);\r\n     if (btn) {\r\n       btn.disabled = true; \r\n       btn.value = \"You must ACCEPT the HIT before you can submit the results.\";\r\n       btn.innerHTML = \"You must ACCEPT the HIT before you can submit the results.\"\r\n     } \r\n   }\r\n \r\n   const form = document.getElementById(form_name); \r\n   if (form) {\r\n      form.action = turkGetSubmitToHost() + \"/mturk/externalSubmit\"; \r\n   }\r\n }\r\n \r\n // Inlined functionality for String.startsWith as IE does not support that method.\r\n // Function body from:\r\n // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith#Polyfill\r\n function stringStartsWith(str, search, pos) {\r\n     pos = (!pos || pos < 0) ? 0 : +pos;\r\n     return str.substring(pos, pos + search.length) === search;\r\n }\r\n\r\n\r\n\r\n\r\n const handleSubmit = (assignmentId, turkSubmitTo, doc_json, summary_json, g_completed, g_guided_annotation_history) => {\r\n    // const urlParams = new URLSearchParams(window.location.search)\r\n   \r\n    // create the form element and point it to the correct endpoint\r\n    const form = document.createElement('form')\r\n    // form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href\r\n    form.action = turkSubmitTo + \"/mturk/externalSubmit\"; \r\n    form.method = 'post'\r\n   \r\n    // attach the assignmentId\r\n    const inputAssignmentId = document.createElement('input')\r\n    inputAssignmentId.name = 'assignmentId'\r\n    // inputAssignmentId.value = urlParams.get('assignmentId')\r\n    inputAssignmentId.value = assignmentId\r\n    inputAssignmentId.hidden = true\r\n    form.appendChild(inputAssignmentId)\r\n    \r\n    // attach if completed the guided annotation\r\n    const completed_guided_annotation = document.createElement('input')\r\n    completed_guided_annotation.name = 'completed_guided_annotation'\r\n    completed_guided_annotation.value = JSON.stringify(g_completed)\r\n    completed_guided_annotation.hidden = true\r\n    form.appendChild(completed_guided_annotation)\r\n\r\n    // attach if completed the guided annotation\r\n    const guided_annotation_history = document.createElement('input')\r\n    guided_annotation_history.name = 'guided_annotation_history'\r\n    guided_annotation_history.value = JSON.stringify(g_guided_annotation_history)\r\n    guided_annotation_history.hidden = true\r\n    form.appendChild(guided_annotation_history)\r\n\r\n\r\n    // attach doc_json data\r\n    const inputDocJson = document.createElement('input')\r\n    inputDocJson.name = 'doc_json'\r\n    inputDocJson.value = JSON.stringify(doc_json)\r\n    inputDocJson.hidden = true\r\n    form.appendChild(inputDocJson)\r\n\r\n    // attach summary_json data\r\n    const inputSummaryJson = document.createElement('input')\r\n    inputSummaryJson.name = 'summary_json'\r\n    inputSummaryJson.value = JSON.stringify(summary_json)\r\n    inputSummaryJson.hidden = true\r\n    form.appendChild(inputSummaryJson)\r\n   \r\n    // attach the form to the HTML document and trigger submission\r\n    document.body.appendChild(form)\r\n    form.submit()\r\n  }\r\n  \r\n  export { handleSubmit }",{"ruleId":"318","replacedBy":"319"},{"ruleId":"320","replacedBy":"321"},{"ruleId":"322","severity":1,"message":"323","line":7,"column":8,"nodeType":"324","messageId":"325","endLine":7,"endColumn":17},{"ruleId":"322","severity":1,"message":"326","line":36,"column":31,"nodeType":"324","messageId":"325","endLine":36,"endColumn":52},{"ruleId":"322","severity":1,"message":"327","line":38,"column":8,"nodeType":"324","messageId":"325","endLine":38,"endColumn":9},{"ruleId":"322","severity":1,"message":"328","line":39,"column":8,"nodeType":"324","messageId":"325","endLine":39,"endColumn":11},{"ruleId":"322","severity":1,"message":"329","line":401,"column":11,"nodeType":"324","messageId":"325","endLine":401,"endColumn":26},{"ruleId":"330","severity":1,"message":"331","line":410,"column":17,"nodeType":"332","messageId":"333","endLine":410,"endColumn":19},{"ruleId":"330","severity":1,"message":"331","line":413,"column":24,"nodeType":"332","messageId":"333","endLine":413,"endColumn":26},{"ruleId":"322","severity":1,"message":"334","line":416,"column":13,"nodeType":"324","messageId":"325","endLine":416,"endColumn":19},{"ruleId":"322","severity":1,"message":"334","line":421,"column":13,"nodeType":"324","messageId":"325","endLine":421,"endColumn":19},{"ruleId":"330","severity":1,"message":"331","line":447,"column":17,"nodeType":"332","messageId":"333","endLine":447,"endColumn":19},{"ruleId":"330","severity":1,"message":"331","line":451,"column":24,"nodeType":"332","messageId":"333","endLine":451,"endColumn":26},{"ruleId":"335","severity":1,"message":"336","line":573,"column":6,"nodeType":"337","endLine":573,"endColumn":20,"suggestions":"338"},{"ruleId":"335","severity":1,"message":"339","line":581,"column":6,"nodeType":"337","endLine":581,"endColumn":19,"suggestions":"340"},{"ruleId":"335","severity":1,"message":"341","line":595,"column":6,"nodeType":"337","endLine":595,"endColumn":39,"suggestions":"342"},{"ruleId":"335","severity":1,"message":"343","line":610,"column":8,"nodeType":"337","endLine":610,"endColumn":43,"suggestions":"344"},{"ruleId":"335","severity":1,"message":"345","line":676,"column":8,"nodeType":"337","endLine":676,"endColumn":80,"suggestions":"346"},{"ruleId":"335","severity":1,"message":"347","line":795,"column":8,"nodeType":"337","endLine":795,"endColumn":10,"suggestions":"348"},{"ruleId":"335","severity":1,"message":"349","line":819,"column":8,"nodeType":"337","endLine":819,"endColumn":20,"suggestions":"350"},{"ruleId":"322","severity":1,"message":"351","line":7,"column":8,"nodeType":"324","messageId":"325","endLine":7,"endColumn":12},{"ruleId":"322","severity":1,"message":"352","line":9,"column":10,"nodeType":"324","messageId":"325","endLine":9,"endColumn":18},{"ruleId":"322","severity":1,"message":"329","line":360,"column":13,"nodeType":"324","messageId":"325","endLine":360,"endColumn":28},{"ruleId":"330","severity":1,"message":"331","line":369,"column":19,"nodeType":"332","messageId":"333","endLine":369,"endColumn":21},{"ruleId":"330","severity":1,"message":"331","line":372,"column":26,"nodeType":"332","messageId":"333","endLine":372,"endColumn":28},{"ruleId":"322","severity":1,"message":"334","line":375,"column":15,"nodeType":"324","messageId":"325","endLine":375,"endColumn":21},{"ruleId":"322","severity":1,"message":"334","line":380,"column":15,"nodeType":"324","messageId":"325","endLine":380,"endColumn":21},{"ruleId":"330","severity":1,"message":"331","line":406,"column":19,"nodeType":"332","messageId":"333","endLine":406,"endColumn":21},{"ruleId":"330","severity":1,"message":"331","line":410,"column":26,"nodeType":"332","messageId":"333","endLine":410,"endColumn":28},{"ruleId":"353","severity":1,"message":"354","line":827,"column":126,"nodeType":"355","messageId":"356","endLine":827,"endColumn":127,"suggestions":"357"},{"ruleId":"353","severity":1,"message":"354","line":827,"column":332,"nodeType":"355","messageId":"356","endLine":827,"endColumn":333,"suggestions":"358"},{"ruleId":"335","severity":1,"message":"359","line":878,"column":6,"nodeType":"337","endLine":878,"endColumn":20,"suggestions":"360"},{"ruleId":"335","severity":1,"message":"339","line":886,"column":6,"nodeType":"337","endLine":886,"endColumn":19,"suggestions":"361"},{"ruleId":"335","severity":1,"message":"341","line":898,"column":6,"nodeType":"337","endLine":898,"endColumn":39,"suggestions":"362"},{"ruleId":"335","severity":1,"message":"343","line":912,"column":7,"nodeType":"337","endLine":912,"endColumn":42,"suggestions":"363"},{"ruleId":"335","severity":1,"message":"364","line":951,"column":7,"nodeType":"337","endLine":951,"endColumn":46,"suggestions":"365"},{"ruleId":"335","severity":1,"message":"366","line":987,"column":7,"nodeType":"337","endLine":987,"endColumn":79,"suggestions":"367"},{"ruleId":"335","severity":1,"message":"368","line":995,"column":7,"nodeType":"337","endLine":995,"endColumn":25,"suggestions":"369"},{"ruleId":"335","severity":1,"message":"370","line":1020,"column":7,"nodeType":"337","endLine":1020,"endColumn":25,"suggestions":"371"},{"ruleId":"335","severity":1,"message":"372","line":1051,"column":6,"nodeType":"337","endLine":1051,"endColumn":25,"suggestions":"373"},{"ruleId":"335","severity":1,"message":"374","line":1066,"column":7,"nodeType":"337","endLine":1066,"endColumn":31,"suggestions":"375"},{"ruleId":"322","severity":1,"message":"376","line":5,"column":8,"nodeType":"324","messageId":"325","endLine":5,"endColumn":16},{"ruleId":"322","severity":1,"message":"377","line":7,"column":10,"nodeType":"324","messageId":"325","endLine":7,"endColumn":29},{"ruleId":"322","severity":1,"message":"378","line":7,"column":31,"nodeType":"324","messageId":"325","endLine":7,"endColumn":53},{"ruleId":"322","severity":1,"message":"379","line":8,"column":8,"nodeType":"324","messageId":"325","endLine":8,"endColumn":16},{"ruleId":"322","severity":1,"message":"380","line":9,"column":8,"nodeType":"324","messageId":"325","endLine":9,"endColumn":18},{"ruleId":"322","severity":1,"message":"381","line":11,"column":8,"nodeType":"324","messageId":"325","endLine":11,"endColumn":11},{"ruleId":"322","severity":1,"message":"382","line":15,"column":8,"nodeType":"324","messageId":"325","endLine":15,"endColumn":18},{"ruleId":"322","severity":1,"message":"383","line":16,"column":8,"nodeType":"324","messageId":"325","endLine":16,"endColumn":19},{"ruleId":"322","severity":1,"message":"384","line":17,"column":8,"nodeType":"324","messageId":"325","endLine":17,"endColumn":19},{"ruleId":"322","severity":1,"message":"385","line":19,"column":8,"nodeType":"324","messageId":"325","endLine":19,"endColumn":11},{"ruleId":"322","severity":1,"message":"386","line":20,"column":10,"nodeType":"324","messageId":"325","endLine":20,"endColumn":21},{"ruleId":"322","severity":1,"message":"387","line":42,"column":49,"nodeType":"324","messageId":"325","endLine":42,"endColumn":63},{"ruleId":"322","severity":1,"message":"388","line":88,"column":10,"nodeType":"324","messageId":"325","endLine":88,"endColumn":30},{"ruleId":"322","severity":1,"message":"389","line":89,"column":10,"nodeType":"324","messageId":"325","endLine":89,"endColumn":25},{"ruleId":"322","severity":1,"message":"390","line":90,"column":10,"nodeType":"324","messageId":"325","endLine":90,"endColumn":34},{"ruleId":"322","severity":1,"message":"391","line":91,"column":10,"nodeType":"324","messageId":"325","endLine":91,"endColumn":29},{"ruleId":"322","severity":1,"message":"392","line":95,"column":10,"nodeType":"324","messageId":"325","endLine":95,"endColumn":22},{"ruleId":"322","severity":1,"message":"393","line":95,"column":24,"nodeType":"324","messageId":"325","endLine":95,"endColumn":39},{"ruleId":"330","severity":1,"message":"331","line":228,"column":27,"nodeType":"332","messageId":"333","endLine":228,"endColumn":29},{"ruleId":"322","severity":1,"message":"394","line":284,"column":9,"nodeType":"324","messageId":"325","endLine":284,"endColumn":18},{"ruleId":"322","severity":1,"message":"395","line":350,"column":13,"nodeType":"324","messageId":"325","endLine":350,"endColumn":29},{"ruleId":"335","severity":1,"message":"396","line":434,"column":62,"nodeType":"324","endLine":434,"endColumn":69},{"ruleId":"335","severity":1,"message":"397","line":436,"column":4,"nodeType":"337","endLine":436,"endColumn":27,"suggestions":"398"},{"ruleId":"335","severity":1,"message":"399","line":443,"column":4,"nodeType":"337","endLine":443,"endColumn":6,"suggestions":"400"},{"ruleId":"335","severity":1,"message":"401","line":473,"column":8,"nodeType":"337","endLine":473,"endColumn":24,"suggestions":"402"},{"ruleId":"335","severity":1,"message":"403","line":485,"column":8,"nodeType":"337","endLine":485,"endColumn":25,"suggestions":"404"},{"ruleId":"322","severity":1,"message":"385","line":7,"column":8,"nodeType":"324","messageId":"325","endLine":7,"endColumn":11},{"ruleId":"322","severity":1,"message":"405","line":9,"column":8,"nodeType":"324","messageId":"325","endLine":9,"endColumn":19},{"ruleId":"322","severity":1,"message":"406","line":10,"column":10,"nodeType":"324","messageId":"325","endLine":10,"endColumn":17},{"ruleId":"322","severity":1,"message":"407","line":14,"column":7,"nodeType":"324","messageId":"325","endLine":14,"endColumn":12},{"ruleId":"322","severity":1,"message":"408","line":1,"column":8,"nodeType":"324","messageId":"325","endLine":1,"endColumn":18},{"ruleId":"318","replacedBy":"409"},{"ruleId":"320","replacedBy":"410"},{"ruleId":"353","severity":1,"message":"354","line":17,"column":32,"nodeType":"355","messageId":"356","endLine":17,"endColumn":33,"suggestions":"411"},{"ruleId":"353","severity":1,"message":"354","line":17,"column":46,"nodeType":"355","messageId":"356","endLine":17,"endColumn":47,"suggestions":"412"},{"ruleId":"353","severity":1,"message":"354","line":24,"column":32,"nodeType":"355","messageId":"356","endLine":24,"endColumn":33,"suggestions":"413"},{"ruleId":"353","severity":1,"message":"354","line":24,"column":45,"nodeType":"355","messageId":"356","endLine":24,"endColumn":46,"suggestions":"414"},{"ruleId":"353","severity":1,"message":"354","line":31,"column":32,"nodeType":"355","messageId":"356","endLine":31,"endColumn":33,"suggestions":"415"},{"ruleId":"353","severity":1,"message":"354","line":31,"column":44,"nodeType":"355","messageId":"356","endLine":31,"endColumn":45,"suggestions":"416"},{"ruleId":"353","severity":1,"message":"354","line":39,"column":32,"nodeType":"355","messageId":"356","endLine":39,"endColumn":33,"suggestions":"417"},{"ruleId":"353","severity":1,"message":"354","line":39,"column":46,"nodeType":"355","messageId":"356","endLine":39,"endColumn":47,"suggestions":"418"},{"ruleId":"353","severity":1,"message":"354","line":60,"column":33,"nodeType":"355","messageId":"356","endLine":60,"endColumn":34,"suggestions":"419"},{"ruleId":"353","severity":1,"message":"354","line":60,"column":40,"nodeType":"355","messageId":"356","endLine":60,"endColumn":41,"suggestions":"420"},{"ruleId":"353","severity":1,"message":"354","line":60,"column":55,"nodeType":"355","messageId":"356","endLine":60,"endColumn":56,"suggestions":"421"},{"ruleId":"353","severity":1,"message":"354","line":60,"column":67,"nodeType":"355","messageId":"356","endLine":60,"endColumn":68,"suggestions":"422"},{"ruleId":"353","severity":1,"message":"354","line":70,"column":31,"nodeType":"355","messageId":"356","endLine":70,"endColumn":32,"suggestions":"423"},{"ruleId":"353","severity":1,"message":"354","line":70,"column":43,"nodeType":"355","messageId":"356","endLine":70,"endColumn":44,"suggestions":"424"},{"ruleId":"353","severity":1,"message":"354","line":70,"column":58,"nodeType":"355","messageId":"356","endLine":70,"endColumn":59,"suggestions":"425"},{"ruleId":"353","severity":1,"message":"354","line":70,"column":70,"nodeType":"355","messageId":"356","endLine":70,"endColumn":71,"suggestions":"426"},{"ruleId":"353","severity":1,"message":"354","line":85,"column":31,"nodeType":"355","messageId":"356","endLine":85,"endColumn":32,"suggestions":"427"},{"ruleId":"353","severity":1,"message":"354","line":85,"column":45,"nodeType":"355","messageId":"356","endLine":85,"endColumn":46,"suggestions":"428"},{"ruleId":"353","severity":1,"message":"354","line":85,"column":60,"nodeType":"355","messageId":"356","endLine":85,"endColumn":61,"suggestions":"429"},{"ruleId":"353","severity":1,"message":"354","line":85,"column":76,"nodeType":"355","messageId":"356","endLine":85,"endColumn":77,"suggestions":"430"},{"ruleId":"353","severity":1,"message":"354","line":93,"column":33,"nodeType":"355","messageId":"356","endLine":93,"endColumn":34,"suggestions":"431"},{"ruleId":"353","severity":1,"message":"354","line":93,"column":49,"nodeType":"355","messageId":"356","endLine":93,"endColumn":50,"suggestions":"432"},{"ruleId":"353","severity":1,"message":"354","line":93,"column":64,"nodeType":"355","messageId":"356","endLine":93,"endColumn":65,"suggestions":"433"},{"ruleId":"353","severity":1,"message":"354","line":93,"column":76,"nodeType":"355","messageId":"356","endLine":93,"endColumn":77,"suggestions":"434"},{"ruleId":"353","severity":1,"message":"354","line":102,"column":33,"nodeType":"355","messageId":"356","endLine":102,"endColumn":34,"suggestions":"435"},{"ruleId":"353","severity":1,"message":"354","line":102,"column":46,"nodeType":"355","messageId":"356","endLine":102,"endColumn":47,"suggestions":"436"},{"ruleId":"353","severity":1,"message":"354","line":102,"column":61,"nodeType":"355","messageId":"356","endLine":102,"endColumn":62,"suggestions":"437"},{"ruleId":"353","severity":1,"message":"354","line":102,"column":69,"nodeType":"355","messageId":"356","endLine":102,"endColumn":70,"suggestions":"438"},{"ruleId":"353","severity":1,"message":"354","line":109,"column":33,"nodeType":"355","messageId":"356","endLine":109,"endColumn":34,"suggestions":"439"},{"ruleId":"353","severity":1,"message":"354","line":109,"column":47,"nodeType":"355","messageId":"356","endLine":109,"endColumn":48,"suggestions":"440"},{"ruleId":"353","severity":1,"message":"354","line":109,"column":62,"nodeType":"355","messageId":"356","endLine":109,"endColumn":63,"suggestions":"441"},{"ruleId":"353","severity":1,"message":"354","line":109,"column":78,"nodeType":"355","messageId":"356","endLine":109,"endColumn":79,"suggestions":"442"},{"ruleId":"353","severity":1,"message":"354","line":119,"column":33,"nodeType":"355","messageId":"356","endLine":119,"endColumn":34,"suggestions":"443"},{"ruleId":"353","severity":1,"message":"354","line":119,"column":49,"nodeType":"355","messageId":"356","endLine":119,"endColumn":50,"suggestions":"444"},{"ruleId":"353","severity":1,"message":"354","line":119,"column":64,"nodeType":"355","messageId":"356","endLine":119,"endColumn":65,"suggestions":"445"},{"ruleId":"353","severity":1,"message":"354","line":119,"column":78,"nodeType":"355","messageId":"356","endLine":119,"endColumn":79,"suggestions":"446"},{"ruleId":"353","severity":1,"message":"354","line":156,"column":26,"nodeType":"355","messageId":"356","endLine":156,"endColumn":27,"suggestions":"447"},{"ruleId":"353","severity":1,"message":"354","line":156,"column":40,"nodeType":"355","messageId":"356","endLine":156,"endColumn":41,"suggestions":"448"},{"ruleId":"353","severity":1,"message":"354","line":163,"column":26,"nodeType":"355","messageId":"356","endLine":163,"endColumn":27,"suggestions":"449"},{"ruleId":"353","severity":1,"message":"354","line":163,"column":39,"nodeType":"355","messageId":"356","endLine":163,"endColumn":40,"suggestions":"450"},{"ruleId":"353","severity":1,"message":"354","line":170,"column":26,"nodeType":"355","messageId":"356","endLine":170,"endColumn":27,"suggestions":"451"},{"ruleId":"353","severity":1,"message":"354","line":170,"column":38,"nodeType":"355","messageId":"356","endLine":170,"endColumn":39,"suggestions":"452"},{"ruleId":"353","severity":1,"message":"354","line":178,"column":26,"nodeType":"355","messageId":"356","endLine":178,"endColumn":27,"suggestions":"453"},{"ruleId":"353","severity":1,"message":"354","line":178,"column":40,"nodeType":"355","messageId":"356","endLine":178,"endColumn":41,"suggestions":"454"},{"ruleId":"353","severity":1,"message":"354","line":199,"column":25,"nodeType":"355","messageId":"356","endLine":199,"endColumn":26,"suggestions":"455"},{"ruleId":"353","severity":1,"message":"354","line":199,"column":32,"nodeType":"355","messageId":"356","endLine":199,"endColumn":33,"suggestions":"456"},{"ruleId":"353","severity":1,"message":"354","line":199,"column":47,"nodeType":"355","messageId":"356","endLine":199,"endColumn":48,"suggestions":"457"},{"ruleId":"353","severity":1,"message":"354","line":199,"column":59,"nodeType":"355","messageId":"356","endLine":199,"endColumn":60,"suggestions":"458"},{"ruleId":"353","severity":1,"message":"354","line":211,"column":25,"nodeType":"355","messageId":"356","endLine":211,"endColumn":26,"suggestions":"459"},{"ruleId":"353","severity":1,"message":"354","line":211,"column":37,"nodeType":"355","messageId":"356","endLine":211,"endColumn":38,"suggestions":"460"},{"ruleId":"353","severity":1,"message":"354","line":211,"column":52,"nodeType":"355","messageId":"356","endLine":211,"endColumn":53,"suggestions":"461"},{"ruleId":"353","severity":1,"message":"354","line":211,"column":64,"nodeType":"355","messageId":"356","endLine":211,"endColumn":65,"suggestions":"462"},{"ruleId":"353","severity":1,"message":"354","line":226,"column":25,"nodeType":"355","messageId":"356","endLine":226,"endColumn":26,"suggestions":"463"},{"ruleId":"353","severity":1,"message":"354","line":226,"column":39,"nodeType":"355","messageId":"356","endLine":226,"endColumn":40,"suggestions":"464"},{"ruleId":"353","severity":1,"message":"354","line":226,"column":54,"nodeType":"355","messageId":"356","endLine":226,"endColumn":55,"suggestions":"465"},{"ruleId":"353","severity":1,"message":"354","line":226,"column":70,"nodeType":"355","messageId":"356","endLine":226,"endColumn":71,"suggestions":"466"},{"ruleId":"353","severity":1,"message":"354","line":234,"column":25,"nodeType":"355","messageId":"356","endLine":234,"endColumn":26,"suggestions":"467"},{"ruleId":"353","severity":1,"message":"354","line":234,"column":41,"nodeType":"355","messageId":"356","endLine":234,"endColumn":42,"suggestions":"468"},{"ruleId":"353","severity":1,"message":"354","line":234,"column":56,"nodeType":"355","messageId":"356","endLine":234,"endColumn":57,"suggestions":"469"},{"ruleId":"353","severity":1,"message":"354","line":234,"column":68,"nodeType":"355","messageId":"356","endLine":234,"endColumn":69,"suggestions":"470"},{"ruleId":"353","severity":1,"message":"354","line":243,"column":25,"nodeType":"355","messageId":"356","endLine":243,"endColumn":26,"suggestions":"471"},{"ruleId":"353","severity":1,"message":"354","line":243,"column":38,"nodeType":"355","messageId":"356","endLine":243,"endColumn":39,"suggestions":"472"},{"ruleId":"353","severity":1,"message":"354","line":243,"column":53,"nodeType":"355","messageId":"356","endLine":243,"endColumn":54,"suggestions":"473"},{"ruleId":"353","severity":1,"message":"354","line":243,"column":61,"nodeType":"355","messageId":"356","endLine":243,"endColumn":62,"suggestions":"474"},{"ruleId":"353","severity":1,"message":"354","line":250,"column":25,"nodeType":"355","messageId":"356","endLine":250,"endColumn":26,"suggestions":"475"},{"ruleId":"353","severity":1,"message":"354","line":250,"column":39,"nodeType":"355","messageId":"356","endLine":250,"endColumn":40,"suggestions":"476"},{"ruleId":"353","severity":1,"message":"354","line":250,"column":54,"nodeType":"355","messageId":"356","endLine":250,"endColumn":55,"suggestions":"477"},{"ruleId":"353","severity":1,"message":"354","line":250,"column":70,"nodeType":"355","messageId":"356","endLine":250,"endColumn":71,"suggestions":"478"},{"ruleId":"353","severity":1,"message":"354","line":259,"column":25,"nodeType":"355","messageId":"356","endLine":259,"endColumn":26,"suggestions":"479"},{"ruleId":"353","severity":1,"message":"354","line":259,"column":41,"nodeType":"355","messageId":"356","endLine":259,"endColumn":42,"suggestions":"480"},{"ruleId":"353","severity":1,"message":"354","line":259,"column":56,"nodeType":"355","messageId":"356","endLine":259,"endColumn":57,"suggestions":"481"},{"ruleId":"353","severity":1,"message":"354","line":259,"column":70,"nodeType":"355","messageId":"356","endLine":259,"endColumn":71,"suggestions":"482"},{"ruleId":"322","severity":1,"message":"380","line":1,"column":8,"nodeType":"324","messageId":"325","endLine":1,"endColumn":18},{"ruleId":"322","severity":1,"message":"483","line":3,"column":8,"nodeType":"324","messageId":"325","endLine":3,"endColumn":14},{"ruleId":"322","severity":1,"message":"385","line":4,"column":8,"nodeType":"324","messageId":"325","endLine":4,"endColumn":11},{"ruleId":"322","severity":1,"message":"484","line":5,"column":8,"nodeType":"324","messageId":"325","endLine":5,"endColumn":15},{"ruleId":"322","severity":1,"message":"485","line":8,"column":8,"nodeType":"324","messageId":"325","endLine":8,"endColumn":14},{"ruleId":"322","severity":1,"message":"378","line":10,"column":10,"nodeType":"324","messageId":"325","endLine":10,"endColumn":32},{"ruleId":"322","severity":1,"message":"486","line":11,"column":8,"nodeType":"324","messageId":"325","endLine":11,"endColumn":14},{"ruleId":"322","severity":1,"message":"487","line":13,"column":10,"nodeType":"324","messageId":"325","endLine":13,"endColumn":17},{"ruleId":"322","severity":1,"message":"488","line":14,"column":10,"nodeType":"324","messageId":"325","endLine":14,"endColumn":16},{"ruleId":"322","severity":1,"message":"489","line":17,"column":8,"nodeType":"324","messageId":"325","endLine":17,"endColumn":22},{"ruleId":"322","severity":1,"message":"490","line":23,"column":8,"nodeType":"324","messageId":"325","endLine":23,"endColumn":11},{"ruleId":"330","severity":1,"message":"331","line":84,"column":48,"nodeType":"332","messageId":"333","endLine":84,"endColumn":50},{"ruleId":"330","severity":1,"message":"331","line":92,"column":53,"nodeType":"332","messageId":"333","endLine":92,"endColumn":55},{"ruleId":"330","severity":1,"message":"331","line":100,"column":53,"nodeType":"332","messageId":"333","endLine":100,"endColumn":55},{"ruleId":"322","severity":1,"message":"491","line":110,"column":9,"nodeType":"324","messageId":"325","endLine":110,"endColumn":22},{"ruleId":"322","severity":1,"message":"492","line":4,"column":8,"nodeType":"324","messageId":"325","endLine":4,"endColumn":24},{"ruleId":"322","severity":1,"message":"493","line":1,"column":8,"nodeType":"324","messageId":"325","endLine":1,"endColumn":13},{"ruleId":"322","severity":1,"message":"494","line":2,"column":8,"nodeType":"324","messageId":"325","endLine":2,"endColumn":13},{"ruleId":"322","severity":1,"message":"495","line":3,"column":8,"nodeType":"324","messageId":"325","endLine":3,"endColumn":13},{"ruleId":"322","severity":1,"message":"496","line":4,"column":8,"nodeType":"324","messageId":"325","endLine":4,"endColumn":19},{"ruleId":"322","severity":1,"message":"497","line":5,"column":8,"nodeType":"324","messageId":"325","endLine":5,"endColumn":17},{"ruleId":"322","severity":1,"message":"498","line":6,"column":8,"nodeType":"324","messageId":"325","endLine":6,"endColumn":22},{"ruleId":"322","severity":1,"message":"499","line":7,"column":8,"nodeType":"324","messageId":"325","endLine":7,"endColumn":16},{"ruleId":"353","severity":1,"message":"354","line":13,"column":64,"nodeType":"355","messageId":"356","endLine":13,"endColumn":65,"suggestions":"500"},{"ruleId":"353","severity":1,"message":"354","line":13,"column":84,"nodeType":"355","messageId":"356","endLine":13,"endColumn":85,"suggestions":"501"},{"ruleId":"353","severity":1,"message":"354","line":14,"column":66,"nodeType":"355","messageId":"356","endLine":14,"endColumn":67,"suggestions":"502"},{"ruleId":"353","severity":1,"message":"354","line":14,"column":92,"nodeType":"355","messageId":"356","endLine":14,"endColumn":93,"suggestions":"503"},{"ruleId":"353","severity":1,"message":"354","line":15,"column":65,"nodeType":"355","messageId":"356","endLine":15,"endColumn":66,"suggestions":"504"},{"ruleId":"353","severity":1,"message":"354","line":15,"column":84,"nodeType":"355","messageId":"356","endLine":15,"endColumn":85,"suggestions":"505"},{"ruleId":"322","severity":1,"message":"506","line":2,"column":27,"nodeType":"324","messageId":"325","endLine":2,"endColumn":33},{"ruleId":"322","severity":1,"message":"507","line":2,"column":35,"nodeType":"324","messageId":"325","endLine":2,"endColumn":40},{"ruleId":"322","severity":1,"message":"508","line":2,"column":42,"nodeType":"324","messageId":"325","endLine":2,"endColumn":48},{"ruleId":"322","severity":1,"message":"509","line":3,"column":8,"nodeType":"324","messageId":"325","endLine":3,"endColumn":16},{"ruleId":"322","severity":1,"message":"510","line":6,"column":8,"nodeType":"324","messageId":"325","endLine":6,"endColumn":12},{"ruleId":"322","severity":1,"message":"485","line":7,"column":8,"nodeType":"324","messageId":"325","endLine":7,"endColumn":14},{"ruleId":"322","severity":1,"message":"511","line":8,"column":8,"nodeType":"324","messageId":"325","endLine":8,"endColumn":22},{"ruleId":"322","severity":1,"message":"512","line":9,"column":8,"nodeType":"324","messageId":"325","endLine":9,"endColumn":16},{"ruleId":"322","severity":1,"message":"490","line":10,"column":8,"nodeType":"324","messageId":"325","endLine":10,"endColumn":11},{"ruleId":"322","severity":1,"message":"513","line":11,"column":8,"nodeType":"324","messageId":"325","endLine":11,"endColumn":11},{"ruleId":"322","severity":1,"message":"514","line":13,"column":10,"nodeType":"324","messageId":"325","endLine":13,"endColumn":16},{"ruleId":"322","severity":1,"message":"515","line":13,"column":18,"nodeType":"324","messageId":"325","endLine":13,"endColumn":31},{"ruleId":"322","severity":1,"message":"516","line":17,"column":10,"nodeType":"324","messageId":"325","endLine":17,"endColumn":22},{"ruleId":"322","severity":1,"message":"517","line":18,"column":10,"nodeType":"324","messageId":"325","endLine":18,"endColumn":38},{"ruleId":"322","severity":1,"message":"518","line":18,"column":40,"nodeType":"324","messageId":"325","endLine":18,"endColumn":60},{"ruleId":"322","severity":1,"message":"519","line":18,"column":62,"nodeType":"324","messageId":"325","endLine":18,"endColumn":81},{"ruleId":"322","severity":1,"message":"327","line":19,"column":8,"nodeType":"324","messageId":"325","endLine":19,"endColumn":9},{"ruleId":"322","severity":1,"message":"520","line":35,"column":10,"nodeType":"324","messageId":"325","endLine":35,"endColumn":23},{"ruleId":"322","severity":1,"message":"521","line":62,"column":9,"nodeType":"324","messageId":"325","endLine":62,"endColumn":14},{"ruleId":"322","severity":1,"message":"522","line":70,"column":9,"nodeType":"324","messageId":"325","endLine":70,"endColumn":25},{"ruleId":"322","severity":1,"message":"329","line":203,"column":11,"nodeType":"324","messageId":"325","endLine":203,"endColumn":26},{"ruleId":"330","severity":1,"message":"331","line":212,"column":17,"nodeType":"332","messageId":"333","endLine":212,"endColumn":19},{"ruleId":"330","severity":1,"message":"331","line":215,"column":24,"nodeType":"332","messageId":"333","endLine":215,"endColumn":26},{"ruleId":"322","severity":1,"message":"334","line":218,"column":13,"nodeType":"324","messageId":"325","endLine":218,"endColumn":19},{"ruleId":"322","severity":1,"message":"334","line":223,"column":13,"nodeType":"324","messageId":"325","endLine":223,"endColumn":19},{"ruleId":"330","severity":1,"message":"331","line":249,"column":17,"nodeType":"332","messageId":"333","endLine":249,"endColumn":19},{"ruleId":"330","severity":1,"message":"331","line":253,"column":24,"nodeType":"332","messageId":"333","endLine":253,"endColumn":26},{"ruleId":"335","severity":1,"message":"336","line":379,"column":6,"nodeType":"337","endLine":379,"endColumn":20,"suggestions":"523"},{"ruleId":"335","severity":1,"message":"339","line":387,"column":6,"nodeType":"337","endLine":387,"endColumn":19,"suggestions":"524"},{"ruleId":"335","severity":1,"message":"341","line":400,"column":6,"nodeType":"337","endLine":400,"endColumn":39,"suggestions":"525"},{"ruleId":"335","severity":1,"message":"343","line":415,"column":8,"nodeType":"337","endLine":415,"endColumn":43,"suggestions":"526"},{"ruleId":"335","severity":1,"message":"527","line":420,"column":8,"nodeType":"337","endLine":420,"endColumn":10,"suggestions":"528"},{"ruleId":"335","severity":1,"message":"366","line":477,"column":8,"nodeType":"337","endLine":477,"endColumn":80,"suggestions":"529"},{"ruleId":"330","severity":1,"message":"331","line":16,"column":51,"nodeType":"332","messageId":"333","endLine":16,"endColumn":53},{"ruleId":"330","severity":1,"message":"331","line":17,"column":51,"nodeType":"332","messageId":"333","endLine":17,"endColumn":53},{"ruleId":"322","severity":1,"message":"530","line":53,"column":11,"nodeType":"324","messageId":"325","endLine":53,"endColumn":30},"no-native-reassign",["531"],"no-negated-in-lhs",["532"],"no-unused-vars","'StartPage' is defined but never used.","Identifier","unusedVar","'g_MachineStateHandler' is defined but never used.","'_' is defined but never used.","'AWS' is defined but never used.","'which_match_mtx' is assigned a value but never used.","eqeqeq","Expected '===' and instead saw '=='.","BinaryExpression","unexpected","'isSpan' is assigned a value but never used.","react-hooks/exhaustive-deps","React Hook useEffect has missing dependencies: 'CurrSentInd', 'MachineStateHandlerWrapper', and 'StateMachineState'. Either include them or remove the dependency array.","ArrayExpression",["533"],"React Hook useEffect has a missing dependency: 'SetSummaryShadowAndUpdateHighlights'. Either include it or remove the dependency array.",["534"],"React Hook useEffect has missing dependencies: 'boldStateHandler' and 'sliderBoldStateActivated'. Either include them or remove the dependency array.",["535"],"React Hook useEffect has a missing dependency: 'oldAlignmentStateHandler'. Either include it or remove the dependency array.",["536"],"React Hook useEffect has missing dependencies: 'DocOnMouseDownID', 'StateMachineState', 'SummaryOnMouseDownID', 'checkIfLemmasMatch', 'doc_json', 'hoverActivatedDocOrSummary', 'isRedLettered', and 'summary_json'. Either include them or remove the dependency array. You can also do a functional update 'setDocJson(d => ...)' if you only need 'doc_json' in the 'setDocJson' call.",["537"],"React Hook useEffect has a missing dependency: 'g_resetGuidedAnnotation'. Either include it or remove the dependency array.",["538"],"React Hook useEffect has missing dependencies: 'assignmentId', 'doc_json', 'g_completed', 'g_guided_annotation_history', 'summary_json', and 'turkSubmitTo'. Either include them or remove the dependency array.",["539"],"'Fade' is defined but never used.","'statSync' is defined but never used.","no-useless-escape","Unnecessary escape character: \\\".","TemplateElement","unnecessaryEscape",["540","541"],["542","543"],"React Hook useEffect has missing dependencies: 'CurrSentInd', 'MachineStateHandlerWrapper', 'StateMachineState', and 'isPunct'. Either include them or remove the dependency array. If 'isPunct' changes too often, find the parent component that defines it and wrap that definition in useCallback.",["544"],["545"],["546"],["547"],"React Hook useEffect has missing dependencies: 'setDocOnMouseDownActivated' and 'setSummaryOnMouseDownActivated'. Either include them or remove the dependency array. If 'setDocOnMouseDownActivated' changes too often, find the parent component that defines it and wrap that definition in useCallback.",["548"],"React Hook useEffect has missing dependencies: 'DocOnMouseDownID', 'StateMachineState', 'SummaryOnMouseDownID', 'checkIfLemmasMatch', 'doc_json', 'hoverActivatedDocOrSummary', 'isRedLettered', 'setDocJson', 'setSummaryJson', and 'summary_json'. Either include them or remove the dependency array. If 'setDocJson' changes too often, find the parent component that defines it and wrap that definition in useCallback.",["549"],"React Hook useEffect has missing dependencies: 'guiding_msg', 'setGuidingMsg', and 'setGuidingMsgType'. Either include them or remove the dependency array. If 'setGuidingMsgType' changes too often, find the parent component that defines it and wrap that definition in useCallback.",["550"],"React Hook useEffect has missing dependencies: 'g_guided_annotation_history', 'g_setAnswerModalMsg', 'g_setAnswerWordsToGlow', 'g_setGuidedAnnotationHistory', 'g_setStrikesCounter', 'g_strikes_counter', and 'getAnswerModalMsg'. Either include them or remove the dependency array. If 'g_setStrikesCounter' changes too often, find the parent component that defines it and wrap that definition in useCallback.",["551"],"React Hook useEffect has missing dependencies: 'StateMachineState', 'doc_json', and 'g_setGuiderMsg'. Either include them or remove the dependency array. If 'g_setGuiderMsg' changes too often, find the parent component that defines it and wrap that definition in useCallback.",["552"],"React Hook useEffect has missing dependencies: 'CurrSentInd', 'curr_alignment_guiding_msg_id', 'isAlignmentOk', 'isSummarySpanOk', and 'setIsGoodAlignment'. Either include them or remove the dependency array. If 'setIsGoodAlignment' changes too often, find the parent component that defines it and wrap that definition in useCallback.",["553"],"'MuiAlert' is defined but never used.","'ArrowBackIosTwoTone' is defined but never used.","'ArrowForwardIosTwoTone' is defined but never used.","'SendIcon' is defined but never used.","'Typography' is defined but never used.","'Fab' is defined but never used.","'CardHeader' is defined but never used.","'CardActions' is defined but never used.","'CardContent' is defined but never used.","'Box' is defined but never used.","'borderColor' is defined but never used.","'string_to_span' is defined but never used.","'DocMouseclickStartID' is assigned a value but never used.","'DocMouseclicked' is assigned a value but never used.","'SummaryMouseclickStartID' is assigned a value but never used.","'SummaryMouseclicked' is assigned a value but never used.","'toastVisible' is assigned a value but never used.","'setToastVisible' is assigned a value but never used.","'get_range' is assigned a value but never used.","'doc_words_groups' is assigned a value but never used.","The ref value 'containerRef.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'containerRef.current' to a variable inside the effect, and use that variable in the cleanup function.","React Hook useEffect has a missing dependency: 'callbackFunction'. Either include it or remove the dependency array.",["554"],"React Hook useEffect has a missing dependency: 'g_hint_msg'. Either include it or remove the dependency array.",["555"],"React Hook useEffect has missing dependencies: 'StateMachineState', 'doc_json', 'summary_json', 'toggleDocSpanHighlight', and 'toggleSummarySpanHighlight'. Either include them or remove the dependency array. If 'toggleDocSpanHighlight' changes too often, find the parent component that defines it and wrap that definition in useCallback.",["556"],"React Hook useEffect has missing dependencies: 'MachineStateHandlerWrapper', 'StateMachineState', 'SubmitHandler', and 'setNoAlignModalShow'. Either include them or remove the dependency array. If 'setNoAlignModalShow' changes too often, find the parent component that defines it and wrap that definition in useCallback.",["557"],"'ButtonGroup' is defined but never used.","'spacing' is defined but never used.","'pages' is assigned a value but never used.","'BackButton' is defined but never used.",["531"],["532"],["558","559"],["560","561"],["562","563"],["564","565"],["566","567"],["568","569"],["570","571"],["572","573"],["574","575"],["576","577"],["578","579"],["580","581"],["582","583"],["584","585"],["586","587"],["588","589"],["590","591"],["592","593"],["594","595"],["596","597"],["598","599"],["600","601"],["602","603"],["604","605"],["606","607"],["608","609"],["610","611"],["612","613"],["614","615"],["616","617"],["618","619"],["620","621"],["622","623"],["624","625"],["626","627"],["628","629"],["630","631"],["632","633"],["634","635"],["636","637"],["638","639"],["640","641"],["642","643"],["644","645"],["646","647"],["648","649"],["650","651"],["652","653"],["654","655"],["656","657"],["658","659"],["660","661"],["662","663"],["664","665"],["666","667"],["668","669"],["670","671"],["672","673"],["674","675"],["676","677"],["678","679"],["680","681"],["682","683"],["684","685"],["686","687"],["688","689"],["690","691"],["692","693"],["694","695"],["696","697"],["698","699"],["700","701"],"'AppBar' is defined but never used.","'Toolbar' is defined but never used.","'Button' is defined but never used.","'Slider' is defined but never used.","'padding' is defined but never used.","'styled' is defined but never used.","'OverlayTrigger' is defined but never used.","'Row' is defined but never used.","'renderTooltip' is assigned a value but never used.","'ResponsiveAppBar' is defined but never used.","'Alert' is defined but never used.","'Modal' is defined but never used.","'Toast' is defined but never used.","'ToastHeader' is defined but never used.","'ToastBody' is defined but never used.","'ToastContainer' is defined but never used.","'Carousel' is defined but never used.",["702","703"],["704","705"],["706","707"],["708","709"],["710","711"],["712","713"],"'Router' is defined but never used.","'Route' is defined but never used.","'Routes' is defined but never used.","'Snackbar' is defined but never used.","'Card' is defined but never used.","'DropdownButton' is defined but never used.","'Dropdown' is defined but never used.","'Col' is defined but never used.","'Player' is defined but never used.","'BigPlayButton' is defined but never used.","'TutorialCard' is defined but never used.","'t_StateMachineStateIdHandler' is defined but never used.","'getTutorialCardTitle' is defined but never used.","'getTutorialCardText' is defined but never used.","'error_message' is assigned a value but never used.","'Alert' is assigned a value but never used.","'handleErrorClose' is assigned a value but never used.",["714"],["715"],["716"],["717"],"React Hook useEffect has a missing dependency: 'doc_json'. Either include it or remove the dependency array.",["718"],["719"],"'turkSetAssignmentID' is defined but never used.","no-global-assign","no-unsafe-negation",{"desc":"720","fix":"721"},{"desc":"722","fix":"723"},{"desc":"724","fix":"725"},{"desc":"726","fix":"727"},{"desc":"728","fix":"729"},{"desc":"730","fix":"731"},{"desc":"732","fix":"733"},{"messageId":"734","fix":"735","desc":"736"},{"messageId":"737","fix":"738","desc":"739"},{"messageId":"734","fix":"740","desc":"736"},{"messageId":"737","fix":"741","desc":"739"},{"desc":"742","fix":"743"},{"desc":"722","fix":"744"},{"desc":"724","fix":"745"},{"desc":"726","fix":"746"},{"desc":"747","fix":"748"},{"desc":"749","fix":"750"},{"desc":"751","fix":"752"},{"desc":"753","fix":"754"},{"desc":"755","fix":"756"},{"desc":"757","fix":"758"},{"desc":"759","fix":"760"},{"desc":"761","fix":"762"},{"desc":"763","fix":"764"},{"desc":"765","fix":"766"},{"messageId":"734","fix":"767","desc":"736"},{"messageId":"737","fix":"768","desc":"739"},{"messageId":"734","fix":"769","desc":"736"},{"messageId":"737","fix":"770","desc":"739"},{"messageId":"734","fix":"771","desc":"736"},{"messageId":"737","fix":"772","desc":"739"},{"messageId":"734","fix":"773","desc":"736"},{"messageId":"737","fix":"774","desc":"739"},{"messageId":"734","fix":"775","desc":"736"},{"messageId":"737","fix":"776","desc":"739"},{"messageId":"734","fix":"777","desc":"736"},{"messageId":"737","fix":"778","desc":"739"},{"messageId":"734","fix":"779","desc":"736"},{"messageId":"737","fix":"780","desc":"739"},{"messageId":"734","fix":"781","desc":"736"},{"messageId":"737","fix":"782","desc":"739"},{"messageId":"734","fix":"783","desc":"736"},{"messageId":"737","fix":"784","desc":"739"},{"messageId":"734","fix":"785","desc":"736"},{"messageId":"737","fix":"786","desc":"739"},{"messageId":"734","fix":"787","desc":"736"},{"messageId":"737","fix":"788","desc":"739"},{"messageId":"734","fix":"789","desc":"736"},{"messageId":"737","fix":"790","desc":"739"},{"messageId":"734","fix":"791","desc":"736"},{"messageId":"737","fix":"792","desc":"739"},{"messageId":"734","fix":"793","desc":"736"},{"messageId":"737","fix":"794","desc":"739"},{"messageId":"734","fix":"795","desc":"736"},{"messageId":"737","fix":"796","desc":"739"},{"messageId":"734","fix":"797","desc":"736"},{"messageId":"737","fix":"798","desc":"739"},{"messageId":"734","fix":"799","desc":"736"},{"messageId":"737","fix":"800","desc":"739"},{"messageId":"734","fix":"801","desc":"736"},{"messageId":"737","fix":"802","desc":"739"},{"messageId":"734","fix":"803","desc":"736"},{"messageId":"737","fix":"804","desc":"739"},{"messageId":"734","fix":"805","desc":"736"},{"messageId":"737","fix":"806","desc":"739"},{"messageId":"734","fix":"807","desc":"736"},{"messageId":"737","fix":"808","desc":"739"},{"messageId":"734","fix":"809","desc":"736"},{"messageId":"737","fix":"810","desc":"739"},{"messageId":"734","fix":"811","desc":"736"},{"messageId":"737","fix":"812","desc":"739"},{"messageId":"734","fix":"813","desc":"736"},{"messageId":"737","fix":"814","desc":"739"},{"messageId":"734","fix":"815","desc":"736"},{"messageId":"737","fix":"816","desc":"739"},{"messageId":"734","fix":"817","desc":"736"},{"messageId":"737","fix":"818","desc":"739"},{"messageId":"734","fix":"819","desc":"736"},{"messageId":"737","fix":"820","desc":"739"},{"messageId":"734","fix":"821","desc":"736"},{"messageId":"737","fix":"822","desc":"739"},{"messageId":"734","fix":"823","desc":"736"},{"messageId":"737","fix":"824","desc":"739"},{"messageId":"734","fix":"825","desc":"736"},{"messageId":"737","fix":"826","desc":"739"},{"messageId":"734","fix":"827","desc":"736"},{"messageId":"737","fix":"828","desc":"739"},{"messageId":"734","fix":"829","desc":"736"},{"messageId":"737","fix":"830","desc":"739"},{"messageId":"734","fix":"831","desc":"736"},{"messageId":"737","fix":"832","desc":"739"},{"messageId":"734","fix":"833","desc":"736"},{"messageId":"737","fix":"834","desc":"739"},{"messageId":"734","fix":"835","desc":"736"},{"messageId":"737","fix":"836","desc":"739"},{"messageId":"734","fix":"837","desc":"736"},{"messageId":"737","fix":"838","desc":"739"},{"messageId":"734","fix":"839","desc":"736"},{"messageId":"737","fix":"840","desc":"739"},{"messageId":"734","fix":"841","desc":"736"},{"messageId":"737","fix":"842","desc":"739"},{"messageId":"734","fix":"843","desc":"736"},{"messageId":"737","fix":"844","desc":"739"},{"messageId":"734","fix":"845","desc":"736"},{"messageId":"737","fix":"846","desc":"739"},{"messageId":"734","fix":"847","desc":"736"},{"messageId":"737","fix":"848","desc":"739"},{"messageId":"734","fix":"849","desc":"736"},{"messageId":"737","fix":"850","desc":"739"},{"messageId":"734","fix":"851","desc":"736"},{"messageId":"737","fix":"852","desc":"739"},{"messageId":"734","fix":"853","desc":"736"},{"messageId":"737","fix":"854","desc":"739"},{"messageId":"734","fix":"855","desc":"736"},{"messageId":"737","fix":"856","desc":"739"},{"messageId":"734","fix":"857","desc":"736"},{"messageId":"737","fix":"858","desc":"739"},{"messageId":"734","fix":"859","desc":"736"},{"messageId":"737","fix":"860","desc":"739"},{"messageId":"734","fix":"861","desc":"736"},{"messageId":"737","fix":"862","desc":"739"},{"messageId":"734","fix":"863","desc":"736"},{"messageId":"737","fix":"864","desc":"739"},{"messageId":"734","fix":"865","desc":"736"},{"messageId":"737","fix":"866","desc":"739"},{"messageId":"734","fix":"867","desc":"736"},{"messageId":"737","fix":"868","desc":"739"},{"messageId":"734","fix":"869","desc":"736"},{"messageId":"737","fix":"870","desc":"739"},{"messageId":"734","fix":"871","desc":"736"},{"messageId":"737","fix":"872","desc":"739"},{"messageId":"734","fix":"873","desc":"736"},{"messageId":"737","fix":"874","desc":"739"},{"messageId":"734","fix":"875","desc":"736"},{"messageId":"737","fix":"876","desc":"739"},{"messageId":"734","fix":"877","desc":"736"},{"messageId":"737","fix":"878","desc":"739"},{"messageId":"734","fix":"879","desc":"736"},{"messageId":"737","fix":"880","desc":"739"},{"messageId":"734","fix":"881","desc":"736"},{"messageId":"737","fix":"882","desc":"739"},{"messageId":"734","fix":"883","desc":"736"},{"messageId":"737","fix":"884","desc":"739"},{"messageId":"734","fix":"885","desc":"736"},{"messageId":"737","fix":"886","desc":"739"},{"messageId":"734","fix":"887","desc":"736"},{"messageId":"737","fix":"888","desc":"739"},{"messageId":"734","fix":"889","desc":"736"},{"messageId":"737","fix":"890","desc":"739"},{"messageId":"734","fix":"891","desc":"736"},{"messageId":"737","fix":"892","desc":"739"},{"messageId":"734","fix":"893","desc":"736"},{"messageId":"737","fix":"894","desc":"739"},{"messageId":"734","fix":"895","desc":"736"},{"messageId":"737","fix":"896","desc":"739"},{"messageId":"734","fix":"897","desc":"736"},{"messageId":"737","fix":"898","desc":"739"},{"messageId":"734","fix":"899","desc":"736"},{"messageId":"737","fix":"900","desc":"739"},{"messageId":"734","fix":"901","desc":"736"},{"messageId":"737","fix":"902","desc":"739"},{"messageId":"734","fix":"903","desc":"736"},{"messageId":"737","fix":"904","desc":"739"},{"messageId":"734","fix":"905","desc":"736"},{"messageId":"737","fix":"906","desc":"739"},{"messageId":"734","fix":"907","desc":"736"},{"messageId":"737","fix":"908","desc":"739"},{"messageId":"734","fix":"909","desc":"736"},{"messageId":"737","fix":"910","desc":"739"},{"messageId":"734","fix":"911","desc":"736"},{"messageId":"737","fix":"912","desc":"739"},{"messageId":"734","fix":"913","desc":"736"},{"messageId":"737","fix":"914","desc":"739"},{"messageId":"734","fix":"915","desc":"736"},{"messageId":"737","fix":"916","desc":"739"},{"messageId":"734","fix":"917","desc":"736"},{"messageId":"737","fix":"918","desc":"739"},{"messageId":"734","fix":"919","desc":"736"},{"messageId":"737","fix":"920","desc":"739"},{"messageId":"734","fix":"921","desc":"736"},{"messageId":"737","fix":"922","desc":"739"},{"desc":"720","fix":"923"},{"desc":"722","fix":"924"},{"desc":"724","fix":"925"},{"desc":"726","fix":"926"},{"desc":"927","fix":"928"},{"desc":"749","fix":"929"},"Update the dependencies array to be: [CurrSentInd, MachineStateHandlerWrapper, StateMachineState, summary_json]",{"range":"930","text":"931"},"Update the dependencies array to be: [CurrSentInd, SetSummaryShadowAndUpdateHighlights]",{"range":"932","text":"933"},"Update the dependencies array to be: [StateMachineState, boldStateHandler, sliderBoldStateActivated, summary_json]",{"range":"934","text":"935"},"Update the dependencies array to be: [StateMachineState, AlignmentCount, oldAlignmentStateHandler]",{"range":"936","text":"937"},"Update the dependencies array to be: [docOnMouseDownActivated, summaryOnMouseDownActivated, hoverActivatedId, StateMachineState, DocOnMouseDownID, doc_json, SummaryOnMouseDownID, summary_json, isRedLettered, hoverActivatedDocOrSummary, checkIfLemmasMatch]",{"range":"938","text":"939"},"Update the dependencies array to be: [g_resetGuidedAnnotation]",{"range":"940","text":"941"},"Update the dependencies array to be: [assignmentId, doc_json, g_completed, g_guided_annotation_history, isFinished, summary_json, turkSubmitTo]",{"range":"942","text":"943"},"removeEscape",{"range":"944","text":"945"},"Remove the `\\`. This maintains the current functionality.","escapeBackslash",{"range":"946","text":"947"},"Replace the `\\` with `\\\\` to include the actual backslash character.",{"range":"948","text":"945"},{"range":"949","text":"947"},"Update the dependencies array to be: [CurrSentInd, MachineStateHandlerWrapper, StateMachineState, isPunct, summary_json]",{"range":"950","text":"951"},{"range":"952","text":"933"},{"range":"953","text":"935"},{"range":"954","text":"937"},"Update the dependencies array to be: [DocOnMouseDownID, SummaryOnMouseDownID, setDocOnMouseDownActivated, setSummaryOnMouseDownActivated]",{"range":"955","text":"956"},"Update the dependencies array to be: [docOnMouseDownActivated, summaryOnMouseDownActivated, hoverActivatedId, StateMachineState, DocOnMouseDownID, setDocJson, doc_json, SummaryOnMouseDownID, setSummaryJson, summary_json, isRedLettered, hoverActivatedDocOrSummary, checkIfLemmasMatch]",{"range":"957","text":"958"},"Update the dependencies array to be: [guiding_msg, guiding_msg_type, setGuidingMsg, setGuidingMsgType]",{"range":"959","text":"960"},"Update the dependencies array to be: [g_guided_annotation_history, g_setAnswerModalMsg, g_setAnswerWordsToGlow, g_setGuidedAnnotationHistory, g_setStrikesCounter, g_strikes_counter, getAnswerModalMsg, guiding_msg_type]",{"range":"961","text":"962"},"Update the dependencies array to be: [StateMachineState, doc_json, g_setGuiderMsg, is_good_alignment]",{"range":"963","text":"964"},"Update the dependencies array to be: [CurrSentInd, curr_alignment_guiding_msg_id, doc_json, isAlignmentOk, isSummarySpanOk, setIsGoodAlignment, summary_json]",{"range":"965","text":"966"},"Update the dependencies array to be: [callbackFunction, containerRef, options]",{"range":"967","text":"968"},"Update the dependencies array to be: [g_hint_msg]",{"range":"969","text":"970"},"Update the dependencies array to be: [StateMachineState, ctrlButtonDown, doc_json, summary_json, toggleDocSpanHighlight, toggleSummarySpanHighlight]",{"range":"971","text":"972"},"Update the dependencies array to be: [MachineStateHandlerWrapper, StateMachineState, SubmitHandler, noAlignApproved, setNoAlignModalShow]",{"range":"973","text":"974"},{"range":"975","text":"945"},{"range":"976","text":"947"},{"range":"977","text":"945"},{"range":"978","text":"947"},{"range":"979","text":"945"},{"range":"980","text":"947"},{"range":"981","text":"945"},{"range":"982","text":"947"},{"range":"983","text":"945"},{"range":"984","text":"947"},{"range":"985","text":"945"},{"range":"986","text":"947"},{"range":"987","text":"945"},{"range":"988","text":"947"},{"range":"989","text":"945"},{"range":"990","text":"947"},{"range":"991","text":"945"},{"range":"992","text":"947"},{"range":"993","text":"945"},{"range":"994","text":"947"},{"range":"995","text":"945"},{"range":"996","text":"947"},{"range":"997","text":"945"},{"range":"998","text":"947"},{"range":"999","text":"945"},{"range":"1000","text":"947"},{"range":"1001","text":"945"},{"range":"1002","text":"947"},{"range":"1003","text":"945"},{"range":"1004","text":"947"},{"range":"1005","text":"945"},{"range":"1006","text":"947"},{"range":"1007","text":"945"},{"range":"1008","text":"947"},{"range":"1009","text":"945"},{"range":"1010","text":"947"},{"range":"1011","text":"945"},{"range":"1012","text":"947"},{"range":"1013","text":"945"},{"range":"1014","text":"947"},{"range":"1015","text":"945"},{"range":"1016","text":"947"},{"range":"1017","text":"945"},{"range":"1018","text":"947"},{"range":"1019","text":"945"},{"range":"1020","text":"947"},{"range":"1021","text":"945"},{"range":"1022","text":"947"},{"range":"1023","text":"945"},{"range":"1024","text":"947"},{"range":"1025","text":"945"},{"range":"1026","text":"947"},{"range":"1027","text":"945"},{"range":"1028","text":"947"},{"range":"1029","text":"945"},{"range":"1030","text":"947"},{"range":"1031","text":"945"},{"range":"1032","text":"947"},{"range":"1033","text":"945"},{"range":"1034","text":"947"},{"range":"1035","text":"945"},{"range":"1036","text":"947"},{"range":"1037","text":"945"},{"range":"1038","text":"947"},{"range":"1039","text":"945"},{"range":"1040","text":"947"},{"range":"1041","text":"945"},{"range":"1042","text":"947"},{"range":"1043","text":"945"},{"range":"1044","text":"947"},{"range":"1045","text":"945"},{"range":"1046","text":"947"},{"range":"1047","text":"945"},{"range":"1048","text":"947"},{"range":"1049","text":"945"},{"range":"1050","text":"947"},{"range":"1051","text":"945"},{"range":"1052","text":"947"},{"range":"1053","text":"945"},{"range":"1054","text":"947"},{"range":"1055","text":"945"},{"range":"1056","text":"947"},{"range":"1057","text":"945"},{"range":"1058","text":"947"},{"range":"1059","text":"945"},{"range":"1060","text":"947"},{"range":"1061","text":"945"},{"range":"1062","text":"947"},{"range":"1063","text":"945"},{"range":"1064","text":"947"},{"range":"1065","text":"945"},{"range":"1066","text":"947"},{"range":"1067","text":"945"},{"range":"1068","text":"947"},{"range":"1069","text":"945"},{"range":"1070","text":"947"},{"range":"1071","text":"945"},{"range":"1072","text":"947"},{"range":"1073","text":"945"},{"range":"1074","text":"947"},{"range":"1075","text":"945"},{"range":"1076","text":"947"},{"range":"1077","text":"945"},{"range":"1078","text":"947"},{"range":"1079","text":"945"},{"range":"1080","text":"947"},{"range":"1081","text":"945"},{"range":"1082","text":"947"},{"range":"1083","text":"945"},{"range":"1084","text":"947"},{"range":"1085","text":"945"},{"range":"1086","text":"947"},{"range":"1087","text":"945"},{"range":"1088","text":"947"},{"range":"1089","text":"945"},{"range":"1090","text":"947"},{"range":"1091","text":"945"},{"range":"1092","text":"947"},{"range":"1093","text":"945"},{"range":"1094","text":"947"},{"range":"1095","text":"945"},{"range":"1096","text":"947"},{"range":"1097","text":"945"},{"range":"1098","text":"947"},{"range":"1099","text":"945"},{"range":"1100","text":"947"},{"range":"1101","text":"945"},{"range":"1102","text":"947"},{"range":"1103","text":"945"},{"range":"1104","text":"947"},{"range":"1105","text":"945"},{"range":"1106","text":"947"},{"range":"1107","text":"945"},{"range":"1108","text":"947"},{"range":"1109","text":"945"},{"range":"1110","text":"947"},{"range":"1111","text":"945"},{"range":"1112","text":"947"},{"range":"1113","text":"945"},{"range":"1114","text":"947"},{"range":"1115","text":"945"},{"range":"1116","text":"947"},{"range":"1117","text":"945"},{"range":"1118","text":"947"},{"range":"1119","text":"945"},{"range":"1120","text":"947"},{"range":"1121","text":"945"},{"range":"1122","text":"947"},{"range":"1123","text":"945"},{"range":"1124","text":"947"},{"range":"1125","text":"945"},{"range":"1126","text":"947"},{"range":"1127","text":"945"},{"range":"1128","text":"947"},{"range":"1129","text":"945"},{"range":"1130","text":"947"},{"range":"1131","text":"931"},{"range":"1132","text":"933"},{"range":"1133","text":"935"},{"range":"1134","text":"937"},"Update the dependencies array to be: [doc_json]",{"range":"1135","text":"1136"},{"range":"1137","text":"958"},[31262,31276],"[CurrSentInd, MachineStateHandlerWrapper, StateMachineState, summary_json]",[31544,31557],"[CurrSentInd, SetSummaryShadowAndUpdateHighlights]",[32524,32557],"[StateMachineState, boldStateHandler, sliderBoldStateActivated, summary_json]",[33312,33347],"[StateMachineState, AlignmentCount, oldAlignmentStateHandler]",[37015,37087],"[docOnMouseDownActivated, summaryOnMouseDownActivated, hoverActivatedId, StateMachineState, DocOnMouseDownID, doc_json, SummaryOnMouseDownID, summary_json, isRedLettered, hoverActivatedDocOrSummary, checkIfLemmasMatch]",[40846,40848],"[g_resetGuidedAnnotation]",[41590,41602],"[assignmentId, doc_json, g_completed, g_guided_annotation_history, isFinished, summary_json, turkSubmitTo]",[45995,45996],"",[45995,45995],"\\",[46201,46202],[46201,46201],[49090,49104],"[CurrSentInd, MachineStateHandlerWrapper, StateMachineState, isPunct, summary_json]",[49466,49479],[50442,50475],[51216,51251],[52813,52852],"[DocOnMouseDownID, SummaryOnMouseDownID, setDocOnMouseDownActivated, setSummaryOnMouseDownActivated]",[55357,55429],"[docOnMouseDownActivated, summaryOnMouseDownActivated, hoverActivatedId, StateMachineState, DocOnMouseDownID, setDocJson, doc_json, SummaryOnMouseDownID, setSummaryJson, summary_json, isRedLettered, hoverActivatedDocOrSummary, checkIfLemmasMatch]",[55667,55685],"[guiding_msg, guiding_msg_type, setGuidingMsg, setGuidingMsgType]",[56502,56520],"[g_guided_annotation_history, g_setAnswerModalMsg, g_setAnswerWordsToGlow, g_setGuidedAnnotationHistory, g_setStrikesCounter, g_strikes_counter, getAnswerModalMsg, guiding_msg_type]",[57645,57664],"[StateMachineState, doc_json, g_setGuiderMsg, is_good_alignment]",[58305,58329],"[CurrSentInd, curr_alignment_guiding_msg_id, doc_json, isAlignmentOk, isSummarySpanOk, setIsGoodAlignment, summary_json]",[23517,23540],"[callbackFunction, containerRef, options]",[23741,23743],"[g_hint_msg]",[24933,24949],"[StateMachineState, ctrlButtonDown, doc_json, summary_json, toggleDocSpanHighlight, toggleSummarySpanHighlight]",[25298,25315],"[MachineStateHandlerWrapper, StateMachineState, SubmitHandler, noAlignApproved, setNoAlignModalShow]",[851,852],[851,851],[865,866],[865,865],[1131,1132],[1131,1131],[1144,1145],[1144,1144],[1399,1400],[1399,1399],[1411,1412],[1411,1411],[1720,1721],[1720,1720],[1734,1735],[1734,1734],[2758,2759],[2758,2758],[2765,2766],[2765,2765],[2780,2781],[2780,2780],[2792,2793],[2792,2792],[3276,3277],[3276,3276],[3288,3289],[3288,3288],[3303,3304],[3303,3303],[3315,3316],[3315,3315],[3984,3985],[3984,3984],[3998,3999],[3998,3998],[4013,4014],[4013,4013],[4029,4030],[4029,4029],[4480,4481],[4480,4480],[4496,4497],[4496,4496],[4511,4512],[4511,4511],[4523,4524],[4523,4523],[4942,4943],[4942,4942],[4955,4956],[4955,4955],[4970,4971],[4970,4970],[4978,4979],[4978,4978],[5212,5213],[5212,5212],[5226,5227],[5226,5226],[5241,5242],[5241,5241],[5257,5258],[5257,5257],[5694,5695],[5694,5694],[5710,5711],[5710,5710],[5725,5726],[5725,5725],[5739,5740],[5739,5739],[6836,6837],[6836,6836],[6850,6851],[6850,6850],[7086,7087],[7086,7086],[7099,7100],[7099,7099],[7324,7325],[7324,7324],[7336,7337],[7336,7336],[7609,7610],[7609,7609],[7623,7624],[7623,7623],[8535,8536],[8535,8535],[8542,8543],[8542,8542],[8557,8558],[8557,8557],[8569,8570],[8569,8569],[9032,9033],[9032,9032],[9044,9045],[9044,9044],[9059,9060],[9059,9059],[9071,9072],[9071,9071],[9668,9669],[9668,9668],[9682,9683],[9682,9682],[9697,9698],[9697,9697],[9713,9714],[9713,9713],[10114,10115],[10114,10114],[10130,10131],[10130,10130],[10145,10146],[10145,10145],[10157,10158],[10157,10157],[10516,10517],[10516,10516],[10529,10530],[10529,10529],[10544,10545],[10544,10544],[10552,10553],[10552,10552],[10744,10745],[10744,10744],[10758,10759],[10758,10758],[10773,10774],[10773,10773],[10789,10790],[10789,10789],[11093,11094],[11093,11093],[11109,11110],[11109,11109],[11124,11125],[11124,11124],[11138,11139],[11138,11138],[655,656],[655,655],[675,676],[675,675],[762,763],[762,762],[788,789],[788,788],[874,875],[874,874],[893,894],[893,893],[20359,20373],[20641,20654],[21619,21652],[22407,22442],[22630,22632],"[doc_json]",[25610,25682]]